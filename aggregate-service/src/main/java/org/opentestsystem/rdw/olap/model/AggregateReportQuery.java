package org.opentestsystem.rdw.olap.model;

import java.util.Objects;
import java.util.Set;

import static com.google.common.collect.Sets.newHashSet;

/**
 * Represents query parameters for the custom aggregate repository.
 */
public class AggregateReportQuery extends OrganizationTypeQuery {
    private Set<Integer> schoolYears;
    private Set<String> assessmentGradeCodes;
    private Set<String> subjectCodes;
    private String subgroupKey;

    public String getSubgroupKey() {
        return subgroupKey;
    }

    public Set<String> getSubjectCodes() {
        return subjectCodes == null ? newHashSet() : newHashSet(subjectCodes);
    }

    public Set<Integer> getSchoolYears() {
        return schoolYears == null ? newHashSet() : newHashSet(schoolYears);
    }

    public Set<String> getAssessmentGradeCodes() {
        return assessmentGradeCodes == null ? newHashSet() : newHashSet(assessmentGradeCodes);
    }

    public Builder copy() {
        return builder().copy(this);
    }

    public static Builder builder() {
        return new Builder();
    }

    @Override
    public boolean equals(final Object o) {
        if (this == o) return true;
        if (o == null || !(o instanceof AggregateReportQuery)) return false;
        final AggregateReportQuery that = (AggregateReportQuery) o;
        return super.equals(that)
                && Objects.equals(subjectCodes, that.subjectCodes)
                && Objects.equals(schoolYears, that.schoolYears)
                && Objects.equals(assessmentGradeCodes, that.assessmentGradeCodes)
                && Objects.equals(subgroupKey, that.subgroupKey);
    }

    @Override
    public int hashCode() {
        return Objects.hash(super.hashCode(), subjectCodes, schoolYears, assessmentGradeCodes, subgroupKey);
    }

    public static class Builder extends OrganizationTypeQuery.Builder<Builder, AggregateReportQuery> {
        private Set<String> subjectCodes;
        private Set<Integer> schoolYears;
        private Set<String> assessmentGradeCodes;
        private String subgroupKey;

        @Override
        AggregateReportQuery createInstance() {
            return new AggregateReportQuery();
        }

        public AggregateReportQuery build() {
            final AggregateReportQuery query = super.build();
            query.subjectCodes = subjectCodes;
            query.schoolYears = schoolYears;
            query.assessmentGradeCodes = assessmentGradeCodes;
            query.subgroupKey = subgroupKey;
            return query;
        }

        public Builder copy(final AggregateReportQuery query) {
            super.copy(query);
            subjectCodes = query.getSubjectCodes();
            schoolYears = query.getSchoolYears();
            assessmentGradeCodes = query.getAssessmentGradeCodes();
            subgroupKey = query.getSubgroupKey();
            return this;
        }

        public Builder subjectCodes(final Set<String> subjectCodes) {
            this.subjectCodes = subjectCodes;
            return this;
        }

        public Builder schoolYears(final Set<Integer> schoolYears) {
            this.schoolYears = schoolYears;
            return this;
        }

        public Builder subgroupKey(final String subgroupKey) {
            this.subgroupKey = subgroupKey;
            return this;
        }

        public Builder assessmentGradeCodes(final Set<String> assessmentGradeCodes) {
            this.assessmentGradeCodes = assessmentGradeCodes;
            return this;
        }
    }
}