package org.opentestsystem.rdw.olap.service.impl;

import org.opentestsystem.rdw.olap.AggregateReportSettings;
import org.opentestsystem.rdw.olap.model.LongitudinalReportQuery;
import org.opentestsystem.rdw.olap.model.LongitudinalReportResult;
import org.opentestsystem.rdw.olap.repository.LongitudinalReportRepository;
import org.opentestsystem.rdw.olap.service.AuthorizationService;
import org.opentestsystem.rdw.olap.service.BasicLongitudinalService;
import org.opentestsystem.rdw.reporting.common.model.AggregateQuery;
import org.opentestsystem.rdw.reporting.common.model.BasicLongitudinalReportQuery;
import org.opentestsystem.rdw.reporting.common.model.LongitudinalRow;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.task.TaskExecutor;
import org.springframework.stereotype.Service;

import static org.opentestsystem.rdw.reporting.common.model.AggregateQueryType.BasicLongitudinal;

/**
 * Default implementation of an {@link BasicLongitudinalService} backed by a repository
 */
@Service
class DefaultBasicLongitudinalService extends AbstractBasicAggregateService<LongitudinalRow,
        LongitudinalReportResult,
        BasicLongitudinalReportQuery,
        LongitudinalReportResult.Builder,
        LongitudinalReportQuery,
        LongitudinalReportQuery.Builder> implements BasicLongitudinalService {

    @Autowired
    DefaultBasicLongitudinalService(
            final LongitudinalReportRepository repository,
            final AuthorizationService authorizationService,
            final AggregateReportSettings settings,
            final BasicLongitudinalReportQueryAdapter queryAdapter,
            final TaskExecutor threadPoolTaskExecutor) {
        super(repository, authorizationService, settings, queryAdapter, threadPoolTaskExecutor);
    }

    @Override
    public boolean handles(final AggregateQuery query) {
        return BasicLongitudinal.equals(query.getQueryType());
    }

    @Override
    protected LongitudinalReportResult.Builder getReportResultBuilder() {
        return LongitudinalReportResult.builder();
    }
}