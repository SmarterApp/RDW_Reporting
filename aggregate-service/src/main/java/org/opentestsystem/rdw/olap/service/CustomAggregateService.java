package org.opentestsystem.rdw.olap.service;

import org.opentestsystem.rdw.reporting.common.model.ReportQuery;
import org.opentestsystem.rdw.reporting.common.model.ReportRow;
import org.opentestsystem.rdw.reporting.common.web.security.User;
import org.springframework.security.access.prepost.PreAuthorize;

import javax.validation.constraints.NotNull;
import java.util.List;

/**
 * Implementation of this interface is responsible for retrieving the custom aggregate report
 */
@PreAuthorize("hasAuthority('PERM_CUSTOM_AGGREGATE_READ')")
public interface CustomAggregateService {

    /**
     * Creates a custom aggregate report for the given {@link ReportQuery}
     *
     * @param user the {@link User} creating the report
     * @param query the {@link ReportQuery} for the report
     * @return the list of {@link ReportRow}
     */
    List<ReportRow> findByQuery(@NotNull User user, @NotNull ReportQuery query);

    /**
     * Estimates number of the rows in a custom aggregate report for the given {@link ReportQuery}
     *
     * @param user the {@link User} creating the report
     * @param query the {@link ReportQuery} for the report
     * @return an estimated number of rows
     */
    int estimateReportRowCount(@NotNull User user, @NotNull ReportQuery query);

}