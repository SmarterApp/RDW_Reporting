package org.opentestsystem.rdw.olap.repository;

import org.opentestsystem.rdw.olap.model.AggregateRowReportResult;
import org.opentestsystem.rdw.olap.model.OrganizationTypeQuery;
import org.opentestsystem.rdw.reporting.common.model.AggregateRow;
import org.opentestsystem.rdw.reporting.common.model.OrganizationType;
import org.opentestsystem.rdw.reporting.common.security.PermissionSource;

import javax.validation.constraints.NotNull;

/**
 * Repository responsible for the aggregate report
 */
public interface ReportRepository<T extends AggregateRow, R extends AggregateRowReportResult<T>, Q extends OrganizationTypeQuery> {
    /**
     * Creates a custom aggregate report for the given {@link OrganizationTypeQuery} with the result
     * grouped by the given {@link OrganizationType}
     *
     * @param permissionSource        the security information to prepare the SQL query parameters for
     * @param query                   the {@link OrganizationTypeQuery} for the report
     * @param groupByOrganizationType the {@link OrganizationType} to group the result data by
     * @return an instance of {@link AggregateRowReportResult}
     */
    R findByOrganizationType(@NotNull PermissionSource permissionSource, @NotNull Q query, OrganizationType groupByOrganizationType);

    /**
     * Estimates the number of rows in a custom aggregate report for the given {@link OrganizationTypeQuery} with the result
     * grouped by the given {@link OrganizationType}
     *
     * @param query                   the {@link OrganizationTypeQuery} for the report
     * @param groupByOrganizationType the {@link OrganizationType} to group the result data by
     * @return an estimated number of rows
     */
    int estimateReportRowCountByOrganizationType(@NotNull Q query, @NotNull OrganizationType groupByOrganizationType);
}