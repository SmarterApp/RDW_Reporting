package org.opentestsystem.rdw.olap.model;

import com.google.common.collect.ImmutableList;
import org.opentestsystem.rdw.reporting.common.model.BasicAggregateRow;

import java.util.Collection;

/**
 * Aggregate report result for {@link org.opentestsystem.rdw.reporting.common.model.BasicAggregateReportQuery}
 * requests.
 */
public class BasicAggregateReportResult extends AggregateReportResult<ImmutableList<BasicAggregateRow>> {

    public static Builder builder() {
        return new Builder();
    }

    public static class Builder extends AggregateReportResult.Builder<Builder, BasicAggregateReportResult, ImmutableList<BasicAggregateRow>> {

        private final ImmutableList.Builder<BasicAggregateRow> rows = ImmutableList.builder();

        @Override
        protected BasicAggregateReportResult createInstance() {
            return new BasicAggregateReportResult();
        }

        @Override
        public BasicAggregateReportResult build() {
            super.payload(rows.build());
            return super.build();
        }

        public Builder merge(final BasicAggregateReportResult report) {
            rows(report.getPayload());
            createdWhileDataEmbargoed(this.isCreatedWhileDataEmbargoed() || report.isCreatedWhileDataEmbargoed());
            return this;
        }

        public Builder rows(final Collection<BasicAggregateRow> rows) {
            this.rows.addAll(rows);
            return this;
        }

        public Builder row(final BasicAggregateRow row) {
            this.rows.add(row);
            return this;
        }
    }
}
