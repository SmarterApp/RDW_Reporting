package org.opentestsystem.rdw.olap.repository.impl;

import org.junit.Test;
import org.opentestsystem.rdw.reporting.common.model.District;
import org.opentestsystem.rdw.reporting.common.model.School;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Import;
import org.springframework.test.context.jdbc.Sql;

import static org.assertj.core.api.Assertions.assertThat;

@Import(JdbcOrganizationRepository.class)
@Sql(scripts = {"classpath:OlapEntitiesSetup.sql"})
public class JdbcOrganizationRepositoryRST extends RepositoryBackedIT {

    @Autowired
    private JdbcOrganizationRepository repository;

    @Test
    public void itShouldFindAll() {
        assertThat(repository.findAllSchoolsAndDistricts())
                .usingFieldByFieldElementComparator()
                .containsExactlyInAnyOrder(
                        District.builder().districtGroupId(-1L).id(-7).name("District-7").naturalId("id-7").build(),
                        District.builder().districtGroupId(-1L).id(-8).name("District-8").naturalId("id-8").build(),
                        District.builder().districtGroupId(-1L).id(-9).name("District-9").naturalId("id-9").build(),
                        School.builder().districtGroupId(-1L).districtId(-7).schoolGroupId(-1L).id(-7).name("School-7").naturalId("id-7").build(),
                        School.builder().districtGroupId(-1L).districtId(-8).schoolGroupId(-1L).id(-8).name("School-8").naturalId("id-8").build(),
                        School.builder().districtGroupId(-1L).districtId(-9).schoolGroupId(-1L).id(-9).name("School-9").naturalId("id-9").build(),
                        School.builder().districtGroupId(-1L).districtId(-9).schoolGroupId(-1L).id(-10).name("School-10").naturalId("id-10").build()
                );
    }

}
