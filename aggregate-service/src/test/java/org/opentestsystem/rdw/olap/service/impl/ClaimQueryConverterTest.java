package org.opentestsystem.rdw.olap.service.impl;

import com.google.common.collect.ImmutableMap;
import com.google.common.collect.ImmutableSet;
import org.opentestsystem.rdw.olap.model.OrganizationTypeQuery;
import org.opentestsystem.rdw.olap.sqlbuilder.impl.QueryProviderRepositoryHelper;
import org.opentestsystem.rdw.reporting.common.model.ClaimAggregateReportQuery;
import org.opentestsystem.rdw.reporting.common.model.ClaimAggregateReportQuery.Builder;
import org.opentestsystem.rdw.reporting.common.model.DimensionType;
import org.opentestsystem.rdw.reporting.common.model.StudentFilters;

import static com.google.common.collect.ImmutableSet.of;
import static org.opentestsystem.rdw.common.model.AssessmentType.SUMMATIVE;
import static org.opentestsystem.rdw.common.model.Subject.ELA;
import static org.opentestsystem.rdw.common.model.Subject.MATH;

public class ClaimQueryConverterTest extends AbstractQueryConverterTest<ClaimAggregateReportQuery, Builder> {
    @Override
    protected AbstractQueryConverter createAdapterUnderTest(final QueryProviderRepositoryHelper repositoryHelper) {
        return new ClaimQueryConverter(repositoryHelper);
    }

    @Override
    protected ClaimAggregateReportQuery.Builder getAggregateReportQueryBuilder() {
        return ClaimAggregateReportQuery.builder()
                .dimensionType(DimensionType.Overall)
                .assessmentGradeCodes(of("-8"))
                .schoolIds(of(123L))
                .schoolYears(of(1999))
                .schoolIds(of(123L))
                .claimCodesBySubject(ImmutableMap.of(ELA.code(), ImmutableSet.of("SOCK_R", "SOCK_LS", "2-W", "4-CR"), MATH.code(), ImmutableSet.of("SOCK_2", "1", "3")))
                .assessmentTypeCode(SUMMATIVE.code());
    }

    @Override
    protected OrganizationTypeQuery.Builder toQueryBuilderWithCommonAttributes(final ClaimAggregateReportQuery reportQuery,
                                                                               final StudentFilters filters) {
        return AggregateTestUtils.toQueryClaimBuilderWithCommonAttributes(reportQuery, filters)
                .claimCodesBySubject(reportQuery.getClaimCodesBySubject());
    }
}