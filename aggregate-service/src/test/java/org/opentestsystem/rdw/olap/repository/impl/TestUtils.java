package org.opentestsystem.rdw.olap.repository.impl;

import org.opentestsystem.rdw.reporting.common.model.Measures;
import org.opentestsystem.rdw.reporting.common.model.ReportRow;

import java.util.List;

import static org.assertj.core.api.Assertions.assertThat;
import static org.opentestsystem.rdw.reporting.common.model.OrganizationType.District;
import static org.opentestsystem.rdw.reporting.common.model.OrganizationType.State;

public final class TestUtils {
    private TestUtils() {
    }

    public static void verifyStateStudentCount(final List<ReportRow> rows, final int expectedCount) {
        assertThat(rows.stream()
                .filter(r -> (r.getOrganization().getOrganizationType() == State))
                .mapToInt(r -> countStudents(r.getMeasures()))
                .sum())
                .isEqualTo(expectedCount);
    }

    public static void verifyDistrictStudentCount(final List<ReportRow> rows, final long districtId, final int expectedCount) {
        assertThat(rows.stream()
                .filter(r -> (r.getOrganization().getOrganizationType() == District && r.getOrganization().getId() == districtId))
                .mapToInt(r -> countStudents(r.getMeasures()))
                .sum())
                .isEqualTo(expectedCount);
    }

    public static int countStudents(final Measures measures) {
        return measures.getLevel1Count() + measures.getLevel2Count() + measures.getLevel3Count() + measures.getLevel4Count();
    }
}