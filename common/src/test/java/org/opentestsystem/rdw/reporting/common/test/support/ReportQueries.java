package org.opentestsystem.rdw.reporting.common.test.support;

import com.google.common.collect.ImmutableSet;
import org.opentestsystem.rdw.common.model.Subject;
import org.opentestsystem.rdw.reporting.common.model.AggregateQueryType;
import org.opentestsystem.rdw.reporting.common.model.CustomAggregateReportQuery;
import org.opentestsystem.rdw.reporting.common.model.StudentFilters;

import java.util.Map;

import static com.google.common.collect.Maps.newHashMap;
import static org.opentestsystem.rdw.common.model.AssessmentType.ICA;
import static org.opentestsystem.rdw.common.model.Subject.MATH;
import static org.opentestsystem.rdw.reporting.common.model.DimensionType.Gender;

/**
 * Test utility for generating aggregate query test objects.
 */
public class ReportQueries {

    public static CustomAggregateReportQuery.Builder basicAggregateQuery() {
        final StudentFilters filters = StudentFilters.builder().build();
        return CustomAggregateReportQuery.builder()
                .queryType(AggregateQueryType.BasicCustomAggregate)
                .assessmentTypeCode(ICA.code())
                .subjectCodes(ImmutableSet.of(MATH.code().toLowerCase(), Subject.ELA.code().toUpperCase()))
                .schoolYears(ImmutableSet.of(2017, 2018))
                .assessmentGradeCodes(ImmutableSet.of("01", "02", "03", "04", "05"))
                .includeState(true)
                .includeAllDistricts(false)
                .subgroup(Gender)
                .districtIds(ImmutableSet.of(1L))
                .schoolIds(ImmutableSet.of(1L))
                .studentFilters(filters);
    }

    public static CustomAggregateReportQuery.Builder filteredSubgroupQuery() {
        final Map<String, StudentFilters> subgroups = newHashMap();
        subgroups.put("overall", StudentFilters.builder()
                .build());
        subgroups.put("subgroupA", StudentFilters.builder()
                .genderCodes(ImmutableSet.of("Male"))
                .build());
        subgroups.put("subgroupB", StudentFilters.builder()
                .genderCodes(ImmutableSet.of("Female"))
                .build());

        return CustomAggregateReportQuery.builder()
                .queryType(AggregateQueryType.FilteredSubgroupCustomAggregate)
                .assessmentTypeCode(ICA.code())
                .subjectCodes(ImmutableSet.of(MATH.code().toLowerCase(), Subject.ELA.code().toUpperCase()))
                .schoolYears(ImmutableSet.of(2017, 2018))
                .assessmentGradeCodes(ImmutableSet.of("01", "02", "03", "04", "05"))
                .includeState(true)
                .includeAllDistricts(false)
                .subgroups(subgroups)
                .districtIds(ImmutableSet.of(1L))
                .schoolIds(ImmutableSet.of(1L));
    }
}
