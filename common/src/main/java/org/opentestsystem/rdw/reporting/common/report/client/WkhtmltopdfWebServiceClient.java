package org.opentestsystem.rdw.reporting.common.report.client;

import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.client.RestTemplate;

import javax.validation.constraints.NotNull;

import static com.google.common.base.Preconditions.checkNotNull;

/**
 * This class acts as an interface to the openlabs wkhtmltopdf web service
 */
public class WkhtmltopdfWebServiceClient {

    /**
     * Fixed headers sent to the wkhtmltopdf web service REST API
     */
    private static final HttpHeaders HEADERS = new HttpHeaders();

    static {
        HEADERS.setContentType(MediaType.APPLICATION_JSON);
    }

    /**
     * Spring REST Template used to connect to the wkhtmltopdf web service REST API
     */
    private final RestTemplate template;

    /**
     * wkhtmltopdf web service REST API URL
     */
    private final String url;

    public WkhtmltopdfWebServiceClient(@NotNull final RestTemplate template, @NotNull final String endpoint) {
        this.template = checkNotNull(template);
        this.url = checkNotNull(endpoint);
    }

    /**
     * @return PDF as bytes from the wkhtmltopdf web service
     */
    public byte[] toPdf(final Request request) {
        return template.exchange(url, HttpMethod.POST, new HttpEntity<>(request, HEADERS), byte[].class).getBody();
    }

}
