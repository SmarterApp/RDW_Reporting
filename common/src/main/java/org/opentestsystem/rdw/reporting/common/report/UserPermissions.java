package org.opentestsystem.rdw.reporting.common.report;

import org.opentestsystem.rdw.security.GroupGrant;
import org.opentestsystem.rdw.security.Permission;

import java.util.Map;

import static com.google.common.collect.ImmutableMap.copyOf;
import static com.google.common.collect.ImmutableMap.of;

/**
 * This class is responsible for containing the user's granted permissions
 * within the context of the Reporting application suite.
 */
public class UserPermissions {

    private Map<String, Permission> permissionsById;
    private Map<Long, GroupGrant> groupsById;

    /**
     * @return The user permissions by scope
     */
    public Map<String, Permission> getPermissionsById() {
        return permissionsById == null ? of() : permissionsById;
    }

    /**
     * @return The group grants by group id
     */
    public Map<Long, GroupGrant> getGroupsById() {
        return groupsById == null ? of() : groupsById;
    }

    public static Builder builder() {
        return new Builder();
    }

    public static class Builder {
        private Map<String, Permission> permissionsById;
        private Map<Long, GroupGrant> groupsById;

        public UserPermissions build() {
            final UserPermissions permissions = new UserPermissions();
            permissions.groupsById = groupsById == null ? of() : copyOf(groupsById);
            permissions.permissionsById = permissionsById == null ? of() : copyOf(permissionsById);
            return permissions;
        }

        public Builder permissionsById(final Map<String, Permission> permissionsById) {
            this.permissionsById = permissionsById;
            return this;
        }

        public Builder groupsById(final Map<Long, GroupGrant> groupsById) {
            this.groupsById = groupsById;
            return this;
        }
    }
}
