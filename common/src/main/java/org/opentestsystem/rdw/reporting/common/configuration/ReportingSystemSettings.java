package org.opentestsystem.rdw.reporting.common.configuration;

import com.fasterxml.jackson.annotation.JsonIgnore;
import com.google.common.base.Objects;
import org.opentestsystem.rdw.multitenant.TenantConfigurationStatus;
import org.opentestsystem.rdw.multitenant.TenantConfigurationStatusProvider;
import org.opentestsystem.rdw.reporting.common.model.SearchFieldPermissionLevel;
import org.opentestsystem.rdw.reporting.common.model.StudentFieldType;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class ReportingSystemSettings extends AbstractReportingSystemProperties implements TenantConfigurationStatusProvider {

    private static final Logger logger = LoggerFactory.getLogger(ReportingSystemSettings.class);
    private final LocalDateTime created = LocalDateTime.now();

    private String analyticsTrackingId;
    private String interpretiveGuideUrl;
    private String accessDeniedUrl;
    private String landingPageUrl;
    private String irisVendorId;
    private Integer minItemDataYear;
    private Boolean percentileDisplayEnabled;
    private List<String> reportLanguages = new ArrayList<>();
    private Integer schoolYear;
    private StateProperties state = new StateProperties();
    private Boolean transferAccessEnabled;
    private String translationLocation;
    private List<String> uiLanguages = new ArrayList<>();
    private String userGuideUrl;
    private TargetReportProperties targetReport = new TargetReportProperties();
    private Map<StudentFieldType, SearchFieldPermissionLevel> studentFields = new HashMap<>();
    private Map<String, ReportingSystemPropertiesImpl> tenants = new HashMap<>();

    public ReportingSystemSettings() {
        logger.debug("created: {} tenants: {} ", created, tenants);
    }

    @Override
    public String getAnalyticsTrackingId() {
        return analyticsTrackingId;
    }

    public void setAnalyticsTrackingId(final String analyticsTrackingId) {
        this.analyticsTrackingId = analyticsTrackingId;
    }

    @Override
    public String getInterpretiveGuideUrl() {
        return interpretiveGuideUrl;
    }

    public void setInterpretiveGuideUrl(final String interpretiveGuideUrl) {
        this.interpretiveGuideUrl = interpretiveGuideUrl;
    }

    @Override
    public String getAccessDeniedUrl() {
        return accessDeniedUrl;
    }

    public void setAccessDeniedUrl(final String accessDeniedUrl) {
        this.accessDeniedUrl = accessDeniedUrl;
    }

    @Override
    public String getLandingPageUrl() {
        return landingPageUrl;
    }

    public void setLandingPageUrl(String landingPageUrl) {
        this.landingPageUrl = landingPageUrl;
    }

    @Override
    public String getIrisVendorId() {
        return this.irisVendorId;
    }

    public void setIrisVendorId(final String irisVendorId) {
        this.irisVendorId = irisVendorId;
    }

    @Override
    public Integer getMinItemDataYear() {
        return minItemDataYear;
    }

    public void setMinItemDataYear(final Integer minItemDataYear) {
        this.minItemDataYear = minItemDataYear;
    }

    @Override
    public Boolean isPercentileDisplayEnabled() {
        return percentileDisplayEnabled;
    }

    public void setPercentileDisplayEnabled(final Boolean percentileDisplayEnabled) {
        this.percentileDisplayEnabled = percentileDisplayEnabled;
    }

    @Override
    public List<String> getReportLanguages() {
        return reportLanguages;
    }

    public void setReportLanguages(final List<String> reportLanguages) {
        this.reportLanguages = reportLanguages;
    }

    @Override
    public Integer getSchoolYear() {
        return schoolYear;
    }

    public void setSchoolYear(final Integer schoolYear) {
        this.schoolYear = schoolYear;
    }

    @Override
    public StateProperties getState() {
        return state;
    }

    public void setState(final StateProperties state) {
        this.state = state;
    }

    @Override
    public Boolean isTransferAccessEnabled() {
        return transferAccessEnabled;
    }

    public void setTransferAccessEnabled(final Boolean transferAccessEnabled) {
        this.transferAccessEnabled = transferAccessEnabled;
    }

    @Override
    public String getTranslationLocation() {
        return translationLocation;
    }

    public void setTranslationLocation(final String translationLocation) {
        this.translationLocation = translationLocation;
    }

    @Override
    public List<String> getUiLanguages() {
        return uiLanguages;
    }

    public void setUiLanguages(final List<String> uiLanguages) {
        this.uiLanguages = uiLanguages;
    }

    @Override
    public String getUserGuideUrl() {
        return userGuideUrl;
    }

    public void setUserGuideUrl(final String userGuideUrl) {
        this.userGuideUrl = userGuideUrl;
    }

    public TargetReportProperties getTargetReport() {
        return targetReport;
    }

    public void setTargetReport(final TargetReportProperties targetReport) {
        this.targetReport = targetReport;
    }

    @Override
    public Map<StudentFieldType, SearchFieldPermissionLevel> getStudentFields() {
        return studentFields;
    }

    public void setStudentFields(final Map<StudentFieldType, SearchFieldPermissionLevel> studentFields) {
        this.studentFields = studentFields;
    }

    public Map<String, ReportingSystemPropertiesImpl> getTenants() {
        return tenants;
    }

    public void setTenants(Map<String, ReportingSystemPropertiesImpl> tenants) {
        this.tenants = tenants;
    }

    @Override
    @JsonIgnore
    public TenantConfigurationStatus getStatus() {
        return TenantConfigurationStatus.builder()
                .created(created)
                .tenantKeys(new ArrayList<>(tenants.keySet()))
                .build();
    }

    @Override
    public String toString() {
        return "ReportingSystemSettings{" +
                "analyticsTrackingId='" + analyticsTrackingId + '\'' +
                ", interpretiveGuideUrl='" + interpretiveGuideUrl + '\'' +
                ", accessDeniedUrl='" + accessDeniedUrl + '\'' +
                ", irisVendorId='" + irisVendorId + '\'' +
                ", minItemDataYear=" + minItemDataYear +
                ", percentileDisplayEnabled=" + percentileDisplayEnabled +
                ", reportLanguages=" + reportLanguages +
                ", schoolYear=" + schoolYear +
                ", state=" + state +
                ", transferAccessEnabled=" + transferAccessEnabled +
                ", translationLocation='" + translationLocation + '\'' +
                ", uiLanguages=" + uiLanguages +
                ", userGuideUrl='" + userGuideUrl + '\'' +
                ", targetReport=" + targetReport +
                ", studentFields=" + studentFields +
                ", tenants=" + tenants.toString() +
                '}';
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof ReportingSystemSettings)) return false;
        ReportingSystemSettings that = (ReportingSystemSettings) o;
        return Objects.equal(analyticsTrackingId, that.analyticsTrackingId) &&
                Objects.equal(interpretiveGuideUrl, that.interpretiveGuideUrl) &&
                Objects.equal(accessDeniedUrl, that.accessDeniedUrl) &&
                Objects.equal(landingPageUrl, that.landingPageUrl) &&
                Objects.equal(irisVendorId, that.irisVendorId) &&
                Objects.equal(minItemDataYear, that.minItemDataYear) &&
                Objects.equal(percentileDisplayEnabled, that.percentileDisplayEnabled) &&
                Objects.equal(reportLanguages, that.reportLanguages) &&
                Objects.equal(schoolYear, that.schoolYear) &&
                Objects.equal(state, that.state) &&
                Objects.equal(transferAccessEnabled, that.transferAccessEnabled) &&
                Objects.equal(translationLocation, that.translationLocation) &&
                Objects.equal(uiLanguages, that.uiLanguages) &&
                Objects.equal(userGuideUrl, that.userGuideUrl) &&
                Objects.equal(targetReport, that.targetReport) &&
                Objects.equal(studentFields, that.studentFields) &&
                Objects.equal(tenants, that.tenants);
    }

    @Override
    public int hashCode() {
        return Objects.hashCode(analyticsTrackingId, interpretiveGuideUrl, accessDeniedUrl, landingPageUrl, irisVendorId, minItemDataYear, percentileDisplayEnabled, reportLanguages, schoolYear, state, transferAccessEnabled, translationLocation, uiLanguages, userGuideUrl, targetReport, studentFields, tenants);
    }
}
