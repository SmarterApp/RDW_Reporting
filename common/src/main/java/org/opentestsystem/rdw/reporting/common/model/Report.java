package org.opentestsystem.rdw.reporting.common.model;

import com.fasterxml.jackson.annotation.JsonIgnore;
import org.opentestsystem.rdw.reporting.common.report.AbstractExamReportRequest;

import java.net.URI;
import java.time.Instant;

/**
 * The model represents the request, generation, and current status of a report.
 */
public class Report {
    private Long id;
    private String user;
    private Long jobExecutionId;
    private ReportStatus status;
    private URI reportResourceUri;
    private String label;
    private AbstractExamReportRequest reportRequest;
    private Instant created;

    /**
     * @return The report id
     */
    public Long getId() {
        return id;
    }

    /**
     * @return The report user
     */
    @JsonIgnore
    public String getUser() {
        return user;
    }

    /**
     * @return The job execution id or null if no associated job exists
     */
    @JsonIgnore
    public Long getJobExecutionId() {
        return jobExecutionId;
    }

    /**
     * @return The report generation status
     */
    public ReportStatus getStatus() {
        return status;
    }

    /**
     * @return The generated report uri or null if not generated
     */
    @JsonIgnore
    public URI getReportResourceUri() {
        return reportResourceUri;
    }

    /**
     * @return The report label
     */
    public String getLabel() {
        return label;
    }

    /**
     * @return The report request parameters
     */
    @JsonIgnore
    public AbstractExamReportRequest getReportRequest() {
        return reportRequest;
    }

    /**
     * @return The report request submission date-time
     */
    public Instant getCreated() {
        return created;
    }

    /**
     * @return A Builder initialized with this Report's values.
     */
    public Builder copy() {
        return new Builder().copy(this);
    }

    /**
     * @return An empty builder instance
     */
    public static Builder builder() {
        return new Builder();
    }

    public static class Builder {
        private Long id;
        private String user;
        private Long jobExecutionId;
        private ReportStatus status;
        private URI reportResourceUri;
        private String label;
        private AbstractExamReportRequest<?> reportRequest;
        private Instant created;

        public Report build() {
            final Report report = new Report();
            report.id = id;
            report.user = user;
            report.jobExecutionId = jobExecutionId;
            report.status = status;
            report.reportResourceUri = reportResourceUri;
            report.label = label;
            report.reportRequest = reportRequest;
            report.created = created;

            return report;
        }

        public Builder copy(final Report report) {
            id(report.getId());
            user(report.getUser());
            jobExecutionId(report.getJobExecutionId());
            status(report.getStatus());
            reportResourceUri(report.getReportResourceUri());
            label(report.getLabel());
            reportRequest(report.getReportRequest());
            created(report.getCreated());

            return this;
        }

        public Builder id(final Long id) {
            this.id = id;
            return this;
        }

        public Builder user(final String user) {
            this.user = user;
            return this;
        }

        public Builder jobExecutionId(final Long jobExecutionId) {
            this.jobExecutionId = jobExecutionId;
            return this;
        }

        public Builder status(final ReportStatus status) {
            this.status = status;
            return this;
        }

        public Builder reportResourceUri(final URI reportResourceUri) {
            this.reportResourceUri = reportResourceUri;
            return this;
        }

        public Builder label(final String label) {
            this.label = label;
            return this;
        }

        public Builder reportRequest(final AbstractExamReportRequest<?> reportRequest) {
            this.reportRequest = reportRequest;
            return this;
        }

        public Builder created(final Instant created) {
            this.created = created;
            return this;
        }
    }
}
