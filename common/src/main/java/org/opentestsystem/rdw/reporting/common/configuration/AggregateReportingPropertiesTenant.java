package org.opentestsystem.rdw.reporting.common.configuration;

import com.fasterxml.jackson.annotation.JsonAlias;
import com.fasterxml.jackson.annotation.JsonFormat;
import com.fasterxml.jackson.annotation.JsonInclude;
import com.google.common.base.Objects;

import java.util.Set;

/**
 * POJO for reading/writing aggregate reporting properties
 * <p>
 * The JsonAlias annotations make it so it will read properties using rules
 * that mimic Spring's relaxed binding. The JsonInclude annotation is needed
 * because at least one object mapper is configured to include null-only and
 * we need this to always include all elements.
 * </p>
 */
@JsonInclude(JsonInclude.Include.ALWAYS)
public class AggregateReportingPropertiesTenant implements AggregateReportingProperties {

    @JsonFormat(with = JsonFormat.Feature.ACCEPT_SINGLE_VALUE_AS_ARRAY)
    private Set<String> assessmentTypes;

    @JsonFormat(with = JsonFormat.Feature.ACCEPT_SINGLE_VALUE_AS_ARRAY)
    private Set<String> statewideUserAssessmentTypes;

    @JsonFormat(with = JsonFormat.Feature.ACCEPT_SINGLE_VALUE_AS_ARRAY)
    private Set<String> stateAggregateAssessmentTypes;

    @Override
    public Set<String> getAssessmentTypes() {
        return assessmentTypes;
    }

    @JsonAlias({"assessment-types", "assessment_types"})
    public void setAssessmentTypes(final Set<String> values) {
        this.assessmentTypes = AggregateReportingProperties.toTypeSet(values);
    }

    @Override
    public Set<String> getStatewideUserAssessmentTypes() {
        return statewideUserAssessmentTypes;
    }

    @JsonAlias({"statewide-user-assessment-types", "statewide_user_assessment_types"})
    public void setStatewideUserAssessmentTypes(final Set<String> values) {
        this.statewideUserAssessmentTypes = AggregateReportingProperties.toTypeSet(values);
    }

    @Override
    public Set<String> getStateAggregateAssessmentTypes() {
        return stateAggregateAssessmentTypes;
    }

    @JsonAlias({"state-aggregate-assessment-types", "state_aggregate_assessment_types"})
    public void setStateAggregateAssessmentTypes(final Set<String> values) {
        this.stateAggregateAssessmentTypes = AggregateReportingProperties.toTypeSet(values);
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof AggregateReportingPropertiesTenant)) return false;
        AggregateReportingPropertiesTenant that = (AggregateReportingPropertiesTenant) o;
        return Objects.equal(assessmentTypes, that.assessmentTypes) &&
                Objects.equal(statewideUserAssessmentTypes, that.statewideUserAssessmentTypes) &&
                Objects.equal(stateAggregateAssessmentTypes, that.stateAggregateAssessmentTypes);
    }

    @Override
    public int hashCode() {
        return Objects.hashCode(assessmentTypes, statewideUserAssessmentTypes, stateAggregateAssessmentTypes);
    }
}
