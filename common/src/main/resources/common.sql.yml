sql:
  translation:
    findAllForNamespaceAndLanguage:
      select label_code, label
      from translation
      where namespace=:namespace
      and language_code=:language_code

  group:
    membership:
      findAllForUsername: >-
        select sg.id, sg.subject_id, sg.school_id
        from user_student_group usg
          join student_group sg on sg.id = usg.student_group_id
        where user_login=:user_login

  organization:
    reporting:
      findAll: >-
        SELECT
          district_group.id,
          district_group.name,
          district_group.natural_id,
          'DistrictGroup' as org_type,
          null as district_group_id,
          null as district_id,
          null as school_group_id
        FROM district_group
          JOIN school sch
            ON sch.district_group_id = district_group.id
        WHERE 1=:allow_district_group
          AND (:name_query IS NULL OR district_group.name LIKE concat('%', :name_query, '%'))
          AND (1=:statewide OR sch.district_group_id IN (:district_group_ids))
        UNION
        SELECT
          district.id,
          district.name,
          district.natural_id,
          'District' as org_type,
          sch.district_group_id,
          null as district_id,
          null as school_group_id
        FROM district
          JOIN school sch
            ON sch.district_id = district.id
        WHERE 1=:allow_district
          AND (:name_query IS NULL OR district.name LIKE concat('%', :name_query, '%'))
          AND (1=:statewide OR sch.district_group_id IN (:district_group_ids) OR sch.district_id IN (:district_ids))
        UNION
        SELECT
          school_group.id,
          school_group.name,
          school_group.natural_id,
          'SchoolGroup' as org_type,
          sch.district_group_id,
          sch.district_id,
          null as school_group_id
        FROM school_group
          JOIN school sch
            ON sch.school_group_id = school_group.id
        WHERE 1=:allow_school_group
          AND (:name_query IS NULL OR school_group.name LIKE concat('%', :name_query, '%'))
          AND (1=:statewide OR sch.district_group_id IN (:district_group_ids) OR sch.district_id IN (:district_ids) OR sch.school_group_id IN (:school_group_ids))
        UNION
        SELECT
          school.id,
          school.name,
          school.natural_id,
          'School' as org_type,
          school.district_group_id,
          school.district_id,
          school.school_group_id
        FROM school
        WHERE 1=:allow_school
          AND (:name_query IS NULL OR school.name LIKE concat('%', :name_query, '%'))
          AND (1=:statewide OR school.district_group_id IN (:district_group_ids) OR school.district_id IN (:district_ids) OR school.school_group_id IN (:school_group_ids) OR school.id IN (:school_ids))
        LIMIT :limit

      findOne: >-
        SELECT
          coalesce(dg.id, d.id, sg.id, s.id) as id,
          coalesce(dg.name, d.name, sg.name, s.name) as name,
          coalesce(dg.natural_id, d.natural_id, sg.natural_id, s.natural_id) as natural_id,
          coalesce(dg.type, d.type, sg.type, 'School') as org_type,
          sch.district_group_id as district_group_id,
          sch.district_id as district_id,
          sch.school_group_id
        FROM school sch
          LEFT JOIN
          (
            SELECT id, name, natural_id, 'DistrictGroup' as type
            FROM district_group
            WHERE 1=:allow_district_group
              AND id=:id
          ) as dg
            ON dg.id = sch.district_group_id
          LEFT JOIN
          (
            SELECT id, name, natural_id, 'District' as type
            FROM district
            WHERE 1=:allow_district
              AND id=:id
          ) as d
            ON d.id = sch.district_id
          LEFT JOIN
          (
            SELECT id, name, natural_id, 'SchoolGroup' as type
            FROM school_group
            WHERE 1=:allow_school_group
              AND id=:id
          ) as sg
            ON sg.id = sch.school_group_id
          LEFT JOIN school s
            ON 1=:allow_school
            AND s.id=:id
            AND s.id = sch.id
        WHERE
          (dg.id IS NOT NULL AND (1=:statewide OR sch.district_group_id IN (:district_group_ids)))
          OR
          (d.id IS NOT NULL AND (1=:statewide OR sch.district_group_id IN (:district_group_ids) OR sch.district_id IN (:district_ids)))
          OR
          (sg.id IS NOT NULL AND (1=:statewide OR sch.district_group_id IN (:district_group_ids) OR sch.district_id IN (:district_ids) OR sch.school_group_id IN (:school_group_ids)))
          OR
          (s.id IS NOT NULL AND (1=:statewide OR sch.district_group_id IN (:district_group_ids) OR sch.district_id IN (:district_ids) OR sch.school_group_id IN (:school_group_ids) OR sch.id IN (:school_ids)))
        LIMIT 1