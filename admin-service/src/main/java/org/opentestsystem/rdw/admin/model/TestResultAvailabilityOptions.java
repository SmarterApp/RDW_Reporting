package org.opentestsystem.rdw.admin.model;

import com.google.common.collect.ImmutableList;
import org.opentestsystem.rdw.reporting.common.model.Organization;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.List;

/**
 * This class encapsulates the current test results availability state for a single
 * district, school year, subject, and report type.
 */
public class TestResultAvailabilityOptions {

    private List<TestResultsStatus> statuses;     // All the statuses available to the user, sorted by enum order.
    private boolean viewAudit;                    // True if user has permission to view audits.
    private boolean districtAdmin;                // True for district administrator
    private Collection<Organization> districts;   // Collection of districts for district admins.

    public List<TestResultsStatus> getStatuses() {
        return statuses;
    }

    public boolean isViewAudit() {
        return viewAudit;
    }

    public boolean isDistrictAdmin() {
        return districtAdmin;
    }

    public Collection<Organization> getDistricts() {
        return districts;
    }

    /**
     * @return new builder with this instance's values
     */
    public Builder copy() {
        return builder().copy(this);
    }

    /**
     * @return new builder
     */
    public static Builder builder() {
        return new Builder();
    }

    public static class Builder {
        private List<TestResultsStatus> statuses;
        private boolean viewAudit;
        private boolean districtAdmin;
        private Collection<Organization> districts;

        public TestResultAvailabilityOptions build() {
            final TestResultAvailabilityOptions options = new TestResultAvailabilityOptions();

            Collections.sort(statuses);

            options.statuses = ImmutableList.copyOf(statuses);
            options.viewAudit = viewAudit;
            options.districtAdmin = districtAdmin;
            options.districts = ImmutableList.copyOf(districts);

            return options;
        }

        public Builder copy(final TestResultAvailabilityOptions options) {
            statuses = options.statuses;
            viewAudit = options.viewAudit;
            districtAdmin = options.districtAdmin;
            districts = options.districts;

            return this;
        }

        public Builder statuses(final Collection<TestResultsStatus> statuses) {
            this.statuses = new ArrayList<>(statuses);
            return this;
        }

        public Builder viewAudit(boolean viewAudit) {
            this.viewAudit = viewAudit;
            return this;
        }

        public Builder districtAdmin(boolean districtAdmin) {
            this.districtAdmin = districtAdmin;
            return this;
        }

        public Builder districts(final Collection<Organization> districts) {
            this.districts = districts;
            return this;
        }
    }
}
