package org.opentestsystem.rdw.admin.service.impl;

import org.opentestsystem.rdw.admin.model.PipelineScript;
import org.opentestsystem.rdw.admin.repository.PipelineScriptRepository;
import org.opentestsystem.rdw.admin.service.PipelineScriptService;
import org.opentestsystem.rdw.reporting.common.security.User;
import org.springframework.stereotype.Service;

import java.util.NoSuchElementException;
import java.util.Optional;

@Service
class DefaultPipelineScriptService implements PipelineScriptService {

    private final PipelineScriptRepository repository;

    DefaultPipelineScriptService(final PipelineScriptRepository repository) {
        this.repository = repository;
    }

    @Override
    public PipelineScript get(final int id) {
        return Optional.ofNullable(repository.findById(id))
                .orElseThrow(() -> new NoSuchElementException(String.format(
                        "Pipeline script with ID \"%s\" does not exist",
                        id
                )));
    }

    @Override
    public PipelineScript create(final User user, final PipelineScript script) {
        return repository.create(
                script.copy()
                        .updatedBy(user.getUsername())
                        .build()
        );
    }

    @Override
    public PipelineScript update(final User user, final PipelineScript script) {
        return repository.update(
                script.copy()
                        .updatedBy(user.getUsername())
                        .build()
        );
    }

}
