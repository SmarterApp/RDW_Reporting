package org.opentestsystem.rdw.admin.model;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.HashSet;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import java.util.Set;

import javafx.scene.shape.Arc;
import org.opentestsystem.rdw.archive.ArchivePropertiesRoot;
import org.opentestsystem.rdw.archive.ArchivePropertiesTenant;
import org.opentestsystem.rdw.multitenant.Tenant;
import org.opentestsystem.rdw.multitenant.datasource.DataSourceElementsProperties;
import org.opentestsystem.rdw.multitenant.datasource.DataSourceElementsTenant;
import org.opentestsystem.rdw.multitenant.datasource.DataSourceUrlParts;
import org.opentestsystem.rdw.reporting.common.configuration.AggregateReportingPropertiesRoot;
import org.opentestsystem.rdw.reporting.common.configuration.AggregateReportingPropertiesTenant;
import org.opentestsystem.rdw.reporting.common.configuration.ReportingSystemProperties;
import org.opentestsystem.rdw.reporting.common.configuration.ReportingSystemPropertiesImpl;
import org.opentestsystem.rdw.reporting.common.configuration.ReportingSystemSettings;
import org.opentestsystem.rdw.reporting.common.model.SearchFieldPermissionLevel;
import org.opentestsystem.rdw.reporting.common.model.StudentFieldType;

/**
 * Used to serve up a mock data for default ApplicationTenantConfiguration
 * and a couple of TenantConfiguration
 *
 *   TODO move to test once api calls are functional
 */
public class TenantConfigurationStubs {


    // Basic Default tenant application information
    public static ApplicationTenantConfiguration getMockDefaultApplicationTenantConfiguration() {
        ApplicationTenantConfiguration applicationTenantConfiguration = new ApplicationTenantConfiguration();
        applicationTenantConfiguration.setReporting(getReportingDefaults());
        applicationTenantConfiguration.setDataSources(getDatasources());
        applicationTenantConfiguration.setArchiveProperties(getArchivePropertiesTenant());
        applicationTenantConfiguration.setAggregateReportingPropertiesTenant(getAggregrateReportingProperties());
        return applicationTenantConfiguration;
    }

    public static  AggregateReportingPropertiesTenant getAggregrateReportingProperties() {
        AggregateReportingPropertiesTenant aggregateReportingProperties = new AggregateReportingPropertiesTenant();
        Set<String> assessmentTypes = new HashSet<>();
        assessmentTypes.add("ica");
        assessmentTypes.add("sum");
        assessmentTypes.add("iab");
        aggregateReportingProperties.setAssessmentTypes(assessmentTypes);
        Set<String> assessments = new HashSet<>();
        assessmentTypes.add("sum");
        aggregateReportingProperties.setStateAggregateAssessmentTypes(assessments);
        aggregateReportingProperties.setStatewideUserAssessmentTypes(assessments);
        return aggregateReportingProperties;
    }

    // Default properties for Archive
    public static  ArchivePropertiesTenant getArchivePropertiesTenant() {
        ArchivePropertiesTenant archivePropertiesTenant = new ArchivePropertiesTenant();
        archivePropertiesTenant.setPathPrefix("s3://default-archive");
        archivePropertiesTenant.setS3AccessKey("default-accessKey");
        archivePropertiesTenant.setPathPrefix(""); // empty path default
        archivePropertiesTenant.setS3RegionStatic("us-west-2");
        archivePropertiesTenant.setS3Sse("def-sse");
        return archivePropertiesTenant;
    }

    // Defaults DataSource elements - for all dataSources
    public static Map<String, DataSourceElementsTenant> getDatasources () {
        Map<String, DataSourceElementsTenant> datasources = new LinkedHashMap<>();
        DataSourceElementsTenant dataSource = new DataSourceElementsTenant();
        dataSource.setUrl("jdbc:mysql://host.docker.internal:3306/not_a_schema?useSSL=false&useLegacyDatetimeCode=false&characterEncoding=utf8&rewriteBatchedStatements=true&connectTimeout=10000&socketTimeout=40000");
        datasources.put("reporting_ro", dataSource);

        DataSourceElementsTenant dataRWSource = new DataSourceElementsTenant();
        dataRWSource.setUrl("jdbc:mysql://host.docker.internal:3306/not_a_schema?useSSL=false&useLegacyDatetimeCode=false&characterEncoding=utf8&rewriteBatchedStatements=true&useCompression=true&connectTimeout=10000&socketTimeout=40000");
        datasources.put("warehouse_rw", dataRWSource);

        DataSourceElementsTenant dataOlapSource = getDefaultDatasource();
        dataOlapSource.setUrl("\"jdbc:mysql://host.docker.internal:3306/not_a_schema\"?useSSL=false&useLegacyDatetimeCode=false&characterEncoding=utf8&rewriteBatchedStatements=true&connectTimeout=10000&socketTimeout=40000");
        datasources.put("olap_ro", dataOlapSource);

        DataSourceElementsTenant dataDWhSource = getDefaultDatasource();
        dataDWhSource.setUrl("jdbc:mysql://host.docker.internal:3306/not_a_schema?useSSL=false&useLegacyDatetimeCode=false&characterEncoding=utf8&connectTimeout=10000&socketTimeout=70000");
        datasources.put("reporting_rw", dataDWhSource);

        return datasources;
    }

    public static DataSourceElementsTenant getDefaultDatasource() {
        DataSourceElementsTenant dataSource = new DataSourceElementsTenant();
        dataSource.setInitialSize(1);
        dataSource.setMaxActive(2);
        dataSource.setUrl("rdw-aurora-");
        dataSource.setUsername("sbac");
        dataSource.setPassword("****");
        dataSource.setDriverClassName("driver class Name");
        dataSource.setJdbcInterceptors("jdbc Interceptors");
        dataSource.setLogAbandoned(false);
        dataSource.setMaxIdle(1000);
        dataSource.setMinIdle(10);
        dataSource.setRemoveAbandoned(true);
        dataSource.setTestWhileIdle(true);
        dataSource.setRemoveAbandonedTimeout(100);
        DataSourceUrlParts dataSourceUrlParts = new DataSourceUrlParts();
        dataSourceUrlParts.setDatabase("reporting");
        return dataSource;
    }

    //  Defaults for Reporting that is matching localhost /api/settings
    public static  ReportingSystemPropertiesImpl getReportingDefaults() {
        ReportingSystemPropertiesImpl  reporting = new  ReportingSystemPropertiesImpl();

        reporting.setSchoolYear(2019);
        reporting.setTransferAccessEnabled(false);
        reporting.setAccessDeniedUrl("forward:/assets/public/access-denied.html");
        reporting.setAnalyticsTrackingId("UA-102446884-4");
        reporting.setUserGuideUrl("https://portal.smarterbalanced.org/library/en/reporting-system-user-guide.pdf");
        reporting.setInterpretiveGuideUrl("https://portal.smarterbalanced.org/library/en/reporting-system-interpretive-guide.pdf");
        reporting.setPercentileDisplayEnabled(false);
        reporting.setIrisVendorId("2B3C34BF-064C-462A-93EA-41E9E3EB8333");
        reporting.setLandingPageUrl("forward:/landing.html");
        List<String> languages = new ArrayList<>();
        languages.add("en");
        reporting.setReportLanguages(languages);
        reporting.setUiLanguages(new ArrayList<>());

        return reporting;
    }

    //  Defaults for Reporting
    public static  ReportingSystemPropertiesImpl getReporting() {
        ReportingSystemPropertiesImpl  reporting = new  ReportingSystemPropertiesImpl();
        reporting.setSchoolYear(2018);
        reporting.setTransferAccessEnabled(true);
        reporting.setAccessDeniedUrl("forward:/assets/public/access-denied.html");
        reporting.setAnalyticsTrackingId("UA-102446884-42");
        reporting.setUserGuideUrl("https://portal.smarterbalanced.org/library/en/reporting-system-user-guide.pdf");
        reporting.setInterpretiveGuideUrl("https://portal.smarterbalanced.org/library/en/reporting-system-interpretive-guide.pdf");
        reporting.setPercentileDisplayEnabled(true);
        reporting.setIrisVendorId("2B3C34BF-064C-462A-93EA-41E9E3EB8332");
        reporting.setLandingPageUrl("forward:/landing.html");
        reporting.setTranslationLocation("sdlangtranslation");
        List<String> languages = new ArrayList<>();
        languages.add("en");
        reporting.setReportLanguages(languages);
        ReportingSystemProperties.StateProperties state = new ReportingSystemProperties.StateProperties();
        state.setName("California");
        state.setCode("CA");
        reporting.setState(state);
        List<String> uiLanguages = new ArrayList<>();
        uiLanguages.add("en");
        reporting.setUiLanguages(uiLanguages);

        reporting.setStudentFields(getStudentFields());
        return reporting;
    }

    // TenantConfiguration  Mocks
    public static TenantConfiguration createMockTenantCA() {
        TenantConfiguration tenantConfiguration = new TenantConfiguration();

        ArchivePropertiesTenant archivePropertiesTenant = getArchivePropertiesTenant();
        archivePropertiesTenant.setPathPrefix("ca");
        archivePropertiesTenant.setUriRoot("s3://ca-archive");

        ReportingSystemPropertiesImpl reporting = getCAReportingSystemPropertiesImpl();

        List<String> uiLanguages = new ArrayList<>();
        uiLanguages.add("en");
        reporting.setUiLanguages(uiLanguages);

        AggregateReportingPropertiesTenant aggregateReportingProperties = new AggregateReportingPropertiesTenant();
        Set<String> assessments = new HashSet<>();
        assessments.add("iab");
        assessments.add("sum");
        aggregateReportingProperties.setStateAggregateAssessmentTypes(assessments);
        aggregateReportingProperties.setStatewideUserAssessmentTypes(assessments);

        reporting.setStudentFields(getStudentFields());

        return getTenantConfiguration(tenantConfiguration, getTenantCA(), getCAReportingSystemPropertiesImpl(),
                getCADataSources(), getCALocalization(),
                archivePropertiesTenant, aggregateReportingProperties);
    }

    public static Optional<DataSourceElementsProperties> getDataSourceElementsProperties() {
        DataSourceElementsProperties dataSourceElementsProperties = new DataSourceElementsProperties();
        Map<String, DataSourceElementsTenant> datasources = new LinkedHashMap<>();
        DataSourceElementsTenant dataSource = new DataSourceElementsTenant();
        dataSource.setUrl("CA/reporting");
        datasources.put("CA", dataSource);
        DataSourceElementsTenant dataSourceNv = new DataSourceElementsTenant();
        dataSourceNv.setUrl("NV/reporting");
        datasources.put("NV", dataSource);
        dataSourceElementsProperties.setTenants(datasources);
        return Optional.of(dataSourceElementsProperties);
    }

    public static Optional<DataSourceElementsProperties> getDataSourceWHElementsProperties() {
        DataSourceElementsProperties dataSourceElementsProperties = new DataSourceElementsProperties();
        Map<String, DataSourceElementsTenant> datasources = new LinkedHashMap<>();
        DataSourceElementsTenant dataSource = new DataSourceElementsTenant();
        dataSource.setUrl("CA/warehouse");
        datasources.put("CA", dataSource);
        DataSourceElementsTenant dataSourceNv = new DataSourceElementsTenant();
        dataSourceNv.setUrl("NV/warehouse");
        datasources.put("NV", dataSource);
        dataSourceElementsProperties.setTenants(datasources);
        return Optional.of(dataSourceElementsProperties);
    }

    public static Optional<DataSourceElementsProperties> getDataSourceRWElementsProperties() {
        DataSourceElementsProperties dataSourceElementsProperties = new DataSourceElementsProperties();
        Map<String, DataSourceElementsTenant> datasources = new LinkedHashMap<>();
        DataSourceElementsTenant dataSource = new DataSourceElementsTenant();
        dataSource.setUrl("CA/reporting-rw");
        datasources.put("CA", dataSource);
        DataSourceElementsTenant dataSourceNv = new DataSourceElementsTenant();
        dataSourceNv.setUrl("NV/reporting-rw");
        datasources.put("NV", dataSource);
        dataSourceElementsProperties.setTenants(datasources);
        return Optional.of(dataSourceElementsProperties);
    }

    public static Optional<DataSourceElementsProperties> getDataSourceOlapElementsProperties() {
        DataSourceElementsProperties dataSourceElementsProperties = new DataSourceElementsProperties();
        Map<String, DataSourceElementsTenant> datasources = new LinkedHashMap<>();
        DataSourceElementsTenant dataSource = new DataSourceElementsTenant();
        dataSource.setUrl("CA/olap");
        datasources.put("CA", dataSource);
        DataSourceElementsTenant dataSourceNv = new DataSourceElementsTenant();
        dataSourceNv.setUrl("NV/olap");
        datasources.put("NV", dataSource);
        dataSourceElementsProperties.setTenants(datasources);
        return Optional.of(dataSourceElementsProperties);
    }

    private static Map<String, DataSourceElementsTenant> getCADataSources() {
        Map<String, DataSourceElementsTenant> datasourcesMap = new HashMap<>();
        DataSourceElementsTenant dataSourceRep = new DataSourceElementsTenant();
        dataSourceRep.setInitialSize(10);
        dataSourceRep.setMaxActive(10);
        datasourcesMap.put("reporting_ro", dataSourceRep);

        DataSourceElementsTenant dataSourceWh  = new DataSourceElementsTenant();
        dataSourceWh.setInitialSize(3);
        dataSourceWh.setMaxActive(4);
        datasourcesMap.put("warehouse_rw", dataSourceWh);

        DataSourceElementsTenant dataSourceOl = new DataSourceElementsTenant();
        dataSourceOl.setInitialSize(4);
        dataSourceOl.setMaxActive(4);
        datasourcesMap.put("olap_ro", dataSourceOl);
        return datasourcesMap;
    }

    private static Map<StudentFieldType, SearchFieldPermissionLevel>  getStudentFields() {
        Map<StudentFieldType, SearchFieldPermissionLevel> studentFields = new HashMap<>();
        studentFields.put(StudentFieldType.EconomicDisadvantage, SearchFieldPermissionLevel.Disabled);
        studentFields.put(StudentFieldType.LimitedEnglishProficiency, SearchFieldPermissionLevel.Disabled);
        studentFields.put(StudentFieldType.MigrantStatus, SearchFieldPermissionLevel.Enabled);
        studentFields.put(StudentFieldType.EnglishLanguageAcquisitionStatus, SearchFieldPermissionLevel.Enabled);
        studentFields.put(StudentFieldType.PrimaryLanguage, SearchFieldPermissionLevel.Enabled);
        studentFields.put(StudentFieldType.Ethnicity, SearchFieldPermissionLevel.Enabled);
        studentFields.put(StudentFieldType.Gender, SearchFieldPermissionLevel.Admin);
        studentFields.put(StudentFieldType.IndividualEducationPlan, SearchFieldPermissionLevel.Admin);
        studentFields.put(StudentFieldType.Section504, SearchFieldPermissionLevel.Admin);
        return studentFields;
    }
    public static Tenant getTenantCA() {
        Tenant tenant = new Tenant();
        tenant.setId("CA");
        tenant.setKey("CA");
        tenant.setName("California");
        tenant.setDescription("This is a CA description");
        return tenant;
    }

    public static Tenant getTenantNV() {
        Tenant tenant = new Tenant();
        tenant.setId("NV");
        tenant.setKey("NV");
        tenant.setName("Nevada");
        tenant.setDescription("This is a Nevada description");
        return tenant;
    }

    public static AggregateReportingPropertiesTenant getCAAggregateReportingProperties() {
        AggregateReportingPropertiesTenant aggregationProperties = new AggregateReportingPropertiesTenant();
        Set<String> assessments = new HashSet<>();
        assessments.add("ica");
        assessments.add("sum");
        aggregationProperties.setAssessmentTypes(assessments);
        return aggregationProperties;
    }

    public static Optional<AggregateReportingPropertiesRoot> getAggregateReportingPropertiesRoot() {
        AggregateReportingPropertiesRoot aggregateReportingPropertiesRoot = new AggregateReportingPropertiesRoot();
        AggregateReportingPropertiesTenant aggregationProperties = getAggregrateReportingProperties();
        aggregateReportingPropertiesRoot.setAssessmentTypes(aggregationProperties.getAssessmentTypes());
        aggregateReportingPropertiesRoot.setStateAggregateAssessmentTypes(aggregationProperties.getStateAggregateAssessmentTypes());
        aggregateReportingPropertiesRoot.setStatewideUserAssessmentTypes(aggregationProperties.getStatewideUserAssessmentTypes());
        Map<String, AggregateReportingPropertiesTenant> aggregatePropertiesMap = new HashMap<>();
        aggregatePropertiesMap.put("CA", getCAAggregateReportingProperties());
        aggregateReportingPropertiesRoot.setTenants((HashMap<String, AggregateReportingPropertiesTenant>) aggregatePropertiesMap);
        return Optional.of(aggregateReportingPropertiesRoot);
    }

    public static ReportingSystemPropertiesImpl getCAReportingSystemPropertiesImpl() {
        ReportingSystemPropertiesImpl reporting = new ReportingSystemPropertiesImpl();
        reporting.setSchoolYear(2019);
        reporting.setPercentileDisplayEnabled(false);
        ReportingSystemProperties.StateProperties state = new ReportingSystemProperties.StateProperties();
        state.setCode("CA");
        state.setName("California");
        reporting.setState(state);
        return reporting;
    }

    public static Optional<ArchivePropertiesRoot> getArchivePropertiesRoot(){
        ArchivePropertiesRoot archivePropertiesRoot = new ArchivePropertiesRoot();
        Map<String, ArchivePropertiesTenant> reportingMap = new HashMap<>();
        ArchivePropertiesTenant archivePropertiesTenant = getArchivePropertiesTenant();
        reportingMap.put("CA", archivePropertiesTenant);
        archivePropertiesRoot.setTenants(reportingMap);
        return Optional.of(archivePropertiesRoot);
    }
    public static Optional<ReportingSystemSettings> getReportingSystemSettings() {
        ReportingSystemSettings reportingSystemSettings = new ReportingSystemSettings();
        Map<String, ReportingSystemPropertiesImpl> reportingMap = new HashMap<>();
        reportingMap.put("CA", getCAReportingSystemPropertiesImpl());
        reportingSystemSettings.setTenants(reportingMap);

        reportingSystemSettings.setSchoolYear(2018);
        reportingSystemSettings.setTransferAccessEnabled(true);
        reportingSystemSettings.setAccessDeniedUrl("forward:/assets/public/access-denied.html");
        reportingSystemSettings.setAnalyticsTrackingId("UA-102446885-90");
        reportingSystemSettings.setUserGuideUrl("https://portal.smarterbalanced.org/library/en/reporting-system-user-guide.pdf");
        reportingSystemSettings.setInterpretiveGuideUrl("https://portal.smarterbalanced.org/library/en/reporting-system-interpretive-guide.pdf");
        reportingSystemSettings.setPercentileDisplayEnabled(true);
        reportingSystemSettings.setIrisVendorId("2B3C34BF-064C-462A-93EA-41E9E3EB8332");
        reportingSystemSettings.setLandingPageUrl("forward:/landing.html");
        reportingSystemSettings.setTranslationLocation("forward:/someNewplaceLanding.html");
        List<String> languages = new ArrayList<>();
        languages.add("en");
        reportingSystemSettings.setReportLanguages(languages);
        ReportingSystemProperties.StateProperties state = new ReportingSystemProperties.StateProperties();
        state.setName("California");
        state.setCode("CA");
        reportingSystemSettings.setState(state);

        reportingSystemSettings.setStudentFields(getStudentFields());
        return Optional.of(reportingSystemSettings);
    }

    public static TenantConfiguration createMockTenantNV() {
        TenantConfiguration tenantConfiguration = new TenantConfiguration();

        ArchivePropertiesTenant archivePropertiesTenant = getArchivePropertiesTenant();
        archivePropertiesTenant.setPathPrefix("nv");
        archivePropertiesTenant.setUriRoot("s3://nv-archive");

        Map<String, DataSourceElementsTenant> datasourcesMap = new LinkedHashMap<>();
        DataSourceElementsTenant dataSourceRep = new DataSourceElementsTenant();
        dataSourceRep.setInitialSize(3);
        dataSourceRep.setMaxActive(3);
        datasourcesMap.put("reporting_ro", dataSourceRep);

        DataSourceElementsTenant dataSourceWh  = new DataSourceElementsTenant();
        dataSourceWh.setInitialSize(4);
        dataSourceWh.setMaxActive(8);
        datasourcesMap.put("warehouse_rw", dataSourceWh);

        DataSourceElementsTenant dataSourceOl = new DataSourceElementsTenant();
        dataSourceOl.setInitialSize(5);
        dataSourceOl.setMaxActive(5);
        datasourcesMap.put("olap_ro", dataSourceOl);

        ReportingSystemPropertiesImpl reporting = new ReportingSystemPropertiesImpl();
        reporting.setSchoolYear(2019);
        reporting.setTransferAccessEnabled(false);
        ReportingSystemProperties.StateProperties state = new ReportingSystemProperties.StateProperties();
        state.setCode("NV");
        state.setName("Nevada");
        reporting.setState(state);

        AggregateReportingPropertiesTenant aggregateReportingProperties = new AggregateReportingPropertiesTenant();
        Set<String> assessments = new HashSet<>();
        assessments.add("ica");
        assessments.add("sum");
        aggregateReportingProperties.setStateAggregateAssessmentTypes(assessments);
        aggregateReportingProperties.setStatewideUserAssessmentTypes(assessments);

        return getTenantConfiguration(tenantConfiguration, getTenantNV(), reporting, datasourcesMap,getNVLocalization(),
                archivePropertiesTenant, aggregateReportingProperties);
    }

    // create a tenantConfiguration that can be used to create and update a tenant
    private static TenantConfiguration getTenantConfiguration(TenantConfiguration tenantConfiguration,
                                                              Tenant tenant,
                                                              ReportingSystemPropertiesImpl reporting,
                                                              Map<String, DataSourceElementsTenant> datasourcesMap,
                                                              String localization,
                                                              ArchivePropertiesTenant archivePropertiesTenant,
                                                              AggregateReportingPropertiesTenant aggregateReportingProperties) {
        tenantConfiguration.setTenant(tenant);
        tenantConfiguration.setLocalization(localization);
        ApplicationTenantConfiguration applicationTenantConfiguration = new ApplicationTenantConfiguration();
        applicationTenantConfiguration.setReporting(reporting);
        applicationTenantConfiguration.setDataSources(datasourcesMap);
        applicationTenantConfiguration.setArchiveProperties(archivePropertiesTenant);
        applicationTenantConfiguration.setAggregateReportingPropertiesTenant(aggregateReportingProperties);
        tenantConfiguration.setApplicationTenantConfiguration(applicationTenantConfiguration);

        return tenantConfiguration;
    }

    public static String getCALocalization() {
        return "{" +
                "  \"common\" : {" +
                "    \"ethnicity\": {" +
                "      \"AmericanIndianOrAlaskaNative\": \"American Indian or Alaska Native\"," +
                "      \"Asian\": \"Asian\"," +
                "      \"BlackOrAfricanAmerican\": \"Black or African American\"," +
                "      \"DemographicRaceTwoOrMoreRaces\": \"Demographic Race of Two or More\"," +
                "      \"Filipino\": \"Filipino\"," +
                "      \"HispanicOrLatinoEthnicity\": \"Hispanic/Latino\"," +
                "      \"NativeHawaiianOrOtherPacificIslander\": \"Native Hawaiian or Pacific Islander\"," +
                "      \"White\": \"White\"" +
                "    }," +
                "    \"gender\": {" +
                "\t    \"Female\": \"Female\"," +
                "\t    \"Male\": \"Male\"," +
                "\t    \"Nonbinary\": \"Nonbinary\"," +
                "\t    \"undefined\": \"Not Stated\"" +
                "\t  }" +
                "\t}" +
                "}";
    }

    public static String getNVLocalization() {
        return "{" +
                "  \"common\" : {" +
                "    \"military-connected-code\": {" +
                "      \"ActiveDuty\": \"Active Duty\"," +
                "      \"NotMilitaryConnected\": \"Not Military Connected\"," +
                "      \"NationalGuardOrReserve\": \"National Guard Or Reserve\"," +
                "      \"Yes\": \"Yes\"," +
                "      \"No\": \"No\"" +
                "    }" +
                "  }" +
                "}";
    }
}
