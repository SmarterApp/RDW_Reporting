package org.opentestsystem.rdw.admin.multitenant.service;

import org.opentestsystem.rdw.admin.multitenant.administration.TenantAdministrationStatus;
import org.opentestsystem.rdw.admin.multitenant.model.TenantConfiguration;
import org.opentestsystem.rdw.admin.multitenant.DataSet;
import org.opentestsystem.rdw.admin.multitenant.TenantType;
import org.springframework.security.access.prepost.PreAuthorize;

import java.util.List;
import java.util.Optional;
import java.util.Set;

/**
 * Implementation of this service is responsible for management actions of a Tenant
 */
public interface TenantService {

    /**
     * Retrieve the default application information and a list of tenants and their configurations.
     * If there are no tenants configured, only the default information is returned.
     *
     * @return The Default information and a list of all existing tenants for this Instance
     */
    @PreAuthorize("hasAuthority('PERM_TENANT_READ')")
    Set<TenantConfiguration> getAll(TenantType tenantType);

    /**
     * Tests whether or not a tenant exists for the given key
     *
     * @param tenantKey The tenant key to check
     * @return True if a tenant exists for the provided key
     */
    @PreAuthorize("hasAuthority('PERM_TENANT_READ')")
    boolean exists(String tenantKey);

    /**
     * Tests whether or not a tenant exists for the given key
     *
     * @param tenantId The tenant id to check
     * @return True if a tenant exists for the provided id
     */
    @PreAuthorize("hasAuthority('PERM_TENANT_READ')")
    boolean existsId(String tenantId);

    @PreAuthorize("hasAuthority('PERM_TENANT_READ')")
    Optional<TenantConfiguration> findActiveTenantConfigurationByKey(String tenantKey);

    /**
     * Create a new tenant on this instance
     *
     * @param TenantConfiguration the new tenant to create
     */
    @PreAuthorize("hasAuthority('PERM_TENANT_WRITE')")
    void createTenant(TenantConfiguration TenantConfiguration);

    /**
     * Updates the existing tenant's configuration
     *
     * @param tenantConfiguration The updated tenant Configuration to save
     */
    @PreAuthorize("hasAuthority('PERM_TENANT_WRITE')")
    void updateTenant(TenantConfiguration tenantConfiguration);

    /**
     * This method hard-delete a sandbox however, it will only soft-delete or archive a Tenant
     *
     * @param tenantKey the tenantId to remove
     */
    @PreAuthorize("hasAuthority('PERM_TENANT_WRITE')")
    void deleteTenant(String tenantKey);

    /**
     * @return a list of available dataSets for a Sandbox creation, an empty list is valid
     */
    @PreAuthorize("hasAuthority('PERM_TENANT_READ')")
    List<DataSet> getSandboxDataSets();

    /**
     * @return a TenantConfiguration containing the default properties of the current tenant
     */
    @PreAuthorize("hasAuthority('PERM_TENANT_READ')")
    TenantConfiguration getTenantDefaults();

    /**
     * Updates the existing tenant's status
     *
     * @param tenantKey The tenant key
     */
    @PreAuthorize("hasAuthority('PERM_TENANT_WRITE')")
    void updateTenantStatus(String tenantKey, TenantAdministrationStatus status);

    /**
     * Removes the existing tenant's status
     *
     * @param tenantKey The tenant key
     */
    @PreAuthorize("hasAuthority('PERM_TENANT_WRITE')")
    void deleteTenantStatus(String tenantKey);

}
