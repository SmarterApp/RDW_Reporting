package org.opentestsystem.rdw.admin.multitenant.model;

import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.annotation.JsonRawValue;
import com.fasterxml.jackson.databind.annotation.JsonDeserialize;
import com.google.common.base.Objects;
import org.opentestsystem.rdw.admin.multitenant.administration.TenantAdministrationStatusContext;
import org.opentestsystem.rdw.admin.web.RawJsonDeserializer;
import org.opentestsystem.rdw.archive.ArchivePropertiesTenant;
import org.opentestsystem.rdw.multitenant.Tenant;
import org.opentestsystem.rdw.multitenant.datasource.DataSourceElementsTenant;
import org.opentestsystem.rdw.multitenant.task.ArtClientPropertiesTenant;
import org.opentestsystem.rdw.multitenant.task.ImportServiceClientPropertiesTenant;
import org.opentestsystem.rdw.multitenant.task.SendReconciliationReportPropertiesTenant;
import org.opentestsystem.rdw.multitenant.validation.ExamProcessorValidationPropertiesTenant;
import org.opentestsystem.rdw.reporting.common.configuration.AggregateReportingPropertiesTenant;
import org.opentestsystem.rdw.reporting.common.configuration.ReportingSystemPropertiesImpl;

import java.util.LinkedHashMap;
import java.util.Map;

/**
 * Unified model of all tenant configurable elements
 */
public class TenantConfiguration {

    private Tenant tenant;

    private String parentTenantKey;

    @JsonDeserialize(using = RawJsonDeserializer.class)
    @JsonRawValue
    private String localization;

    private TenantAdministrationStatusContext administrationStatus;

    private ReportingSystemPropertiesImpl reporting;

    @JsonProperty("datasources")
    private Map<String, DataSourceElementsTenant> dataSources = new LinkedHashMap<>();

    @JsonProperty("archive")
    private ArchivePropertiesTenant archiveProperties;

    @JsonProperty("aggregate")
    private AggregateReportingPropertiesTenant aggregateReportingProperties;

    private ExamProcessorValidationPropertiesTenant validation;

    private ArtClientPropertiesTenant artClient;

    private ImportServiceClientPropertiesTenant importServiceClient;

    private SendReconciliationReportPropertiesTenant sendReconciliationReport;

    public TenantConfiguration() {
    }

    /***
     * The configured tenant
     */
    public Tenant getTenant() {
        return tenant;
    }

    /***
     * The parent tenant key for sandboxes expected to be null for non-sandbox tenants
     */
    public String getParentTenantKey() {
        return parentTenantKey;
    }

    /**
     * Localization json literal
     */
    public String getLocalization() {
        return localization;
    }

    /**
     * Status of the tenant in the configuration process
     */
    public TenantAdministrationStatusContext getAdministrationStatus() {
        return administrationStatus;
    }

    /**
     * Reporting configuration.
     */
    public ReportingSystemPropertiesImpl getReporting() {
        return reporting;
    }

    /**
     * DataSource configuration.  Never directly configured for Sandboxes.
     */
    public Map<String, DataSourceElementsTenant> getDataSources() {
        return dataSources;
    }

    /**
     * Archive configuration.  Never directly configured for Sandboxes.
     */
    public ArchivePropertiesTenant getArchiveProperties() {
        return archiveProperties;
    }

    /**
     * Aggregate report configuration.
     */
    public AggregateReportingPropertiesTenant getAggregateReportingProperties() {
        return aggregateReportingProperties;
    }

    /**
     * Exam processor validation settings
     */
    public ExamProcessorValidationPropertiesTenant getValidation() {
        return validation;
    }

    /**
     * Organization sync task art client settings
     */
    public ArtClientPropertiesTenant getArtClient() {
        return artClient;
    }

    /**
     * Organization sync task import service settings
     */
    public ImportServiceClientPropertiesTenant getImportServiceClient() {
        return importServiceClient;
    }

    /**
     * Reconciliation report task settings
     */
    public SendReconciliationReportPropertiesTenant getSendReconciliationReport() {
        return sendReconciliationReport;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof TenantConfiguration)) return false;
        TenantConfiguration that = (TenantConfiguration) o;
        return Objects.equal(tenant, that.tenant) &&
                Objects.equal(parentTenantKey, that.parentTenantKey) &&
                Objects.equal(localization, that.localization) &&
                Objects.equal(administrationStatus, that.administrationStatus) &&
                Objects.equal(reporting, that.reporting) &&
                Objects.equal(dataSources, that.dataSources) &&
                Objects.equal(archiveProperties, that.archiveProperties) &&
                Objects.equal(aggregateReportingProperties, that.aggregateReportingProperties) &&
                Objects.equal(validation, that.validation) &&
                Objects.equal(artClient, that.artClient) &&
                Objects.equal(importServiceClient, that.importServiceClient) &&
                Objects.equal(sendReconciliationReport, that.sendReconciliationReport);
    }

    @Override
    public int hashCode() {
        return Objects.hashCode(tenant, parentTenantKey, localization, administrationStatus, reporting, dataSources, archiveProperties, aggregateReportingProperties, validation, artClient, importServiceClient, sendReconciliationReport);
    }

    public Builder copy() {
        return builder().copy(this);
    }

    public static Builder builder() {
        return new Builder();
    }

    public static class Builder {
        private Tenant tenant;
        private String parentTenantKey;
        private String localization;
        private TenantAdministrationStatusContext administrationStatus;
        private ReportingSystemPropertiesImpl reporting;
        private Map<String, DataSourceElementsTenant> dataSources = new LinkedHashMap<>();
        private ArchivePropertiesTenant archiveProperties;
        private AggregateReportingPropertiesTenant aggregateReportingProperties;
        private ExamProcessorValidationPropertiesTenant validation;
        private ArtClientPropertiesTenant artClient;
        private ImportServiceClientPropertiesTenant importServiceClient;
        private SendReconciliationReportPropertiesTenant sendReconciliationReport;

        public Builder tenant(final Tenant tenant) {
            this.tenant = tenant;
            return this;
        }

        public Builder parentTenantKey(final String parentTenantKey) {
            this.parentTenantKey = parentTenantKey;
            return this;
        }

        public Builder localizaton(final String localization) {
            this.localization = localization;
            return this;
        }

        public Builder administrationStatus(final TenantAdministrationStatusContext administrationStatus) {
            this.administrationStatus = administrationStatus;
            return this;
        }

        public Builder reporting(final ReportingSystemPropertiesImpl reporting) {
            this.reporting = reporting;
            return this;
        }

        public Builder dataSources(final Map<String, DataSourceElementsTenant> dataSources) {
            this.dataSources = dataSources;
            return this;
        }

        public Builder archiveProperties(final ArchivePropertiesTenant archiveProperties) {
            this.archiveProperties = archiveProperties;
            return this;
        }

        public Builder aggregateReportingProperties(final AggregateReportingPropertiesTenant aggregateReportingProperties) {
            this.aggregateReportingProperties = aggregateReportingProperties;
            return this;
        }

        public Builder validation(final ExamProcessorValidationPropertiesTenant validation) {
            this.validation = validation;
            return this;
        }

        public Builder artClient(final ArtClientPropertiesTenant artClient) {
            this.artClient = artClient;
            return this;
        }

        public Builder importServiceClient(final ImportServiceClientPropertiesTenant importServiceClient) {
            this.importServiceClient = importServiceClient;
            return this;
        }

        public Builder sendReconciliationReport(final SendReconciliationReportPropertiesTenant sendReconciliationReport) {
            this.sendReconciliationReport = sendReconciliationReport;
            return this;
        }

        public Builder copy(TenantConfiguration tenantConfiguration) {
            this.reporting = tenantConfiguration.reporting;
            this.tenant = tenantConfiguration.tenant;
            this.parentTenantKey = tenantConfiguration.parentTenantKey;
            this.localization = tenantConfiguration.localization;
            this.administrationStatus = tenantConfiguration.administrationStatus;
            this.dataSources = tenantConfiguration.dataSources;
            this.archiveProperties = tenantConfiguration.archiveProperties;
            this.aggregateReportingProperties = tenantConfiguration.aggregateReportingProperties;
            this.validation = tenantConfiguration.validation;
            this.artClient = tenantConfiguration.artClient;
            this.importServiceClient = tenantConfiguration.importServiceClient;
            this.sendReconciliationReport = tenantConfiguration.sendReconciliationReport;
            return this;
        }

        public TenantConfiguration build() {
            TenantConfiguration tenantConfiguration = new TenantConfiguration();
            tenantConfiguration.reporting = this.reporting;
            tenantConfiguration.tenant = this.tenant;
            tenantConfiguration.parentTenantKey = this.parentTenantKey;
            tenantConfiguration.localization = localization;
            tenantConfiguration.administrationStatus = this.administrationStatus;
            tenantConfiguration.dataSources = this.dataSources;
            tenantConfiguration.archiveProperties = this.archiveProperties;
            tenantConfiguration.aggregateReportingProperties = this.aggregateReportingProperties;
            tenantConfiguration.validation = this.validation;
            tenantConfiguration.artClient = this.artClient;
            tenantConfiguration.importServiceClient = this.importServiceClient;
            tenantConfiguration.sendReconciliationReport = this.sendReconciliationReport;
            return tenantConfiguration;
        }
    }
}
