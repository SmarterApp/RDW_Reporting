package org.opentestsystem.rdw.admin.service;

import org.opentestsystem.rdw.admin.model.ReportTemplateInfo;
import org.opentestsystem.rdw.common.model.AssessmentType;
import org.springframework.security.access.prepost.PreAuthorize;

import java.io.InputStream;
import java.io.OutputStream;
import java.util.List;

/**
 * Service responsible for managing report templates.
 */
@PreAuthorize("hasAuthority('PERM_ISR_TEMPLATE_WRITE')")
public interface ReportTemplateService {

    /**
     * Build the template name from the subject code and assessment type
     *
     * @param subjectCode subject code, e.g. "ELA"
     * @param assessmentType assessment type, e.g. "iab"
     * @return template (file) name, e.g. "ELA_iab.html"
     * @throws IllegalArgumentException if assessment type is invalid
     */
    static String templateName(String subjectCode, String assessmentType) {
        // check that assessment type is valid; fromCode will throw an IAE if not valid code
        //noinspection ResultOfMethodCallIgnored
        AssessmentType.fromCode(assessmentType);

        return subjectCode + "_" + assessmentType + ".html";
    }

    /**
     * @return list of template info for all subject/asmt combinations
     */
    List<ReportTemplateInfo> getTemplateInfo();

    /**
     * Download the template content for a given subject/asmt combination
     *
     * @param subjectCode subject code, e.g. "Math"
     * @param assessmentType assessment type, e.g. "ica"
     * @param os output stream to write template contents to
     */
    void download(String subjectCode, String assessmentType, OutputStream os);

    /**
     * Upload template contents for a given subject/asmt combination.
     * This will overwrite any existing template for the combination.
     *
     * @param subjectCode subject code, e.g. "Math"
     * @param assessmentType assessment type, e.g. "iab"
     * @param is input stream with template contents
     */
    void upload(String subjectCode, String assessmentType, InputStream is);

    /**
     * Delete the template for a given subject/asmt combination.
     * Quietly no-ops if there isn't a template for the given combination.
     *
     * @param subjectCode subject code, e.g. "ELA"
     * @param assessmentType assessment type, e.g. "sum"
     */
    void delete(String subjectCode, String assessmentType);
}
