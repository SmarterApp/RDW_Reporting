package org.opentestsystem.rdw.admin.service.impl;

import org.opentestsystem.rdw.admin.model.PipelineTest;
import org.opentestsystem.rdw.admin.repository.PipelineTestRepository;
import org.opentestsystem.rdw.admin.service.PipelineTestService;
import org.opentestsystem.rdw.reporting.common.security.User;
import org.springframework.stereotype.Service;

import java.util.NoSuchElementException;
import java.util.Optional;

@Service
class DefaultPipelineTestService implements PipelineTestService {

    private final PipelineTestRepository repository;

    DefaultPipelineTestService(final PipelineTestRepository repository) {
        this.repository = repository;
    }

    @Override
    public PipelineTest get(final int id) {
        return Optional.ofNullable(repository.findById(id))
                .orElseThrow(() -> new NoSuchElementException(String.format(
                        "Pipeline test with ID \"%s\" does not exist",
                        id
                )));
    }

    @Override
    public PipelineTest create(final User user, final PipelineTest test) {
        return repository.create(
                test.copy()
                        .updatedBy(user.getUsername())
                        .build()
        );
    }

    @Override
    public PipelineTest update(final User user, final PipelineTest test) {
        return repository.update(
                test.copy()
                        .updatedBy(user.getUsername())
                        .build()
        );
    }

    @Override
    public void delete(final int id) {
        repository.deleteById(id);
    }

}
