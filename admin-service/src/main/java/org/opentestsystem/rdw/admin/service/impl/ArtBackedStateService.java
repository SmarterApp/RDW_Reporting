package org.opentestsystem.rdw.admin.service.impl;

import org.codehaus.jackson.map.ObjectMapper;
import org.codehaus.jackson.type.TypeReference;
import org.opentestsystem.rdw.admin.model.State;
import org.opentestsystem.rdw.admin.service.StateService;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
class ArtBackedStateService implements StateService {

    private final ArtClient client;
    private final ObjectMapper mapper;

    ArtBackedStateService(
            final StateServiceArtClientProperties properties,
            final ObjectMapper mapper) {
        this.client = new ArtClient(properties);
        this.mapper = mapper;
    }

    @Override
    public List<State> getStates() {
        try {
            return mapper.readValue(client.getStates(), new TypeReference<List<State>>(){});
        } catch (final Exception exception) {
            throw new RuntimeException("Failed to read states from ART", exception);
        }
    }
}
