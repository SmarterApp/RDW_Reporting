package org.opentestsystem.rdw.admin.service;

import org.apache.commons.csv.CSVRecord;
import org.opentestsystem.rdw.security.PermissionScope;
import org.opentestsystem.rdw.admin.model.CsvValidationResult;

import java.util.Iterator;
import java.util.List;

/**
 * Implementations of this interface are responsible for validating
 * a CSV representation of a Student Group submission.
 */
public interface CsvValidationService {

    /**
     * Validate the given CSV's headers and return the collection
     * of validation failures.
     *
     * @param csvHeaders The ordered list of CSV headers
     * @return The list of validation failures, empty if valid
     */
    List<CsvValidationResult> validateHeaders(List<String> csvHeaders);

    /**
     * Validate the given CSV records and return the collection
     * of validation failures.
     *
     * @param recordIterator    CSV records
     * @param permissionScope   The authenticated user's permissions
     * @return The list of validation failures, empty if valid
     */
    List<CsvValidationResult> validateRecords(Iterator<CSVRecord> recordIterator, PermissionScope permissionScope);

    /**
     * Convert a collection of CSV validation failures into a single
     * truncated message string.
     *
     * @param failures A collection of CSV validation failures
     * @return A string representation of the failure messages
     */
    String toFailureMessage(List<CsvValidationResult> failures);

    /**
     * Convert a collection of CSV validation successes into a single
     * truncated message string.
     *
     * @param successes A collection of CSV validation successes
     * @return A string representation of the success messages
     */
    String toSuccessMessage(List<CsvValidationResult> successes);
}
