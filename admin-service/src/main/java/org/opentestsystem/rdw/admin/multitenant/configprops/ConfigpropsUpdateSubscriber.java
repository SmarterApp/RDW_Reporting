package org.opentestsystem.rdw.admin.multitenant.configprops;

import org.opentestsystem.rdw.multitenant.configprops.ConfigpropsProcessor;
import org.opentestsystem.rdw.multitenant.configprops.ConfigpropsUpdateMessage;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.cloud.stream.annotation.StreamListener;

public class ConfigpropsUpdateSubscriber {
    private static final Logger logger = LoggerFactory.getLogger(ConfigpropsUpdateSubscriber.class);

    private final ConfigpropsPublicationStorage storage;

    public ConfigpropsUpdateSubscriber(ConfigpropsPublicationStorage storage) {
        this.storage = storage;
    }

    @StreamListener(target = ConfigpropsProcessor.CONFIGPROPS_UPDATE_INPUT)
    public void configpropsUpdate(final ConfigpropsUpdateMessage configpropsUpdateMessage) {
        final String serviceName = configpropsUpdateMessage.getServiceName();
        final String configprops = configpropsUpdateMessage.getConfigprops();
        logger.debug("service: {} configprops: {}", serviceName, configprops);
        storage.putConfigprops(serviceName, configprops);
    }
}
