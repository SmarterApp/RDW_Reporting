package org.opentestsystem.rdw.admin.multitenant.administration.impl;

import org.junit.Before;
import org.junit.Test;
import org.opentestsystem.rdw.admin.multitenant.administration.TenantAdministrationStatus;
import org.opentestsystem.rdw.admin.multitenant.administration.TenantAdministrationStatusContext;
import org.opentestsystem.rdw.multitenant.Tenant;

import java.util.Optional;

import static org.assertj.core.api.Assertions.assertThat;

public class DefaultTenantAdministrationStatusServiceTest {

    private DefaultTenantAdministrationStatusService statusService;

    @Before
    public void setUp() {
        statusService = new DefaultTenantAdministrationStatusService();
    }

    @Test
    public void interactsAsExpected() {
        statusService.putStatus("AA", TenantAdministrationStatus.CREATE_STARTED, new Tenant());
        Optional<TenantAdministrationStatusContext> r1 = statusService.findStatus("AA");
        assertThat(r1.isPresent()).isTrue();
        assertThat(r1.get().getTenantAdministrationStatus()).isEqualTo(TenantAdministrationStatus.CREATE_STARTED);
        statusService.updateStatus("AA", TenantAdministrationStatus.CREATE_PERSISTING_CONFIGURATION);
        Optional<TenantAdministrationStatusContext> r2 = statusService.findStatus("AA");
        assertThat(r2.get().getTenantAdministrationStatus()).isEqualTo(TenantAdministrationStatus.CREATE_PERSISTING_CONFIGURATION);
        statusService.remove("AA");
        Optional<TenantAdministrationStatusContext> r3 = statusService.findStatus("AA");
        assertThat(r3).isEmpty();
    }

}