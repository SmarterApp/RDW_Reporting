package org.opentestsystem.rdw.admin.multitenant.administration.impl;

import org.apache.commons.lang3.tuple.Pair;
import org.junit.Before;
import org.junit.Test;
import org.opentestsystem.rdw.admin.multitenant.model.TenantConfiguration;
import org.opentestsystem.rdw.admin.multitenant.administration.TenantAdministrationStatus;

import java.util.Optional;

import static org.assertj.core.api.Assertions.assertThat;

public class GuavaCacheTenantAdministrationStatusServiceTest {

    private GuavaCacheTenantAdministrationStatusService statusService;

    @Before
    public void setUp() {
        statusService = new GuavaCacheTenantAdministrationStatusService(1000, 7);
    }

    @Test
    public void interactsAsExpected() {
        statusService.putStatus("AA", TenantAdministrationStatus.STARTED, new TenantConfiguration());
        Optional<Pair<TenantAdministrationStatus, TenantConfiguration>> r1 = statusService.findStatus("AA");
        assertThat(r1.isPresent()).isTrue();
        assertThat(r1.get().getLeft()).isEqualTo(TenantAdministrationStatus.STARTED);
        statusService.updateStatus("AA", TenantAdministrationStatus.PERSISTING_CONFIGURATION);
        Optional<Pair<TenantAdministrationStatus, TenantConfiguration>> r2 = statusService.findStatus("AA");
        assertThat(r2.get().getLeft()).isEqualTo(TenantAdministrationStatus.PERSISTING_CONFIGURATION);
        statusService.remove("AA");
        Optional<Pair<TenantAdministrationStatus, TenantConfiguration>> r3 = statusService.findStatus("AA");
        assertThat(r3).isEmpty();
    }

}