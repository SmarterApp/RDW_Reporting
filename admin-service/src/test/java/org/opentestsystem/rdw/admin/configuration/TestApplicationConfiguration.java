package org.opentestsystem.rdw.admin.configuration;

import org.opentestsystem.rdw.admin.ArchiveServiceConfiguration;
import org.opentestsystem.rdw.admin.multitenant.database.AdminSqlConfiguration;
import org.opentestsystem.rdw.multitenant.TenantIdResolver;
import org.opentestsystem.rdw.multitenant.TenantKeyResolver;
import org.opentestsystem.rdw.multitenant.TenantProperties;
import org.opentestsystem.rdw.reporting.common.configuration.ReportingSystemPropertiesResolver;
import org.opentestsystem.rdw.reporting.common.configuration.ReportingSystemSettings;
import org.opentestsystem.rdw.reporting.common.multitenant.ReportingTenantIdResolver;
import org.opentestsystem.rdw.script.ScriptPipelineConfiguration;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.Profile;

@Configuration
@Profile("test")
@EnableConfigurationProperties
@Import({
        ScriptPipelineConfiguration.class,
        ArchiveServiceConfiguration.class
})
public class TestApplicationConfiguration {

    @Bean
    public ReportingTenantIdResolver tenantIdResolver() {
        return new ReportingTenantIdResolver();
    }

    @Bean
    @ConfigurationProperties("reporting")
    public ReportingSystemSettings reportingSystemSettings() {
        return new ReportingSystemSettings();
    }

    @Bean
    @ConfigurationProperties("tenantProperties")
    public TenantProperties tenantProperties() {
        return new TenantProperties();
    }

    @Bean
    @ConfigurationProperties("sql.multitenantDatabaseAdmin")
    public AdminSqlConfiguration adminSqlConfiguration() {
        return new AdminSqlConfiguration();
    }

    @Bean
    public TenantKeyResolver tenantKeyResolver(TenantProperties tenantProperties,
                                               TenantIdResolver tenantIdResolver) {
        return new TenantKeyResolver(tenantProperties, tenantIdResolver);
    }

    @Bean
    ReportingSystemPropertiesResolver reportingSystemPropertiesResolver(TenantKeyResolver tenantKeyResolver,
                                                                        ReportingSystemSettings reportingSystemSettings) {
        return new ReportingSystemPropertiesResolver(tenantKeyResolver, reportingSystemSettings);
    }

}
