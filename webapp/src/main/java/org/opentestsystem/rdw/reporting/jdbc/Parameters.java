package org.opentestsystem.rdw.reporting.jdbc;

import com.google.common.collect.ImmutableList;
import com.google.common.collect.ImmutableMap;
import org.opentestsystem.rdw.reporting.security.GroupSecurityContext;
import org.opentestsystem.rdw.reporting.security.PermissionScope;

import java.util.List;
import java.util.Map;

import static org.opentestsystem.rdw.reporting.common.jdbc.Queries.nullOrEmptyToDefault;

public class Parameters {

    private static final List<Long> UNMATCHABLE_IDS = ImmutableList.of(-1L);

    private Parameters(){}

    public static Map<String, Object> getSecurityParameters(final GroupSecurityContext securityContext) {
        return ImmutableMap.<String, Object>builder()
                .put("group_id", securityContext.getGroupGrant().getId())
                .put("group_subject_id", securityContext.getGroupGrant().getSubjectId())
                .putAll(getSecurityParameters(securityContext.getPermissionScope()))
                .build();
    }

    public static Map<String, Object> getSecurityParameters(final PermissionScope permissionScope) {
        return ImmutableMap.<String, Object>builder()
                .put("statewide", permissionScope.isStatewide())
                .put("district_ids", nullOrEmptyToDefault(permissionScope.getDistrictIds(), UNMATCHABLE_IDS))
                .put("school_ids", nullOrEmptyToDefault(permissionScope.getInstitutionIds(), UNMATCHABLE_IDS))
                .build();
    }

}
