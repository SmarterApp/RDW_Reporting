package org.opentestsystem.rdw.reporting.security.sandbox;

import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.authentication.dao.AbstractUserDetailsAuthenticationProvider;
import org.springframework.security.core.AuthenticationException;
import org.springframework.security.core.userdetails.UserDetails;

public class SandboxAuthenticationProvider extends AbstractUserDetailsAuthenticationProvider {

    private final SandboxUserDetailsService userDetailsService;

    public SandboxAuthenticationProvider(final SandboxUserDetailsService userDetailsService) {
        this.userDetailsService = userDetailsService;
    }

    @Override
    protected void additionalAuthenticationChecks(
            final UserDetails userDetails,
            final UsernamePasswordAuthenticationToken authentication) throws AuthenticationException {
        // Security checks are performed by the user details service
    }

    @Override
    protected UserDetails retrieveUser(
            final String username,
            final UsernamePasswordAuthenticationToken authentication) throws AuthenticationException {

        return userDetailsService.loadUserDetails((SandboxAuthenticationToken) authentication);
    }

    @Override
    public boolean supports(final Class<?> authentication) {
        return SandboxAuthenticationToken.class.isAssignableFrom(authentication);
    }

}
