package org.opentestsystem.rdw.reporting.exam;

import com.google.common.base.MoreObjects;
import org.apache.commons.lang.builder.ToStringBuilder;

import java.time.Instant;
import java.util.Collections;
import java.util.List;

/**
 * Represents a single assessment examination event
 */
public class Exam {

    private long id;
    private Long assessmentId;
    private String sessionId;
    private Instant dateTime;
    private Student student;
    private StudentContext studentContext;
    private Long opportunity;
    private int administrativeConditionId;
    private String administrativeConditionCode;
    private int completenessId;
    private String completenessCode;
    private ScaleScore scaleScore;
    private List<ScaleScore> claimScaleScores;

    private Exam() {
    }

    /**
     * @return the exam entity ID
     */
    public long getId() {
        return id;
    }

    /**
     * @return the entity ID of the exam's assessment
     */
    public Long getAssessmentId() {
        return assessmentId;
    }

    /**
     * @return the exam session ID (may be null)
     */
    public String getSessionId() {
        return sessionId;
    }

    /**
     * @return the datetime of exam completion
     */
    public Instant getDateTime() {
        return dateTime;
    }

    /**
     * @return the student's attempt number on the assessment
     */
    public Long getOpportunity() {
        return opportunity;
    }

    /**
     * @return the student who took the exam
     */
    public Student getStudent() {
        return student;
    }

    /**
     * @return contextual information surrounding the student and the circumstances under which the student took the exam
     */
    public StudentContext getStudentContext() {
        return studentContext;
    }

    /**
     * @return the overall exam score
     */
    public ScaleScore getScaleScore() {
        return scaleScore;
    }

    /**
     * @deprecated use {@link #getCompletenessCode()} instead.
     * @return the completeness of the exam (partial, complete)
     */
    @Deprecated
    public int getCompletenessId() {
        return completenessId;
    }

    /**
     * @return the completeness of the exam
     */
    public String getCompletenessCode() {
        return completenessCode;
    }

    /**
     * @deprecated use {@link #getAdministrativeConditionCode()} instead.
     * @return the condition in which the exam was administered (valid, invalid, standard, non standard)
     */
    @Deprecated
    public int getAdministrativeConditionId() {
        return administrativeConditionId;
    }

    /**
     * @return the condition in which the exam was administered
     */
    public String getAdministrativeConditionCode() {
        return administrativeConditionCode;
    }

    /**
     * Only ICA and Summative exams have claims and therefore claim scores.
     * This collection will be null for IABs.
     *
     * @return the scale scores for each claim on the exam
     */
    public List<ScaleScore> getClaimScaleScores() {
        return claimScaleScores;
    }

    @Override
    public String toString() {
        return ToStringBuilder.reflectionToString(this);
    }

    public static Builder builder() {
        return new Builder();
    }

    @SuppressWarnings({"unchecked"})
    public static class Builder {

        private long id;
        private Long assessmentId;
        private String sessionId;
        private Instant dateTime;
        private Long opportunity;
        private Student student;
        private StudentContext studentContext;
        private ScaleScore scaleScore;
        private int completenessId;
        private String completenessCode;
        private int administrativeConditionId;
        private String administrativeConditionCode;
        private List<ScaleScore> claimScaleScores;

        public Builder id(final long id) {
            this.id = id;
            return this;
        }

        public Builder assessmentId(final Long assessmentId) {
            this.assessmentId = assessmentId;
            return this;
        }

        public Builder sessionId(final String sessionId) {
            this.sessionId = sessionId;
            return this;
        }

        public Builder dateTime(final Instant dateTime) {
            this.dateTime = dateTime;
            return this;
        }

        public Builder opportunity(final Long opportunity) {
            this.opportunity = opportunity;
            return this;
        }

        public Builder student(final Student student) {
            this.student = student;
            return this;
        }

        public Builder studentContext(final StudentContext studentContext) {
            this.studentContext = studentContext;
            return this;
        }

        public Builder scaleScore(final ScaleScore scaleScore) {
            this.scaleScore = scaleScore;
            return this;
        }

        public Builder completenessId(final int completenessId) {
            this.completenessId = completenessId;
            return this;
        }

        public Builder completenessCode(final String completenessCode) {
            this.completenessCode = completenessCode;
            return this;
        }

        public Builder administrativeConditionId(final int administrativeConditionId) {
            this.administrativeConditionId = administrativeConditionId;
            return this;
        }

        public Builder administrativeConditionCode(final String administrativeConditionCode) {
            this.administrativeConditionCode = administrativeConditionCode;
            return this;
        }

        public Builder claimScaleScores(final List<ScaleScore> claimScaleScores) {
            this.claimScaleScores = claimScaleScores;
            return this;
        }

        public Exam build() {
            final Exam exam = new Exam();
            exam.id = id;
            exam.assessmentId = assessmentId;
            exam.sessionId = sessionId;
            exam.dateTime = dateTime;
            exam.opportunity = opportunity;
            exam.student = student;
            exam.studentContext = studentContext;
            exam.scaleScore = scaleScore;
            exam.completenessId = completenessId;
            exam.completenessCode = completenessCode;
            exam.administrativeConditionId = administrativeConditionId;
            exam.administrativeConditionCode = administrativeConditionCode;
            exam.claimScaleScores = claimScaleScores != null ? Collections.unmodifiableList(claimScaleScores) : null;
            return exam;
        }

    }

}
