package org.opentestsystem.rdw.reporting.security.sandbox;

import org.opentestsystem.rdw.reporting.common.security.User;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.userdetails.AuthenticationUserDetailsService;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UsernameNotFoundException;

import java.util.Collection;

public class SandboxUserDetailsService implements AuthenticationUserDetailsService<SandboxAuthenticationToken> {

    @Override
    public UserDetails loadUserDetails(final SandboxAuthenticationToken token) throws UsernameNotFoundException {

        // TODO map role to authorities
        final Collection<GrantedAuthority> authorities = token.getAuthorities();

        return User.builderExt()
                .username(token.getUsername())
                .password("N/A")
                .lastName(token.getUsername())
                .enabled(true)
                .credentialsNonExpired(true)
                .accountNonExpired(true)
                .accountNonLocked(true)
                .authorities(authorities)
                .tenantId(token.getSandboxKey())
                .build();
    }

}
