package org.opentestsystem.rdw.reporting.report;

import org.opentestsystem.rdw.reporting.common.report.AbstractBatchExamReportRequest;
import org.opentestsystem.rdw.reporting.common.report.BatchExamReportRequestHolder;
import org.opentestsystem.rdw.reporting.common.report.PrintOptions;
import org.opentestsystem.rdw.reporting.common.security.PermissionScope;
import org.opentestsystem.rdw.reporting.security.User;

import javax.validation.constraints.NotNull;

public class AbstractExamReportService<T extends AbstractBatchExamReportRequest<PrintOptions>> implements ExamReportService<T> {

    private ProcessorSource<BatchExamReportRequestHolder> source;
    private final String permission;

    protected AbstractExamReportService(final ProcessorSource<BatchExamReportRequestHolder> source, final String permission) {
        this.source = source;
        this.permission = permission;
    }

    @Override
    public ExamReportToken queueExamReports(final User user, @NotNull final T request) {
        final PermissionScope permissionScope = user.getPermissionsById().get(permission).getScope();

        final BatchExamReportRequestHolder holder = new BatchExamReportRequestHolder(request, permissionScope, "user", "label");

        source.send(holder);

        return new ExamReportToken(holder.getId());
    }

}
