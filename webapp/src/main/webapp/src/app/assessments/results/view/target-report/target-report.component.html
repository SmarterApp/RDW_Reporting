<!-- modal flyweight for student reports -->
<student-report-download #menuReportDownloader
                         [lockAssessmentType]="true"
                         [lockSubject]="true"
                         [lockSchoolYear]="true"></student-report-download>



<div *ngIf="showResults" class="row mb-xs">
  <div class="col-md-10">
    <span class="target-caution-message">* {{ 'target-report.caution-message' | translate }}</span>
  </div>
  <div class="col-md-2 text-right">
    <span>
      <a (click)="toggleSubgroupOptions()"
         class="btn btn-xs"
        [ngClass]="{
          'btn-default': !showSubgroupOptions,
          'btn-primary': showSubgroupOptions
        }">
        {{ 'target-report.subgroup-options' | translate }}
      </a>
    </span>
  </div>
</div>
<div *ngIf="showSubgroupOptions" class="row mb-xs">
  <div class="col-md-12 text-right">
    <span>
      <a (click)="toggleSubgroupOptions()"
         class="btn btn-xs btn-default">
        <i class="fa fa-close"></i>
      </a>
      <a *ngFor="let subgroup of allSubgroups"
         class="reverse btn btn-xs subgroup-toggle {{subgroup.selected ? 'aqua' : 'gray-dark'}}"
         (click)="toggleSubgroup(subgroup)"
         angulartics2On="click"
         angularticsEvent="ToggleSubgroup"
         angularticsCategory="TeacherTargetResults">
              <span class="block-children">
                  {{'aggregate-report-form.field.' + subgroup.translatecode | translate }}
              </span>
      </a>
    </span>
  </div>
</div>

<!-- Student Results Table -->
<p-table #dataTable
         *ngIf="showResults"
         [columns]="columns"
         [value]="aggregateTargetScoreRows"
         [autoLayout]="true"
         sortField=""
         styleClass="table table-striped table-hover overflow">
  <ng-template pTemplate="header"
               let-columns>
    <tr>
      <th *ngFor="let column of columns"
          [pSortableColumn]="column.field"
          [ngSwitch]="column.id"
          class="wrapping">

        <span *ngSwitchDefault>
          <span *ngIf="!column.headerInfo">
            {{('target-report.columns.' + column.id) | translate}}
          </span>
          <span *ngIf="column.headerInfo"
                info-button
                title="{{('target-report.columns.' + column.id) | translate}}"
                content="{{('target-report.columns.' + column.id + '-info') | translate}}">
          </span>
        </span>

        <p-sortIcon [field]="column.field"></p-sortIcon>
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body"
               let-rowData
               let-i="rowIndex"
               let-columns="columns">
    <tr>
      <td *ngFor="let column of columns; let columnIdx = index;"
          style="vertical-align: top">
        <div [ngSwitch]="column.id"
             class="full-cell"
             [ngClass]="{
              'hidden': treeColumns[i] > columnIdx,
              'border-top': treeColumns[i] <= columnIdx && treeColumns[i] < identityColumns.length - 1
             }">

          <div *ngSwitchCase="'claim'">
            <span>
              {{ getClaimCodeTranslation(rowData) }}
            </span>
          </div>

          <div *ngSwitchCase="'target'"
               class="text-right wrapping-max-width-xl">
            <span [innerHTML]="'aggregate-report-table.target-description' | translate: getTargetDisplay(rowData)">
            </span>
          </div>

          <div *ngSwitchCase="'subgroup'"
               class="label-max-width"
               title="{{rowData.subgroup.name}}">
            <subgroup [subgroup]="rowData.subgroup"></subgroup>
          </div>

          <div *ngSwitchCase="'studentsTested'"
               class="text-right">
            {{rowData.studentsTested}}
          </div>

          <div *ngSwitchCase="'student-relative-residual-scores-level'">

            <!-- pick the icon -->
            <span [ngSwitch]="getTargetReportingLevelString(rowData.studentRelativeLevel)">
              <span *ngSwitchCase="'Above'"
                    class="label label-lg sb-iab-green">
                {{'aggregate-report-table.target.overall.Above' | translate}}
              </span>
              <span *ngSwitchCase="'Near'"
                    class="label label-lg sb-iab-yellow">
                {{'aggregate-report-table.target.overall.Near' | translate}}
              </span>
              <span *ngSwitchCase="'Below'"
                    class="label label-lg sb-iab-red">
                {{'aggregate-report-table.target.overall.Below' | translate}}
              </span>
              <span *ngSwitchCase="'InsufficientData'"
                    class="label label-lg gray-light">
                {{'aggregate-report-table.target.overall.InsufficientData' | translate}}
              </span>
              <span *ngSwitchCase="'Excluded'"
                    class="label label-lg gray-light">
                {{'aggregate-report-table.target.standard.Excluded' | translate}}
              </span>
              <span *ngSwitchCase="'NoResults'">
                -
              </span>
            </span>
          </div>

          <div *ngSwitchCase="'standard-met-relative-residual-level'">

            <!-- pick the label color -->
            <span [ngSwitch]="getTargetReportingLevelString(rowData.standardMetRelativeLevel)">
              <span *ngSwitchCase="'Above'"
                    class="label label-lg sb-iab-green">
                {{'aggregate-report-table.target.standard.Above' | translate}}
              </span>
              <span *ngSwitchCase="'Near'"
                    class="label label-lg sb-iab-yellow">
                {{'aggregate-report-table.target.standard.Near' | translate}}
              </span>
              <span *ngSwitchCase="'Below'"
                    class="label label-lg sb-iab-red">
                {{'aggregate-report-table.target.standard.Below' | translate}}
              </span>
              <span *ngSwitchCase="'InsufficientData'"
                    class="label label-lg gray-light">
                {{'aggregate-report-table.target.standard.InsufficientData' | translate}}
              </span>
              <span *ngSwitchCase="'Excluded'"
                    class="label label-lg gray-light">
                {{'aggregate-report-table.target.standard.Excluded' | translate}}
              </span>
              <span *ngSwitchCase="'NoResults'">
                -
              </span>
            </span>

          </div>
        </div>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage" let-columns>
    <tr>
      <td [attr.colspan]="columns.length">
        {{'results-by-student.assessment-exams-empty-message' | translate}}
      </td>
    </tr>
  </ng-template>
</p-table>

<div *ngIf="!showResults">
  {{ 'target-report.not-enough-results' | translate }}
</div>
