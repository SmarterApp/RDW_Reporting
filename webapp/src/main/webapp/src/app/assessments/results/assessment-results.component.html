<!-- modal flyweight for student reports -->
<student-report-download #menuReportDownloader
                         [lockAssessmentType]="true"
                         [lockSubject]="true"
                         [lockSchoolYear]="true"></student-report-download>

<!-- Individual Assessment Result Container -->
<div class="assessment-result well wide-content-container">
  <!-- Top Right Buttons -->
  <div class="row">
    <div class="col-xs-10 col-sm-11">
      <div class="row">
        <div class="col-md-12 mb-sm">
          <!-- Assessment Title -->
          <span class="tag tag-lg {{colorService.getColor(getGradeIdx(assessmentExam.assessment.grade))}}">
                <span class="label">{{assessmentExam.assessment.grade | gradeDisplay}}</span>
                {{assessmentExam.assessment.label}}
            </span>
        </div>
      </div>
    </div>
    <div class="col-xs-2 col-sm-1">
      <button class="btn btn-default btn-sm icon-only pull-right"
              (click)="collapsed = !collapsed"
              angulartics2On="click"
              angularticsEvent="ToggleCollapseResults"
              angularticsCategory="AssessmentResults">
        <i class="fa font-bold"
           [ngClass]="{'fa-angle-up': !collapsed, 'fa-angle-down': collapsed}"></i> <span class="sr-only">{{'prompt.collapse' | translate}}</span>
      </button>
    </div>
  </div>

  <div *ngIf="allowFilterBySessions" class="row mb-sm">
    <!-- Sessions -->
    <div class="col-md-12">
      <strong>{{'labels.groups.results.assessment.sessions-title' | translate}}</strong>
      <div class="flex-children">
        <a *ngFor="let session of sessions"
           class="reverse multi-line btn flex-child"
           [ngClass]="{'gray-dark':!session.filter, 'aqua': session.filter}"
           (click)="toggleSession(session)"
           angulartics2On="click"
           angularticsEvent="ToggleSession"
           angularticsCategory="AssessmentResults">
          <span class="block-children">
              <strong>{{session.date | date }}</strong>
              <small class="text-left">{{session.id || 'labels.groups.results.session-unknown' | translate }}</small>
          </span>
        </a>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <average-scale-score [assessmentExam]="assessmentExam"
                           [statistics]="statistics"
                           [showValuesAsPercent]="showValuesAsPercent"
                           [assessmentProvider]="assessmentProvider"></average-scale-score>
    </div>
  </div>

  <!-- Student Results -->
  <ng-container *ngIf="!collapsed" @fadeAnimation>
    <div class="row mt-md">
      <div class="col-md-12">

        <!-- Result view selector -->
        <span class="z-index-over-data-table">
          <div>
            <strong>{{'assessment-results.result-view-select.label' | translate}}</strong>
          </div>
          <div class="select-menu-group mb-sm mt-xs">
            <label class="sr-only">{{ 'labels.groups.results.assessment.select-view' | translate }}</label>
            <div class="btn-group" dropdown>
              <button dropdownToggle
                      type="button"
                      class="btn btn-default btn-borderless dropdown-toggle">
                {{ currentResultsView.label | translate }} <i class="fa fa-angle-down"></i>
              </button>
              <ul *dropdownMenu
                  class="dropdown-menu"
                  role="menu">
                <li role="menuitem"
                    *ngIf="resultsByStudentView.display">
                  <a class="dropdown-item"
                     popover="{{'messages.no-results-by-item' | translate }}"
                     triggers="{{ !resultsByStudentView.disabled ? '': 'mouseenter:mouseleave'}}"
                     placement="right"
                     (click)="resultsByStudentView.disabled || setCurrentView(resultsByStudentView)"
                     [ngClass]="{'selected': currentResultsView == resultsByStudentView }">
                    <button [disabled]="resultsByStudentView.disabled"
                            class="btn btn-default btn-borderless">
                      {{ resultsByStudentView.label | translate }}
                    </button>
                  </a>
                </li>
                <li role="menuitem"
                    *ngIf="resultsByItemView.display">
                  <a class="dropdown-item"
                     popover="{{ (assessmentExam.assessment.isSummative ? 'messages.no-results-by-item-for-summative-exams' : 'messages.no-results-by-item') | translate }}"
                     triggers="{{ !resultsByItemView.disabled ? '': 'mouseenter:mouseleave'}}"
                     placement="right"
                     (click)="resultsByItemView.disabled || setCurrentView(resultsByItemView)"
                     [ngClass]="{'selected': currentResultsView == resultsByItemView }">
                    <button [disabled]="resultsByItemView.disabled"
                            class="btn btn-default btn-borderless">
                      {{ resultsByItemView.label | translate }}
                    </button>
                  </a>
                </li>
                <li role="menuitem"
                    *ngIf="distractorAnalysisView.display">
                  <a class="dropdown-item"
                     popover="{{ (assessmentExam.assessment.isSummative ? 'messages.no-distractor-analysis-for-summative-exams' : 'messages.no-distractor-analysis') | translate }}"
                     triggers="{{ !distractorAnalysisView.disabled ? '' : 'mouseenter:mouseleave'}}"
                     placement="right"
                     (click)="distractorAnalysisView.disabled || setCurrentView(distractorAnalysisView)"
                     [ngClass]="{'selected': currentResultsView == distractorAnalysisView }">
                    <button [disabled]="distractorAnalysisView.disabled"
                            class="btn btn-default btn-borderless">
                      {{ distractorAnalysisView.label | translate }}
                    </button>
                  </a>
                </li>
                <li role="menuitem"
                    *ngIf="writingTraitScoresView.display">
                  <a class="dropdown-item"
                     popover="{{ (!assessmentExam.assessment.isIab ? 'messages.no-writing-trait-scores-for-summative-ica-exams' : 'messages.no-writing-trait-scores') | translate }}"
                     triggers="{{ !writingTraitScoresView.disabled ? '' : 'mouseenter:mouseleave'}}"
                     placement="right"
                     (click)="writingTraitScoresView.disabled || setCurrentView(writingTraitScoresView)"
                     [ngClass]="{'selected': currentResultsView == writingTraitScoresView }">
                    <button [disabled]="writingTraitScoresView.disabled"
                            class="btn btn-default btn-borderless">
                      {{ writingTraitScoresView.label | translate }}
                    </button>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </span>

        <!-- Bottons right of view select -->
        <div class="pull-right mt-sm">
          <button *ngIf="assessmentExam.assessment.isIab"
                  class="btn btn-success btn-sm"
                  angulartics2On="click"
                  angularticsEvent="InstructionalResource"
                  angularticsCategory="AssessmentResults"
                  [angularticsProperties]="{label: assessmentExam.assessment.label}"
                  [popover]="buttonPopover"
                  popoverTitle="{{ 'labels.groups.results.assessment.instruct-button' | translate:{ level:assessmentExam.assessment.label } }}"
                  container="body"
                  (click)="loadInstructionalResources(assessmentExam.assessment, 0)"
                  [outsideClick]="true">
            <i class="fa fa-book"></i> {{'labels.groups.results.assessment.instruct' | translate }}
          </button>
          <button *ngIf="currentResultsView.canExport"
                  class="btn btn-default btn-sm ml-xs"
                  [disabled]="!currentExportResults || !currentExportResults.hasDataToExport()"
                  (click)="currentExportResults.exportToCsv()">
            <i class="fa fa-cloud-download"></i> {{ 'labels.export.title' | translate }}
          </button>
        </div>




        <!--<div>-->
          <ng-container *ngIf="showStudentResults">
            <results-by-student [exams]="exams"
                                [assessment]="assessmentExam.assessment"
                                [minimumItemDataYear]="minimumItemDataYear"></results-by-student>
          </ng-container>
          <ng-container *ngIf="showItemsByPointsEarned">
            <results-by-item #resultsByItem
                             [showValuesAsPercent]="showValuesAsPercent"
                             [assessmentProvider]="assessmentProvider"
                             [assessmentExporter]="assessmentExporter"
                             [assessment]="assessmentExam.assessment"
                             [exams]="exams"></results-by-item>
          </ng-container>
          <ng-container *ngIf="showDistractorAnalysis">
            <distractor-analysis #distractorAnalysis
                                 [showValuesAsPercent]="showValuesAsPercent"
                                 [assessmentProvider]="assessmentProvider"
                                 [assessmentExporter]="assessmentExporter"
                                 [assessment]="assessmentExam.assessment"
                                 [exams]="exams"></distractor-analysis>
          </ng-container>
          <ng-container *ngIf="showWritingTraitScores">
            <writing-trait-scores #writingTraitScores
                                  [showValuesAsPercent]="showValuesAsPercent"
                                  [assessmentProvider]="assessmentProvider"
                                  [assessmentExporter]="assessmentExporter"
                                  [assessment]="assessmentExam.assessment"
                                  [exams]="exams"></writing-trait-scores>
          </ng-container>
        <!--</div>-->
      </div>
    </div>
  </ng-container>
</div>
<ng-template #buttonPopover>
  <instructional-resource-popover [provider]="instructionalResourceProvider"></instructional-resource-popover>
</ng-template>
