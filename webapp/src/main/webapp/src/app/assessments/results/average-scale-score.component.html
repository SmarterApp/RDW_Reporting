<div class="key-value-display" *ngIf="subjectDefinition">
  <ng-container [ngSwitch]="scoreType">
    <ng-container *ngSwitchCase="'Overall'">
      <div class="row">
        <div class="col-md-5 mb-md">
          <strong>{{ 'average-scale-score.title' | translate }}</strong>
          <div class="well">
            <div class="key-value-table">
              <table class="table table-borderless">
                <tr>
                  <td class="pl-sm">
                    <div
                      info-button
                      title="{{
                        'average-scale-score.scale-score' | translate
                      }}"
                      content="{{
                        'average-scale-score.scale-score-info' | translate
                      }}"
                      class="average-scale-score-label"
                    ></div>
                  </td>
                  <td>
                    <!-- TODO use shared component
                    <scale-score
                      *ngIf="hasAverageScore"
                      class="font-large text-left"
                      [score]="averageScore"
                      [standardError]="statistics.standardError"
                      [background]="true"
                    ></scale-score>
                    -->
                    <div
                      *ngIf="hasAverageScore"
                      class="scale-score font-large text-left"
                    >
                      <span class="score label label-primary">{{
                        averageScore
                      }}</span>
                      <span class="error-band black">
                        {{
                          'common.error-band-value'
                            | translate
                              : {
                                  errorBand:
                                    statistics.standardError | number: '1.0-0'
                                }
                        }}</span
                      >
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>
                    <div class="result-count-label">
                      {{ 'average-scale-score.results-label' | translate }}
                    </div>
                  </td>
                  <td class="">
                    <span *ngIf="statistics" class="text-left gray-darkest">
                      <span class="score font-large">{{
                        statistics.total
                      }}</span>
                      <span class="ml-xs">{{
                        (statistics.total == 1
                          ? 'average-scale-score.result'
                          : 'average-scale-score.results') | translate
                      }}</span>
                    </span>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <div class="col-md-7">
          <strong>{{
            'average-scale-score.student-score-distribution' | translate
          }}</strong>
          <div class="well">
            <div
              *ngFor="let level of performanceLevels; let i = index"
              class="score-distribution-container"
            >
              <div class="text-right gray-lighter grid-item">
                {{
                  level.id
                    | optional
                      : ('subject.' +
                          assessment.subject +
                          '.asmt-type.' +
                          assessment.type +
                          '.level.' +
                          level.id +
                          '.name'
                          | translate)
                }}
                <button
                  *ngIf="assessment.isIab"
                  class="btn btn-borderless btn-xs icon-only pull-right"
                  angulartics2On="click"
                  angularticsAction="InstructionalResource"
                  angularticsCategory="AssessmentResults"
                  [popover]="buttonPopover"
                  popoverTitle="{{
                    'common.results.assessment.instruct-button'
                      | translate
                        : {
                            level:
                              level.id
                              | optional
                                : ('subject.' +
                                    assessment.subject +
                                    '.asmt-type.' +
                                    assessment.type +
                                    '.level.' +
                                    level.id +
                                    '.name'
                                    | translate)
                          }
                  }}"
                  container="body"
                  (click)="loadInstructionalResources(level.id)"
                  [outsideClick]="true"
                >
                  <i class="fa fa-book"></i>
                </button>
              </div>
              <div class="level-down text-right gray-lightest grid-item">
                <strong
                  >{{ level.value | number: '1.0-0' }}{{ level.suffix }}</strong
                >
              </div>
              <div
                class="level-down scale-score-graph rounded blend-middle gray-lightest grid-item"
              >
                <div class="bar-container">
                  <div
                    *ngIf="level.value != 0"
                    class="bar"
                    [ngClass]="
                      'subject.' +
                        assessment.subject +
                        '.asmt-type.' +
                        assessment.type +
                        '.level.' +
                        level.id +
                        '.color' | translate
                    "
                    [attr.data-width]="filledLevel(level)"
                  ></div>
                  <div
                    *ngIf="filledLevel(level) < 100"
                    class="bar gray"
                    [attr.data-width]="unfilledLevel(level)"
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
    <ng-container *ngSwitchCase="'Claim'">
      <div class="row">
        <div class="col-md-12">
          <strong
            info-button
            title="{{
              'average-scale-score.student-claim-distribution' | translate
            }}"
            content="{{ 'common.info.claim' | translate }}"
          ></strong>
          <div class="ui-table-wrapper">
            <table
              *ngFor="let index of claimReferenceRows"
              class="table table-striped table-hover student-claim-distribution"
              [ngClass]="getClaimColumnCountClass(index)"
            >
              <thead class="ui-table-thead">
                <tr>
                  <th *ngFor="let claimReference of getLatestClaimReferences()">
                    <i
                      class="fa {{
                        'subject.' +
                          assessment.subject +
                          '.claim.' +
                          claimReference.code +
                          '.icon' | translate
                      }}"
                    ></i>
                    {{
                      'subject.' +
                        assessment.subject +
                        '.claim.' +
                        claimReference.code +
                        '.name' | translate
                    }}
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td
                    *ngFor="let claimReference of getLatestClaimReferences()"
                    class="claim-distribution"
                  >
                    <div class="assessment-aggregate">
                      <div class="scale-score-graph rounded blend-middle mb-sm">
                        <div class="bar-container">
                          <ng-container *ngIf="claimReference.stats">
                            <ng-container
                              *ngFor="
                                let percent of claimReference.stats.percents;
                                let i = index
                              "
                            >
                              <div
                                *ngIf="percent.value != 0"
                                class="bar"
                                [ngClass]="
                                  'subject.' +
                                    assessment.subject +
                                    '.asmt-type.' +
                                    assessment.type +
                                    '.claim-score.level.' +
                                    (i + 1) +
                                    '.color' | translate
                                "
                                [attr.data-width]="
                                  getClaimDataWidth(claimReference.dataIndex, i)
                                "
                              ></div>
                            </ng-container>
                          </ng-container>
                        </div>
                      </div>

                      <ng-container *ngIf="claimReference.stats">
                        <div
                          class="perc-container row"
                          *ngFor="let row of claimLevelRows"
                        >
                          <div class="col-xs-4" *ngFor="let i of row">
                            <div class="bar">
                              <span
                                class="square"
                                [ngClass]="
                                  'subject.' +
                                    assessment.subject +
                                    '.asmt-type.' +
                                    assessment.type +
                                    '.claim-score.level.' +
                                    (i + 1) +
                                    '.color' | translate
                                "
                              ></span>
                              {{ getClaimValue(claimReference.stats, i)
                              }}{{ getClaimSuffix(claimReference.stats, i) }}
                              <span class="sr-only">{{
                                'subject.' +
                                  assessment.subject +
                                  '.asmt-type.' +
                                  assessment.type +
                                  '.claim-score.level.' +
                                  (i + 1) +
                                  '.name' | translate
                              }}</span>
                            </div>
                            <div class="bar description mt-xs">
                              {{
                                'subject.' +
                                  assessment.subject +
                                  '.asmt-type.' +
                                  assessment.type +
                                  '.claim-score.level.' +
                                  (i + 1) +
                                  '.name' | translate
                              }}
                            </div>
                          </div>
                        </div>
                      </ng-container>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </ng-container>
    <ng-container *ngSwitchCase="'Alternate'">
      <alternate-scores-table
        [subjectDefinition]="subjectDefinition"
        [displayCount]="!showValuesAsPercent"
      ></alternate-scores-table>
    </ng-container>
  </ng-container>
  <div
    *ngIf="subjectDefinition.claimScores || subjectDefinition.alternateScores"
    class="btn-group btn-group-xs z-index-over-data-table mt-sm pull-right"
    role="group"
  >
    <button
      (click)="onScoreTypeChange('Overall')"
      class="btn btn-default"
      angulartics2On="click"
      angularticsAction="ViewOverallScores"
      angularticsCategory="AssessmentResults"
      [ngClass]="{ active: scoreType === 'Overall' }"
    >
      {{ 'common.buttons.display-overall' | translate }}
    </button>
    <button
      *ngIf="subjectDefinition.alternateScores"
      (click)="onScoreTypeChange('Alternate')"
      class="btn btn-default z-index-over-data-table"
      angulartics2On="click"
      angularticsAction="ViewClaimScores"
      angularticsCategory="AssessmentResults"
      [ngClass]="{ active: scoreType === 'Alternate' }"
    >
      {{
        'subject.' +
          subjectDefinition.subject +
          '.asmt-type.' +
          subjectDefinition.assessmentType +
          '.alt-score.name' | translate
      }}
    </button>
    <button
      *ngIf="subjectDefinition.claimScores"
      (click)="onScoreTypeChange('Claim')"
      class="btn btn-default z-index-over-data-table"
      angulartics2On="click"
      angularticsAction="ViewClaimScores"
      angularticsCategory="AssessmentResults"
      [ngClass]="{ active: scoreType === 'Claim' }"
    >
      {{
        'subject.' +
          subjectDefinition.subject +
          '.asmt-type.' +
          subjectDefinition.assessmentType +
          '.claim-score.name' | translate
      }}
    </button>
  </div>
</div>
<ng-template #buttonPopover>
  <instructional-resource-popover
    [provider]="instructionalResourcesProvider"
  ></instructional-resource-popover>
</ng-template>
