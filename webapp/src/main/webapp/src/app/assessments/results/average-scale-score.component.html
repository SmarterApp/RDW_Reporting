<!-- IAB display -->
<div *ngIf="hasAverageScore" class="key-value-display">
  <div class="row" *ngIf="!isClaimScoreSelected">
    <div class="col-md-5 mb-md">
      <strong>{{ 'average-scale-score.title' | translate }}</strong>
      <div class="well">
        <div class="key-value-table">
          <table class="table table-borderless">
            <tr>
              <td class="pl-sm">
                <div info-button
                      title="{{ 'average-scale-score.scale-score' | translate }}"
                      content="{{ 'average-scale-score.scale-score-info' | translate }}"
                      class="average-scale-score-label"></div>
              </td>
              <td>
                <div class="scale-score font-large text-left">
                  <span class="score label label-primary">{{ averageScore }}</span>
                  <span class="error-band black"> {{'common.error-band-value' | translate: {errorBand: statistics.standardError | number:'1.0-0'} }}</span>
                </div>
              </td>
            </tr>
            <tr>
              <td>
                <div class="result-count-label">
                  {{'average-scale-score.results-label' | translate}}
                </div>
              </td>
              <td class="">
                <span class="text-left gray-darkest">
                  <span class="score font-large">{{ statistics.total }}</span>
                  <span class="ml-xs">{{ (statistics.total == 1 ? 'average-scale-score.result' : 'average-scale-score.results') | translate }}</span>
                </span>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    <div class="col-md-7">
      <strong>{{ 'average-scale-score.student-score-distribution' | translate }}</strong>
      <div class="well">
        <div *ngFor="let performanceLevel of performanceLevels; let i = index" class="score-distribution-container">
          <div class="text-right gray-lighter grid-item">
            {{ examLevelTranslation(performanceLevel) }}
            <button *ngIf="assessmentExam.assessment.isIab"
                    class="btn btn-borderless btn-xs icon-only pull-right"
                    angulartics2On="click"
                    angularticsEvent="InstructionalResource"
                    angularticsCategory="AssessmentResults"
                    [popover]="buttonPopover"
                    popoverTitle="{{ 'common.results.assessment.instruct-button' | translate:{ level:(examLevelTranslation(performanceLevel)) } }}"
                    container="body"
                    (click)="loadInstructionalResources(performanceLevel)"
                    [outsideClick]="true"><i
              class="fa fa-book"></i></button>
          </div>
          <div class="level-down text-right gray-lightest grid-item">
            <strong>{{ performanceLevel.value | number:'1.0-0' }}{{ performanceLevel.suffix }}</strong>
          </div>
          <div class="level-down scale-score-graph rounded blend-middle gray-lightest grid-item">
            <div class="bar-container">
              <div *ngIf="performanceLevel.value != 0" class="bar" [ngClass]="colorService.getPerformanceLevelColorsByAssessmentTypeCode(assessmentExam.assessment.type, performanceLevels.length - i)"
                   [attr.data-width]="filledLevel(performanceLevel)"></div>
              <div *ngIf="filledLevel(performanceLevel) < 100" class="bar gray"
                   [attr.data-width]="unfilledLevel(performanceLevel)">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row" *ngIf="isClaimScoreSelected">
    <div class="col-md-12">
      <strong>{{ 'average-scale-score.student-claim-distribution' | translate }}</strong>
      <div class="ui-table-wrapper">
        <table class="table table-striped table-hover student-claim-distribution">
          <thead class="ui-table-thead">
          <tr>
            <th *ngFor="let claimStats of statistics.claims; let i = index">
              <i class="fa {{ 'report.claim.' + claimCodes[i] + '.icon' | translate }}"></i>
              {{('common.subject-claim-code.' + claimCodes[i]) | translate}}
            </th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td *ngFor="let claimStats of statistics.claims; let claimIndex = index" class="claim-distribution">
              <div class="assessment-aggregate">
                <div class="scale-score-graph rounded blend-middle mb-sm">
                  <div class="bar-container">
                    <div *ngFor="let level of claimStats.levels; let i = index">
                      <div class="bar" *ngIf="claimStats.percents[i].value != 0"
                           [ngClass]="colorService.getPerformanceLevelColorsByAssessmentTypeCode('iab', i + 1)"
                           [attr.data-width]="getClaimDataWidth(claimIndex, i)"></div>
                    </div>
                  </div>
                </div>

                <div class="perc-container" [ngClass]="'grid-' + claimStats.levels.length" >
                  <div class="bar" *ngFor="let level of claimStats.levels; let i = index">
                    <span class="square"
                          [ngClass]="colorService.getPerformanceLevelColorsByAssessmentTypeCode('iab', i + 1)"></span>
                    {{ getClaimValue(claimStats, i) }}{{ getClaimSuffix(claimStats, i) }}
                    <span
                      class="sr-only">{{ 'common.assessment-type.iab.performance-level.' + i + 1 + '.name' | translate }}</span>
                  </div>
                </div>

                <div class="perc-container mt-xs" [ngClass]="'grid-' + claimStats.levels.length">
                  <div class="bar description" *ngFor="let level of claimStats.levels; let i = index">
                    {{ 'common.assessment-type.iab.performance-level.' + (i+1) + '.name' | translate }}
                  </div>
                </div>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div *ngIf="showClaimToggle"
       class="btn-group btn-group-xs z-index-over-data-table mt-sm pull-right"
       role="group">
    <button (click)="setOverallScoreSelected()"
            class="btn btn-default"
            angulartics2On="click"
            angularticsEvent="ViewOverallScores"
            angularticsCategory="AssessmentResults"
            [ngClass]="{'active': !isClaimScoreSelected}">
      {{'common.buttons.display-overall' | translate}}
    </button>
    <button (click)="setClaimScoreSelected()"
            class="btn btn-default z-index-over-data-table"
            angulartics2On="click"
            angularticsEvent="ViewClaimScores"
            angularticsCategory="AssessmentResults"
            [ngClass]="{'active': isClaimScoreSelected}">
      <i class="fa fa-bold fa-table"></i>
      {{'common.buttons.display-claim' | translate}}
    </button>
  </div>
</div>
<ng-template #buttonPopover>
  <instructional-resource-popover [provider]="instructionalResourcesProvider"></instructional-resource-popover>
</ng-template>
