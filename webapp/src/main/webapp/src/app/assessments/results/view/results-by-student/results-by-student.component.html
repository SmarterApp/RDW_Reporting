<!-- modal flyweight for student reports -->
<student-report-download #menuReportDownloader
                         [lockAssessmentType]="true"
                         [lockSubject]="true"
                         [lockSchoolYear]="true"></student-report-download>
<div class="pull-right">
  <div *ngIf="showClaimToggle"
       class="btn-group btn-group-xs z-index-over-data-table mt-md"
       role="group">
    <button (click)="setOverallScoreSelected()"
            class="btn btn-default"
            angulartics2On="click"
            angularticsEvent="ViewOverallScores"
            angularticsCategory="AssessmentResults"
            [ngClass]="{'active': !isClaimScoreSelected}">
      {{'common.buttons.display-overall' | translate}}
    </button>
    <button (click)="setClaimScoreSelected()"
            class="btn btn-default z-index-over-data-table"
            angulartics2On="click"
            angularticsEvent="ViewClaimScores"
            angularticsCategory="AssessmentResults"
            [ngClass]="{'active': isClaimScoreSelected}">
      <i class="fa fa-bold fa-table"></i>
      {{'common.buttons.display-claim' | translate}}
    </button>
  </div>
</div>

<!-- Student Results Table -->
<p-dataTable [value]="exams"
             emptyMessage="{{'results-by-student.assessment-exams-empty-message' | translate}}"
             sortField="student.lastName"
             tableStyleClass="table table-striped table-hover overflow"
             expandableRows="true">
  <!-- Row Menu -->
  <p-column sortField="student.lastName"
            header="{{'common.results.assessment-exam-columns.name' | translate}}"
            [sortable]="true">
    <ng-template let-exam="rowData" pTemplate="body">
      <popup-menu [item]="exam"
                  [actions]="actions"
                  [text]="'common.person-name' | translate:exam.student"></popup-menu>
    </ng-template>
  </p-column>
  <p-column field="date"
            header="{{'common.results.assessment-exam-columns.date' | translate}}"
            [sortable]="true">
    <ng-template let-exam="rowData" pTemplate="body">
      {{ exam.date | date }}
    </ng-template>
  </p-column>
  <p-column field="session"
            header="{{'common.results.assessment-exam-columns.session' | translate}}"
            [sortable]="true"></p-column>
  <p-column field="enrolledGrade"
            header="{{'common.results.assessment-exam-columns.grade' | translate}}"
            [sortable]="true" [hidden]="isClaimScoreSelected">
    <ng-template let-exam="rowData" pTemplate="body">
      {{ 'common.enrolled-grade-label.' + exam.enrolledGrade | translate }}
    </ng-template>
  </p-column>
  <p-column field="school.name"
            header="{{'common.results.assessment-exam-columns.school' | translate }}"
            sortable="true"></p-column>
  <p-column field="administrativeCondition"
            [sortable]="true"
            [hidden]="isClaimScoreSelected">
    <ng-template pTemplate="header">
      <span info-button title="{{'common.results.assessment-exam-columns.status' | translate}}"
            content="{{'common.results.assessment-exam-columns.status-info' | translate}}">
      </span>
    </ng-template>
    <ng-template let-exam="rowData" pTemplate="body">
      <span *ngIf="exam.administrativeCondition !== 'Valid'" class="label border-only maroon">{{ 'common.administration-condition.' + exam.administrativeCondition | translate }}</span>
      <span *ngIf="exam.completeness == 'Partial'" class="label border-only maroon">{{ 'common.completeness.' + exam.completeness | translate }}</span>
    </ng-template>
  </p-column>
  <p-column field="level"
            [sortable]="true"
            [hidden]="isClaimScoreSelected">
    <ng-template pTemplate="header">
      <span info-button title="{{performanceLevelHeader | translate}}"
            content="{{performanceLevelHeaderInfo | translate}}">
      </span>
    </ng-template>
    <ng-template let-exam="rowData" pTemplate="body">
      <span class="pull-left">
        {{ examLevelTranslation(exam) }}
      </span>
      <span class="pull-right" *ngIf="assessment.isIab">
        <button
          class="btn btn-borderless btn-xs icon-only"
          angulartics2On="click"
          angularticsEvent="InstructionalResource"
          angularticsCategory="AssessmentResults"
          [popover]="buttonPopover"
          popoverTitle="{{ 'common.results.assessment.instruct-button' | translate:{ level:(examLevelTranslation(exam)) } }}"
          container="body"
          (click)="loadInstructionalResources(exam)"
          [outsideClick]="true"><i class="fa fa-book"></i></button>
      </span>
    </ng-template>
  </p-column>
  <p-column field="score"
            [sortable]="true"
            [hidden]="isClaimScoreSelected">
    <ng-template pTemplate="header">
      <span info-button
            placement="left"
            title="{{'common.results.assessment-exam-columns.score' | translate}}"
            content="{{'common.results.assessment-exam-columns.score-info' | translate}}"></span>
    </ng-template>
    <ng-template let-exam="rowData" pTemplate="body">
      <scale-score [score]="exam.score"
                   [standardError]="exam.standardError"></scale-score>
    </ng-template>
  </p-column>

  <!-- Claim Score columns -->
  <p-column *ngFor="let claim of claimCodes; let idx = index"
            header="{{'common.subject-claim-code.' + claim | translate}}"
            field="{{'claimScores.' + idx + '.level'}}"
            sortable="true"
            [hidden]="!isClaimScoreSelected">
    <ng-template let-exam="rowData" pTemplate="body">
      <span *ngIf="exam.claimScores[idx].level">{{ 'common.assessment-type.iab.performance-level.' + exam.claimScores[idx].level.toString() + '.name' | translate }}</span>
      <span *ngIf="!exam.claimScores[idx].level">-</span>
    </ng-template>
  </p-column>
</p-dataTable>
<ng-template #buttonPopover>
  <instructional-resource-popover [provider]="instructionalResourcesProvider"></instructional-resource-popover>
</ng-template>
