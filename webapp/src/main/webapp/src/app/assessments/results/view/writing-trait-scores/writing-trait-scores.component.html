<spinner *ngIf="loading" text="{{'common.messages.loading' | translate}}"></spinner>

<ng-container *ngIf="!loading">
  <p-table #writingTraitTable
           [columns]="writingTraitColumns"
           [value]="filteredItems"
           rowExpandMode="single"
           dataKey="position"
           sortField="position"
           styleClass="table table-striped table-hover writing-trait-scores">
    <ng-template pTemplate="header"
                 let-columns>
      <tr>
        <th *ngFor="let column of columns"
            [pSortableColumn]="column.sortField"
            [ngSwitch]="column.id"
            [ngClass]="column.styleClass">

          <span *ngSwitchCase="'standard'"
                info-button
                title="{{'common.results.assessment-item-columns.standard' | translate}}"
                content="{{'common.results.assessment-item-columns.standard-info.' + assessment.subject | translate}}">
          </span>

          <span *ngSwitchDefault>
            <span *ngIf="!column.headerInfo">
              {{('common.results.assessment-item-columns.' + column.id) | translate}}
            </span>
            <span *ngIf="column.headerInfo"
                  info-button
                  title="{{('common.results.assessment-item-columns.' + column.id) | translate}}"
                  content="{{('common.results.assessment-item-columns.' + column.id + '-info') | translate}}">
            </span>
          </span>
          <p-sortIcon [field]="column.sortField"></p-sortIcon>
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body"
                 let-item
                 let-i="rowIndex"
                 let-columns="columns">
      <tr>
        <td *ngFor="let column of columns"
            [ngSwitch]="column.id">

          <table-row-expander *ngSwitchCase="'number'"
                              [table]="writingTraitTable"
                              [row]="item"
                              [text]="item.position"></table-row-expander>

          <claim-target *ngSwitchCase="'claim'"
                        [item]="item"></claim-target>

          <span *ngSwitchCase="'purpose'">
            {{ writingTraitType }}
          </span>

          <span *ngSwitchCase="'difficulty'">
            {{ 'common.difficulty.' + item.difficulty | translate }}
          </span>

          <div *ngSwitchCase="'standard'">
            <span *ngFor="let standard of item.commonCoreStandardIds"
                  class="label border-only blue mr-xs">
              {{standard}}
            </span>
          </div>

          <div *ngSwitchCase="'full-credit'">
            <span [hidden]="showValuesAsPercent">{{ item.fullCredit }}</span>
            <span [hidden]="!showValuesAsPercent">{{ item.fullCreditAsPercent | number:'1.0-0' }}%</span>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="rowexpansion"
                 let-item
                 let-columns="columns">
      <tr>
        <td [attr.colspan]="columns.length">
          <item-tab [item]="item"
                    [showResponse]="false"
                    [exams]="exams"
                    [includeWritingTraitScores]="true"
                    [showItemDetails]="assessment.isInterim">
          </item-tab>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage" let-columns>
      <tr>
        <td [attr.colspan]="columns.length">
          {{'common.no-results' | translate}}
        </td>
      </tr>
    </ng-template>

  </p-table>

  <div *ngFor="let traitScoreSummary of traitScoreSummaries">
    <h4 *ngIf="isWritingTraitItem" class="pt-md">{{'writing-trait-scores.aggregate-header' | translate }}</h4>

    <p-table *ngIf="isWritingTraitItem"
             [columns]="getColumnsForSummary(traitScoreSummary)"
             [value]="traitScoreSummary.rows"
             [autoLayout]="true"
             rowExpandMode="single"
             dataKey="position"
             sortField="position"
             styleClass="table table-striped table-hover writing-trait-scores">

      <ng-template pTemplate="header"
                   let-columns>
        <tr>
          <th *ngFor="let column of columns; let idx = index"
              [pSortableColumn]="column.sortField"
              [pSortableColumnDisabled]="!column.sortable"
              [ngSwitch]="column.id"
              [ngClass]="column.styleClass">

            <span *ngSwitchCase="'item-point'">
              {{'common.results.assessment-item-columns.x-points' | translate:{id: column.index} }}
            </span>

            <span *ngSwitchDefault>
              {{('common.results.assessment-item-columns.' + column.id) | translate}}
            </span>
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body"
                   let-item
                   let-i="rowIndex"
                   let-columns="columns">
        <tr>
          <td *ngFor="let column of columns"
              [ngSwitch]="column.id">

            <div *ngSwitchCase="'category'">
              <span *ngIf="item.trait.type != totalType">{{'common.writing-trait.' + item.trait.type | translate}}</span>
              <span *ngIf="item.trait.type == totalType"
                    info-button
                    title="{{'common.writing-trait.total' | translate}}"
                    content="{{'common.writing-trait.total-info' | translate}}"></span>
            </div>

            <div *ngSwitchCase="'average-max'">
              <strong>{{ item.average | number:'1.0-1' }}</strong> / {{ item.trait.maxPoints | number:'1.0-0' }}
            </div>

            <div *ngSwitchCase="'item-point'">
              <span [hidden]="showValuesAsPercent">{{ item.numbers[column.index] }}</span>
              <span [hidden]="!showValuesAsPercent || item.percents[column.index] == null">{{ item.percents[column.index] | number:'1.0-0' }}%</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage" let-columns>
        <tr>
          <td [attr.colspan]="columns.length">
            {{'common.no-results' | translate}}
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</ng-container>
