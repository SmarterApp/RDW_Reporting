<reporting-embargo-alert *hasPermission="'EMBARGO_READ'"></reporting-embargo-alert>

<div *ngIf="!schoolIsAvailable" class="alert alert-danger">
  {{'school-results.null-school' | translate }}
</div>

<div *ngIf="currentSchool">

  <page-heading>
    <ng-template #heading>
      <h2>{{currentSchool.name}}<span *ngIf="currentGrade"> - {{'common.assessment-grade-label.' + currentGrade.code | translate}}</span></h2>
    </ng-template>
    <ng-template #content>
      <ul class="list-unstyled list-inline">
        <li *hasPermission="'INDIVIDUAL_PII_READ'">
          <a routerLink="/custom-export"
             class="btn btn-default btn-sm"><i class="fa fa-table"></i> {{'organization-export.title' | translate}}</a>
        </li>
        <li>
          <button class="btn btn-default btn-sm"
                  (click)="reportDownloader.modal.show()">
            <i class="fa fa-cloud-download" aria-hidden="true"></i> {{'school-results.school-grade-button-label' | translate}}
          </button>
        </li>
      </ul>
    </ng-template>
  </page-heading>

  <assessments [assessmentExams]="assessmentExams"
               [hideAssessments]="gradesAreUnavailable"
               [assessmentProvider]="assessmentProvider"
               [assessmentExporter]="assessmentExporter"
               (export)="exportCsv()"
               [allowFilterBySessions]="false">

    <!-- School Select -->
    <div class="col-md-4">
      <label for="school-search-name">{{'common.school-typeahead-label' | translate}}</label>
      <div *ngIf="aboveLimit">
        <school-typeahead #schoolTypeahead
                          [options]="schoolOptions"
                          (selected)="schoolSelectChanged($event)"
                          ></school-typeahead>
        <div>
          <span [hidden]="!schoolTypeahead.loading"><i class="fa fa-spinner fa-pulse"></i></span>
          <br [hidden]="schoolTypeahead.noResults">
          <span [hidden]="!schoolTypeahead.noResults" class="small gray-darker">{{'school-typeahead.no-matches' | translate}}</span>
        </div>
      </div>
      <sb-typeahead  inputId="school-search-name"
                     *ngIf="!aboveLimit"
                     [options]="schoolOptions"
                     [value]="currentSchool"
                     (selected)="schoolSelectChanged($event)"
                     placeholder="{{'common.action.select' | translate}}"></sb-typeahead>

    </div>

    <!-- Current Grade -->
    <div class="col-md-2">
      <label for="current-grade">{{'school-results.current-grade-select-label' | translate}}</label>

      <select *ngIf="gradesAreUnavailable" id="current-dsiabled-grade" class="form-control"
              [disabled]="true">
        <option selected>{{'school-results.no-results' | translate}}</option>
      </select>
      <select *ngIf="!gradesAreUnavailable" id="current-grade" class="form-control"
              [(ngModel)]="currentGrade" (change)="updateRoute('Grade')">
        <option *ngFor="let grade of availableGrades" [ngValue]="grade">{{'common.assessment-grade-label.' + grade.code | translate }}</option>
      </select>
    </div>

    <!-- School Year -->
    <div class="col-md-2">
      <label for="school-year">{{'common.school-year-select-label' | translate}}</label>
      <select id="school-year" [disabled]="gradesAreUnavailable" [(ngModel)]="currentSchoolYear" (change)="updateRoute('Year')" class="form-control">
        <option *ngFor="let year of filterOptions.schoolYears" [ngValue]="year">{{year | schoolYear}}</option>
        <option *ngIf="gradesAreUnavailable" selected>{{'school-results.no-results' | translate}}</option>
      </select>
    </div>

    <!-- spacer for pushing Advanced Filters to the right -->
    <div class="col-md-2">
      <!-- can't do it in the assessments.component because it depends on how many dropdowns there are here -->
    </div>

  </assessments>

</div>

<span school-grade-report-download #reportDownloader
      [school]="currentSchool"
      [grade]="currentGrade"
      [schoolYears]="filterOptions.schoolYears"
      [schoolYear]="currentSchoolYear"
      (onShow)="initializeDownloader(reportDownloader)"></span>
