<page-heading>
  <ng-template #heading>
    <h2>{{'reports.heading' | translate}}</h2>
  </ng-template>
</page-heading>


<div class="well wide-content-container" *ngIf="resolution.isOk()">
  <p *ngIf="reports.length">{{ 'reports.instructions' | translate }}</p>
  <p *ngIf="!reports.length" [innerHtml]="'reports.no-reports-html' | translate"></p>
  <p-table *ngIf="reports.length"
           [columns]="columns"
           [value]="reports"
           [autoLayout]="true"
           sortField="created"
           [sortOrder]="-1"
           dataKey="id"
           styleClass="table table-striped table-hover">

    <ng-template pTemplate="header"
                 let-columns>
      <tr>
        <th *ngFor="let column of columns"
            [pSortableColumn]="column.field"
            [ngSwitch]="column.id">

          <div *ngSwitchDefault>
            {{ ('reports.column.' + column.id) | translate }}
          </div>

          <p-sortIcon [field]="column.field"></p-sortIcon>
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body"
                 let-report
                 let-columns="columns">
      <tr>
        <td *ngFor="let column of columns"
            [ngSwitch]="column.id">

          <report-action *ngSwitchCase="'label-header'"
                         [report]="report">
          </report-action>

          <ng-container *ngSwitchCase="'report-type-header'">
            {{ 'reports.report-type.' + getReportTypeTranslateValue(report) | translate }}
          </ng-container>

          <ng-container *ngSwitchCase="'assessment-type-header'">
            <span *ngIf="!report.assessmentTypeCode">
              {{'reports.all' | translate}}
            </span>
            <span *ngIf="report.assessmentTypeCode">
              {{'common.assessment-type.' + report.assessmentTypeCode + '.short-name' | translate}}
            </span>
          </ng-container>

          <ng-container *ngSwitchCase="'subject-header'">
            <ng-container *ngIf="!report.subjectCodes.length">
              {{ 'common.subject.ALL.name' | translate }}
            </ng-container>
            <ng-container *ngFor="let subjectCode of report.subjectCodes; let last = last">
              {{ 'common.subject.' + subjectCode + '.name' | translate }}<ng-container *ngIf="!last">, </ng-container>
            </ng-container>
          </ng-container>

          <ng-container *ngSwitchCase="'school-year-header'">
            <ng-container *ngFor="let schoolYear of report.schoolYears; let last = last">
              {{ schoolYear | schoolYear }}<ng-container *ngIf="!last">, </ng-container>
            </ng-container>
          </ng-container>

          <span *ngSwitchCase="'status-header'"
                class="label border-only"
                [ngClass]="report.statusColor">
            {{ 'reports.status.' + report.status | translate }}
          </span>

          <ng-container *ngSwitchCase="'created-header'">
            {{ report.created | date:'medium' }}
          </ng-container>

        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage" let-columns>
      <tr>
        <td [attr.colspan]="columns.length">
          {{'common.no-results' | translate}}
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<div class="well" *ngIf="resolution.isError()">
  <p>{{'reports.get-reports-error' | translate}}</p>
  <button class="btn btn-primary" (click)="reload()"><i class="fa fa-refresh"></i> {{'reports.reload' | translate}}</button>
</div>


