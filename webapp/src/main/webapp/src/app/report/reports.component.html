<tabset #tabset>
  <tab heading="{{ 'reports.heading' | translate }}">
    <div class="well wide-content-container">
      <ng-container *ngIf="resolution.isOk(); else reportResolutionError">
        <ng-container *ngIf="reports.length; else noReports">
          <p>{{ 'reports.instructions' | translate }}</p>
          <user-report-table
            [userReports]="reports"
            [nameTemplate]="userReportName"
          ></user-report-table>
        </ng-container>
        <ng-template #noReports>
          <p [innerHtml]="'reports.no-reports-html' | translate"></p>
        </ng-template>
      </ng-container>
      <ng-template #reportResolutionError>
        <p>{{ 'reports.get-reports-error' | translate }}</p>
        <button class="btn btn-primary" (click)="reload()">
          <i class="fa fa-refresh"></i>
          {{ 'reports.reload' | translate }}
        </button>
      </ng-template>
    </div>
  </tab>
  <tab heading="{{ 'reports.tab.user-queries.heading' | translate }}">
    <div
      class="well wide-content-container"
      *ngIf="(userQueries | async) as queries"
    >
      <ng-container *ngIf="queries.length; else noUserQueries">
        <p>{{ 'reports.tab.user-queries.instructions' | translate }}</p>
        <user-query-table
          [userQueries]="queries"
          [nameTemplate]="userQueryName"
        ></user-query-table>
      </ng-container>
      <ng-template #noUserQueries>
        <p
          [innerHtml]="
            'reports.tab.user-queries.no-user-queries-instructions' | translate
          "
        ></p>
      </ng-template>
    </div>
  </tab>
</tabset>

<ng-template #userReportName let-userReport="report">
  <ng-container
    *ngIf="_optionsByUserReport.get(userReport).length; else noOptions"
  >
    <app-menu
      label="{{ userReport.query.name }}"
      [options]="_optionsByUserReport.get(userReport)"
    ></app-menu>
  </ng-container>
  <ng-template #noOptions>
    <div title="{{ userReport.query.name }}" class="label-max-width">
      {{ userReport.query.name }}
    </div>
  </ng-template>
</ng-template>

<ng-template #userQueryName let-userQuery="userQuery">
  <ng-container
    *ngIf="_optionsByUserQuery.get(userQuery).length; else noOptions"
  >
    <app-menu
      label="{{ userQuery.query.name }}"
      [options]="_optionsByUserQuery.get(userQuery)"
    ></app-menu>
  </ng-container>
  <ng-template #noOptions>
    <div title="{{ userQuery.query.name }}" class="label-max-width">
      {{ userQuery.query.name }}
    </div>
  </ng-template>
</ng-template>
