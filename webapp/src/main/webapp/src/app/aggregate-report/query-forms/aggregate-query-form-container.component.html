<aggregate-embargo-alert *hasPermission="'EMBARGO_READ'"></aggregate-embargo-alert>

<ng-template #submitButtonTemplate>
  <button class="btn btn-success btn-sm green"
          [disabled]="submissionSubscription"
          (click)="submitQuery($event)">{{'aggregate-report-form.submit' | translate}}
  </button>
</ng-template>

<ng-container *ngIf="accessDenied; else accessAllowed">
  <page-heading>
    <ng-template #heading>
      <h2>{{'aggregate-report-form.heading' | translate}}</h2>
    </ng-template>
  </page-heading>
  <div class="well">
    <p>{{'aggregate-report-form.access-denied-error' | translate}}</p>
  </div>
</ng-container>

<ng-template #accessAllowed>
  <div class="aggregate-report-form">

    <div>
      <div class="nav-container">
        <scroll-nav [items]="navItems">
          <div class="ml-sm mt-xs">
            <ng-container *ngTemplateOutlet="submitButtonTemplate"></ng-container>
          </div>
        </scroll-nav>
      </div>
    </div>

    <div>

      <page-heading>
        <ng-template #heading>
          <h2>{{'aggregate-report-form.heading' | translate}}</h2>
          <p class="small gray-darkest mt-sm">{{'aggregate-report-form.subheading' | translate}}</p>
        </ng-template>
      </page-heading>


      <!-- Report Type -->
      <div id="reportTypeSection">
        <div class="well-group">
          <div class="well">
            <h3>{{'aggregate-report-form.section.report-type-heading' | translate}}</h3>
          </div>
          <div class="well pb-0">
            <div class="row">
              <div class="col-md-12">
                <wide-radio-group name="reportType"
                                  [options]="filteredOptions.reportTypes"
                                  [(ngModel)]="reportType"
                                  [ngModelOptions]="{standalone: true}"
                                  rowCount="2"
                                  (change)="onReportTypeChange()"></wide-radio-group>
              </div>
            </div>
          </div>
        </div>
      </div>

      <general-population-form *ngIf="hasGeneralPopulationReport"
                               #generalPopulationForm
                               [hidden]="reportType !== 'GeneralPopulation'"
                               (navItemChange)="setNavItems('GeneralPopulation', $event)"
                               [submitAction]="submitActionsByReportType['GeneralPopulation']"></general-population-form>

      <longitudinal-cohort-form *ngIf="hasLongitudinalReport"
                                #longitudinalCohortForm
                                [hidden]="reportType !== 'LongitudinalCohort'"
                                (navItemChange)="setNavItems('LongitudinalCohort', $event)"
                                [submitAction]="submitActionsByReportType['LongitudinalCohort']"></longitudinal-cohort-form>

      <claim-report-form *ngIf="hasClaimReport"
                         #claimForm
                         [hidden]="reportType !== 'Claim'"
                         (navItemChange)="setNavItems('Claim', $event)"
                         [submitAction]="submitActionsByReportType['Claim']"></claim-report-form>

      <target-report-form *ngIf="hasTargetReport"
                          #targetForm
                          [hidden]="reportType !== 'Target'"
                          (navItemChange)="setNavItems('Target', $event)"
                          [submitAction]="submitActionsByReportType['Target']"></target-report-form>
    </div>
  </div>
</ng-template>
