<div class="flex-children">
  <div class="flex-child">

    <div *ngIf="chartView"
         class="chart-series-legend pallet-a">
      <ul class="list-unstyled">
        <li *ngFor="let performancePath of chartView.performancePaths; let index = index"
            class="mb-xs">
          <button class="btn chart-series color-{{index}} text-left"
                  [ngClass]="{'chart-series-hidden': !performancePath.visible}"
                  (click)="performancePath.visible = !performancePath.visible">
            <div>
              {{performancePath.organization.name}}
            </div>
            <div class="small">
              {{'common.organization.type.' + performancePath.organization.type | translate}}
            </div>
          </button>
        </li>
      </ul>
    </div>
  </div>
  <div class="flex-child grow">

    <svg #chartContainer
         class="longitudinal-cohort-chart"
         [attr.width]="display.outerWidth"
         [attr.height]="display.outerHeight">

      <g [attr.transform]="'translate(' + display.padding.left + ', ' + display.padding.top + ')'">

        <g *ngIf="chartView"
           class="scale-score-areas"
           [ngClass]="areaPallet">

          <g *ngFor="let levelPath of chartView.performanceLevelPaths"
             [ngClass]="levelPath.styles">

            <path class="color-fill"
                  [attr.d]="levelPath.pathData"></path>

            <path class="scale-score-area-divider"
                  [attr.d]="levelPath.dividerPathData"></path>
          </g>
        </g>

        <g class="axes-container"></g>

        <g *ngIf="chartView"
           class="scale-score-lines"
           [ngClass]="linePallet">

          <g *ngFor="let performancePath of chartView.performancePaths; let i = index"
             [ngClass]="performancePath.visible ? '' : ' hidden'">

            <g [ngClass]="performancePath.styles">

              <path class="line color-stroke"
                    [attr.d]="performancePath.pathData"></path>

              <circle *ngFor="let point of performancePath.points"
                      [ngClass]="point.styles"
                      r="5"
                      [attr.cx]="point.x"
                      [attr.cy]="point.y"
                      [popover]="dataPointPopoverTemplate"
                      [popoverContext]="{$implicit: point}"
                      placement="top"
                      container="body"
                      outsideClick="true"
                      triggers="click"></circle>
            </g>
          </g>
        </g>
      </g>
    </svg>
  </div>
</div>

<ng-template #dataPointPopoverTemplate let-point>
  <span class="small mr-xs">{{point.levelRange.scaleScoreRange.minimum}}</span>
  <span class="label label-lg {{point.levelRange.level.color}}">{{point.scaleScore}}</span>
  <span class="small ml-xs">{{point.levelRange.scaleScoreRange.maximum}}</span>
</ng-template>
