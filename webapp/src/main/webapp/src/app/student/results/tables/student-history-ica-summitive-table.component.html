<!-- Table Display State Toggle -->
<div class="btn-group btn-group-xs pull-right" role="group">
  <button (click)="displayState.table = 'overall'"
          class="btn btn-default"
          angulartics2On="click" angularticsEvent="ViewOverallScores" angularticsCategory="StudentHistory"
          [ngClass]="{'active': displayState.table === 'overall'}">
    {{'buttons.display-overall' | translate}}
  </button>
  <button (click)="displayState.table = 'claim'"
          class="btn btn-default"
          angulartics2On="click" angularticsEvent="ViewClaimScores" angularticsCategory="StudentHistory"
          [ngClass]="{'active': displayState.table === 'claim'}">
    {{'buttons.display-claim' | translate}}
  </button>
</div>

<div class="mb-sm clearfix"></div>

<!-- Data Table -->
<p-dataTable [value]="exams"
             emptyMessage="{{'messages.noExamsMatchingCriteria' | translate}}"
             sortField="exam.date"
             sortOrder="-1"
             tableStyleClass="table table-striped table-hover">

  <p-column field="exam.date" header="{{'labels.student.results.cols.date' | translate}}" sortable="true">
    <ng-template let-data="rowData" let-exam="rowData.exam" pTemplate="body">
      <popup-menu [item]="data" [actions]="actions" [text]="exam.date | date"></popup-menu>
    </ng-template>
  </p-column>
  <p-column field="assessment.label" header="{{'labels.student.results.cols.assessment' | translate}}"
            sortable="true"></p-column>
  <p-column field="exam.schoolYear" header="{{'labels.student.results.cols.school-year' | translate}}" sortable="true">
    <ng-template let-exam="rowData.exam" pTemplate="body">
      {{ exam.schoolYear | schoolYear }}
    </ng-template>
  </p-column>
  <p-column field="exam.school.name" header="{{'labels.student.results.cols.school' | translate }}"
            sortable="true"></p-column>
  <p-column field="exam.enrolledGrade" header="{{'labels.student.results.cols.enrolled-grade' | translate}}"
            sortable="true">
    <ng-template let-exam="rowData.exam" pTemplate="body">
      {{ exam.enrolledGrade | gradeDisplay }}
    </ng-template>
  </p-column>

  <!-- Overall Score columns -->
  <p-column field="exam.administrativeCondition"
            sortable="true"
            [hidden]="displayState.table !== 'overall'">
    <ng-template pTemplate="header">
      <span info-button title="{{'labels.groups.results.assessment.exams.cols.status' | translate}}"
            content="{{'labels.groups.results.assessment.exams.cols.status-info' | translate}}"></span>
    </ng-template>
    <ng-template let-exam="rowData.exam" pTemplate="body">
      <span *ngIf="exam.administrativeCondition !== 'Valid'" class="label border-only maroon">{{ 'enum.administrative-condition.' + exam.administrativeCondition | translate }}</span>
      <span *ngIf="exam.completeness == 'Partial'" class="label border-only maroon">{{ 'enum.completeness.Partial' | translate }}</span>
    </ng-template>
  </p-column>
  <p-column field="exam.level"
            sortable="true"
            [hidden]="displayState.table !== 'overall'">
    <ng-template pTemplate="header">
      <span info-button title="{{'labels.groups.results.assessment.exams.cols.ica.performance' | translate}}"
            content="{{'labels.groups.results.assessment.exams.cols.ica.performance-info' | translate}}"></span>
    </ng-template>
    <ng-template let-exam="rowData.exam" let-i="rowIndex" pTemplate="body">
      {{ 'enum.achievement-level.full.' + (exam.level ? exam.level.toString() : 'missing') | translate }}
      <button
        class="btn btn-borderless btn-xs icon-only pull-right"
        angulartics2On="click"
        angularticsEvent="InstructionalResource"
        angularticsCategory="AssessmentResults"
        [disabled]="false"
        [popover]="buttonPopover"
        popoverTitle="{{ 'labels.groups.results.assessment.instruct-button-prefix' | translate }}{{ 'enum.achievement-level.full.' + (exam.level ? exam.level.toString() : 'missing') | translate }}"
        container="body"
        (click)="loadInstructionalResources(i)"
        [outsideClick]="true"><i
        class="fa fa-book"></i></button>
    </ng-template>
  </p-column>
  <p-column field="exam.score"
            sortable="true"
            [hidden]="displayState.table !== 'overall'">
    <ng-template pTemplate="header">
      <span info-button title="{{'labels.groups.results.assessment.exams.cols.score' | translate}}"
            content="{{'labels.groups.results.assessment.exams.cols.score-info' | translate}}"></span>
    </ng-template>
    <ng-template let-exam="rowData.exam" pTemplate="body">
      <scale-score [score]="exam.score" [standardError]="exam.standardError"></scale-score>
    </ng-template>
  </p-column>

  <!-- Claim Score columns -->
  <p-column *ngFor="let claim of getClaims(); let idx = index"
            header="{{'enum.subject-claim-code.' + claim | translate}}"
            field="{{'exam.claimScores.' + idx + '.level'}}"
            sortable="true"
            [hidden]="displayState.table !== 'claim'">
    <ng-template let-exam="rowData.exam" pTemplate="body">
      <span *ngIf="exam.claimScores[idx].level">{{ 'enum.iab-category.full.' + (exam.claimScores[idx] ? exam.claimScores[idx].level.toString() : 'missing') | translate }}</span>
      <span *ngIf="!exam.claimScores[idx].level">-</span>
    </ng-template>
  </p-column>

</p-dataTable>
<ng-template #buttonPopover>
  <instructional-resource-popover [resources]="instructionalResources"></instructional-resource-popover>
</ng-template>

