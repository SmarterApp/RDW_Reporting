<div class="mb-md" *ngIf="examHistory">
  <span class="tag tag-lg blue">
    <span class="label">{{'labels.student.name' | translate:examHistory.student}}</span>
    <span>{{examHistory.student.ssid}}</span>
  </span>
  <span class="pull-right text-right">
    <button class="btn btn-default btn-sm" (click)="exportCsv()"><i class="fa fa-bold fa-table"></i> {{'labels.export.csv' | translate}}</button>
    <a *sbAuthorize="['INDIVIDUAL_PII_READ']" routerLink="/custom-export" class="btn btn-sm btn-default ml-xs"><i class="fa fa-table"></i> {{'labels.custom-export.link' | translate}}</a>
    <button class="btn btn-default btn-sm ml-xs" (click)="reportDownloader.modal.show()"><i class="fa fa-cloud-download" aria-hidden="true"></i> {{'labels.reports.button-label.student' | translate}}</button>
    <span student-report-download #reportDownloader
          [title]="'labels.reports.form.title.single' | translate:examHistory.student"
          [student]="examHistory.student"
          [schoolYears]="filterState.years"
          [subject]="filterState.subject"
          (onShow)="initializeDownloader(reportDownloader)"></span>
  </span>
</div>
<div *ngIf="!examHistory" class="alert alert-danger">
  {{ 'labels.student.messages.null-student' | translate }}
</div>

<!-- Results Filter -->
<student-results-filter [filterState]="filterState"
                        [filterOptions]="filterOptions"
                        (filterChange)="onFilterChange()"></student-results-filter>

<h3 class="blue mb-md">{{'labels.student.results.title' | translate}}</h3>

<!-- Assessments Grouped by Type and Subject -->
<div *ngIf="examHistory">
  <div *ngFor="let assessmentType of assessmentTypes">
    <div *ngFor="let subject of getSubjectsForType(assessmentType)" class="well">
    <span class="h3 label-group {{ colorService.getColor(assessmentType) }}">
      <span class="label">{{assessmentType | assessmentType}}</span><span class="label">{{subject}}</span>
    </span>
      <button class="btn btn-default btn-sm icon-only pull-right"
              (click)="toggleCollapsed(assessmentType, subject)"
              angulartics2On="click"
              angularticsEvent="ToggleCollapseResults"
              angularticsCategory="StudentHistory">
        <span class="sr-only">{{ 'buttons.collapsible.collapse' | translate }}</span>
        <i class="fa fa-bold {{ isCollapsed(assessmentType, subject) ? 'fa-angle-down' : 'fa-angle-up' }}"></i>
      </button>

      <div class="mt-md" [hidden]="isCollapsed(assessmentType, subject)">
        <student-history-iab-table
          *ngIf="(assessmentType | assessmentType) === 'IAB'"
          [student]="examHistory.student"
          [minimumItemDataYear]="minimumItemDataYear"
          [exams]="examsByTypeAndSubject.get(assessmentType).get(subject)"></student-history-iab-table>
        <student-history-ica-summitive-table
          *ngIf="(assessmentType | assessmentType) !== 'IAB'"
          [student]="examHistory.student"
          [minimumItemDataYear]="minimumItemDataYear"
          [exams]="examsByTypeAndSubject.get(assessmentType).get(subject)"></student-history-ica-summitive-table>
      </div>
    </div>
  </div>
</div>

