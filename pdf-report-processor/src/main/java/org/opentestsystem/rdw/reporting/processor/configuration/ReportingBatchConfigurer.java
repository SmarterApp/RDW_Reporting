package org.opentestsystem.rdw.reporting.processor.configuration;

import org.springframework.batch.core.configuration.annotation.DefaultBatchConfigurer;
import org.springframework.batch.core.launch.JobLauncher;
import org.springframework.batch.core.launch.support.SimpleJobLauncher;
import org.springframework.core.task.TaskExecutor;

import javax.sql.DataSource;

/**
 * BatchConfigurer implementation that registers an asynchronous job executor.
 */
public class ReportingBatchConfigurer extends DefaultBatchConfigurer {

    private final TaskExecutor taskExecutor;

    public ReportingBatchConfigurer(final DataSource datasource,
                                    final TaskExecutor taskExecutor) {
        super(datasource);
        this.taskExecutor = taskExecutor;
    }

    @Override
    protected JobLauncher createJobLauncher() throws Exception {
        final SimpleJobLauncher jobLauncher = new SimpleJobLauncher();
        jobLauncher.setJobRepository(super.getJobRepository());
        jobLauncher.setTaskExecutor(taskExecutor);
        jobLauncher.afterPropertiesSet();
        return jobLauncher;
    }
}
