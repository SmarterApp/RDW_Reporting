package org.opentestsystem.rdw.reporting.common.web;

import org.springframework.boot.autoconfigure.web.HttpMessageConverters;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.converter.HttpMessageConverter;
import org.springframework.http.converter.xml.MappingJackson2XmlHttpMessageConverter;

import java.util.List;
import java.util.Set;

import static java.util.stream.Collectors.toList;

/**
 * Strip the auto-configured MappingJackson2XmlHttpMessageConverter from the registered
 * set of message converters to force JSON response for default browser Accept headers.
 */
@Configuration
public class DefaultJsonContentConfiguration  {

    @Bean
    public HttpMessageConverters converters(final Set<HttpMessageConverter<?>> converters) {
        return new HttpMessageConverters(true, converters) {
            @Override
            protected List<HttpMessageConverter<?>> postProcessConverters(final List<HttpMessageConverter<?>> converters) {
                return converters.stream()
                        .filter(converter -> !MappingJackson2XmlHttpMessageConverter.class.isInstance(converter))
                        .collect(toList());
            }
        };
    }
}
