package org.opentestsystem.rdw.reporting.common.web.security.session;

import com.fasterxml.jackson.databind.module.SimpleModule;
import org.opentestsystem.rdw.reporting.common.web.security.User;
import org.opentestsystem.rdw.reporting.common.web.security.jackson2.UserMixin;
import org.springframework.security.providers.ExpiringUsernameAuthenticationToken;
import org.springframework.security.saml.SAMLCredential;
import org.springframework.security.saml.parser.SAMLCollection;
import org.springframework.security.saml.parser.SAMLObject;

/**
 * This module registers de/serialization handlers for all classes
 * serialized by SAML in the session store.
 */
public class SamlModule extends SimpleModule {

    public SamlModule() {
        super();
        addSerializer(new SAMLObjectSerializer());
        addDeserializer(SAMLObject.class, new SAMLObjectDeserializer());
        addSerializer(new SAMLCollectionSerializer());
        addDeserializer(SAMLCollection.class, new SAMLCollectionDeserializer());
        addDeserializer(ExpiringUsernameAuthenticationToken.class, new ExpiringUsernameAuthenticationTokenDeserializer());
        setMixInAnnotation(SAMLCredential.class, SAMLCredentialMixin.class);
        setMixInAnnotation(User.class, UserMixin.class);
        setMixInAnnotation(ExpiringUsernameAuthenticationToken.class, ExpiringUsernameAuthenticationTokenMixin.class);
    }
}
