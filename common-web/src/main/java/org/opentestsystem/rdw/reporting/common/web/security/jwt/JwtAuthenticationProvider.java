package org.opentestsystem.rdw.reporting.common.web.security.jwt;

import org.opentestsystem.rdw.reporting.common.web.security.User;
import org.springframework.security.authentication.AuthenticationProvider;
import org.springframework.security.core.Authentication;

/**
 * Authenticates {@link JwtAuthenticationToken} by decoding the JWT into a user object with the {@link JwtService}
 */
public class JwtAuthenticationProvider implements AuthenticationProvider {

    private final JwtService service;

    public JwtAuthenticationProvider(final JwtService service) {
        this.service = service;
    }

    @Override
    public boolean supports(final Class<?> authentication) {
        return JwtAuthenticationToken.class.isAssignableFrom(authentication);
    }

    @Override
    public Authentication authenticate(final Authentication authentication) {
        final String token = (String) authentication.getPrincipal();
        final User user = service.decode(token);
        return new JwtAuthenticationToken(user, token, user.getAuthorities());
    }

}