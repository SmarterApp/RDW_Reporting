package org.opentestsystem.rdw.reporting.controller;

import org.opentestsystem.rdw.reporting.model.ExamReport;
import org.opentestsystem.rdw.reporting.model.ExamReportExportOptions;
import org.opentestsystem.rdw.reporting.security.User;
import org.opentestsystem.rdw.reporting.service.ExamReportExportService;
import org.opentestsystem.rdw.reporting.service.ExamReportService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

@RestController
public class ExportController {

    @Autowired
    private ExamReportService examReportService;

    @Autowired
    private ExamReportExportService examReportExportService;


    @PostMapping(value = "/api/exams/{examId}/report")
    public void getExamReportAsPDF(
            final @PathVariable long examId,
            final @RequestBody ExamReportExportOptions options,
            final @AuthenticationPrincipal User user,
            final HttpServletResponse response) throws IOException {

        final ExamReport report = examReportService.getReport(user, examId);
        examReportExportService.exportPDF(report, options, response);
    }

}
