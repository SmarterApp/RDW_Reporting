package org.opentestsystem.rdw.reporting.web;

import org.opentestsystem.rdw.reporting.security.User;
import org.opentestsystem.rdw.reporting.service.ExamReportService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import javax.validation.constraints.NotNull;
import java.io.IOException;

@RestController
public class ExamReportExportController {

    private ExamReportService service;

    @Autowired
    public ExamReportExportController(final @NotNull ExamReportService service) {
        this.service = service;
    }

    @PostMapping(value = "/api/examreports")
    @PreAuthorize("permitAll()")
    public ExamReportPdfExport getExamReportAsPdf(
            final @RequestBody ExamReportPdfExportRequest request,
            final @AuthenticationPrincipal User user) throws IOException {

        return new ExamReportPdfExport(service.getReport(user, request.getBody()), request.getLocale(), request.getOptions());
    }

}
