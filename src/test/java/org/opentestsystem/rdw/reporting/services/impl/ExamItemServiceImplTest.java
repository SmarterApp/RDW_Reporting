package org.opentestsystem.rdw.reporting.services.impl;

import org.junit.Before;
import org.junit.Test;
import org.opentestsystem.rdw.reporting.model.ExamItem;
import org.opentestsystem.rdw.reporting.model.Rubric;
import org.opentestsystem.rdw.reporting.repository.ArtifactRepository;
import org.opentestsystem.rdw.reporting.service.impl.ExamItemServiceImpl;

import javax.imageio.ImageIO;

import static org.hamcrest.CoreMatchers.equalTo;
import static org.junit.Assert.assertThat;
import static org.mockito.Matchers.any;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

import java.awt.Graphics;
import java.awt.image.BufferedImage;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;
import java.util.List;

public class ExamItemServiceImplTest {
    private ExamItemServiceImpl service;
    //region Test Data
    private TestItem simpleItem = new TestItem("187-2044", "<?xml version=\"1.0\" encoding=\"utf-8\"?><itemrelease version=\"2.0\"><item format=\"gi\" id=\"2029\" version=\"17\" bankkey=\"187\"><content language=\"ENU\" version=\"2.0\" approvedVersion=\"17\"><rubriclist><rubric scorepoint=\"\"><name>Rubric</name><val><![CDATA[<p style=\"\">Exemplar:</p><p style=\"\">&#xA0;</p><ul style=\"padding-left:1.5000em; \"><li><p style=\"font-style:italic; font-weight:bold; \">Part A: </p><ul style=\"padding-left:1.5000em; \"><li><p style=\"\">Radius = 2 in&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Radius = 4 in</p><p style=\"\">Volume = 8 in<span style=\"vertical-align:super; font-size: 58%;\">3</span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Volume = 64 in<span style=\"vertical-align:super; font-size: 58%;\">3</span></p><p style=\"\">&#xA0;</p></li></ul></li><ul style=\"padding-left:1.5000em; \"><li><p style=\"\">Radius = 2 in&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Radius = 4 in</p><p style=\"\">Volume = 8 in<span style=\"vertical-align:super; font-size: 58%;\">3</span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Volume = 64 in<span style=\"vertical-align:super; font-size: 58%;\">3</span></p><p style=\"\">&#xA0;</p></li></ul><li><p style=\"margin-left:0in; margin-right:0in; text-indent:0in; \"><span style=\"font-style:italic; font-weight:bold; \">Part B:</span> False</p></li></ul><p style=\"margin-left:0in; margin-right:0in; text-indent:0in; \">&#xA0;</p><p style=\"margin-left:0in; margin-right:0in; text-indent:0in; \">(1 point) The student supplies an example of two radii and missing numbers for the volumes that makes the conjecture false (e.g. Radii are 1 and 2, missing numbers for volume are 1 and 8; radii are 2 and 4, missing numbers for volume are 8 and 64; etc.) and responds with “False” in Part B.</p><p style=\"\">&#xA0;</p>]]></val>\n      </rubric></rubriclist></content></item></itemrelease>");
    private TestItem imageItem = new TestItem("187-1889","<?xml version=\"1.0\" encoding=\"utf-8\"?> <itemrelease version=\"2.0\"> <item format=\"gi\" id=\"1889\" version=\"12\" bankkey=\"187\"> <attriblist> <attrib attid=\"itm_item_id\"> <name>Item: ITS ID</name> <val>1889</val> <desc></desc> </attrib> <attrib attid=\"itm_item_subject\"> <name>Item: Subject</name> <val>MATH</val> <desc></desc> </attrib> <attrib attid=\"itm_item_desc\"> <name>Item: Item Description</name> <val>cloned from 738</val> <desc></desc> </attrib> <attrib attid=\"itm_FTUse\"> <name>Fieldtest Use</name> <val>PracTest::MG7::S1::SP14 (8); PracTest::MG7::S1::SP14::ESN (8); PracTest::MG7::S1::SP15 (8); PracTest::MG7::S1::SP15::ESN (8);</val> <desc></desc> </attrib> <attrib attid=\"itm_OPUse\"> <name>Operational Use</name> <val>IRP::MathG7NoCalc::CAT::SP15 (6);</val> <desc></desc> </attrib> <attrib attid=\"itm_att_Answer Key\"> <name>Item: Answer Key</name> <val>GI</val> <desc></desc> </attrib> <attrib attid=\"itm_att_Grade\"> <name>Item: Grade</name> <val>7</val> <desc>7</desc> </attrib> <attrib attid=\"itm_att_Item Format\"> <name>Item: Item Format</name> <val>GI</val> <desc>GI [2]</desc> </attrib> <attrib attid=\"itm_att_Page Layout\"> <name>Item: Page Layout</name> <val>22</val> <desc></desc> </attrib> <attrib attid=\"itm_att_Response Type\"> <name>Item: Response Type</name> <val>Grid</val> <desc></desc> </attrib> <attrib attid=\"itm_att_Item Point\"> <name>Item: Item Point</name> <val>2 pts.</val> <desc>2 Points</desc> </attrib> <attrib attid=\"itm_att_Cloze Answers\"> <name>Item: Cloze Answers</name> <val></val> <desc></desc> </attrib> <attrib attid=\"itm_att_Max Choices\"> <name>Item:Max Choices</name> <val></val> <desc></desc> </attrib> <attrib attid=\"itm_att_Answer Key (Part II)\"> <name>Item: Answer Key (Part II)</name> <val></val> <desc></desc> </attrib> </attriblist> <tutorial id=\"1075\" bankkey=\"187\" /> <resourceslist> <resource type=\"wordList\" id=\"2312\" index=\"1\" bankkey=\"187\" /> </resourceslist> <statistic /> <MachineRubric filename=\"Item_1889_v12.qrx\" /> <RendererSpec filename=\"Item_1889_v12.gax\" /> <content language=\"ENU\" version=\"2.0\" approvedVersion=\"12\"> <rationaleoptlist /> <stem><![CDATA[<p style=\"\">In the <span id=\"item_1889_TAG_40\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"1\"></span>given<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_40\" data-tag-boundary=\"end\"></span> equation, <span style=\"font-style:italic; \">a</span>, <span style=\"font-style:italic; \">b</span>, and <span style=\"font-style:italic; \">c</span> are nonzero rational numbers.</p><p style=\"\"> </p><p style=\"text-align:center; \"><img id=\"item_1889_Object1\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object1_png16malpha.png\" width=\"57\" height=\"13\" /></p><p style=\"text-align:left; \"> </p><p style=\"text-align:left; \"><span id=\"item_1889_TAG_47\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"2\"></span>Given<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_47\" data-tag-boundary=\"end\"></span> this equation, <span id=\"item_1889_TAG_42\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"3\"></span>drag<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_42\" data-tag-boundary=\"end\"></span> one <span id=\"item_1889_TAG_16\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"2\"></span>number<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_16\" data-tag-boundary=\"end\"></span> <span id=\"item_1889_TAG_43\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"4\"></span>into each<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_43\" data-tag-boundary=\"end\"></span> <span id=\"item_1889_TAG_44\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"5\"></span>box<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_44\" data-tag-boundary=\"end\"></span> to <span id=\"item_1889_TAG_48\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"6\"></span>complete<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_48\" data-tag-boundary=\"end\"></span> four <span id=\"item_1889_TAG_46\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"7\"></span>true<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_46\" data-tag-boundary=\"end\"></span> <span id=\"item_1889_TAG_39_BEGIN\">equations</span>. </p>]]></stem> <rubriclist> <rubric scorepoint=\"\"> <name> Rubric</name> <val><![CDATA[<p style=\"\">Exemplar:</p><p style=\"\"> </p><ul style=\"padding-left:1.5000em; \"><li><p style=\"\"><img id=\"item_1889_Object2\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object2_png16malpha.png\" width=\"80\" height=\"13\" /></p><p style=\"\"><img id=\"item_1889_Object3\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object3_png16malpha.png\" width=\"80\" height=\"13\" /></p><p style=\"\"><img id=\"item_1889_Object4\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object4_png16malpha.png\" width=\"64\" height=\"32\" /></p><p style=\"\"><img id=\"item_1889_Object5\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object5_png16malpha.png\" width=\"63\" height=\"32\" /></p></li></ul><p style=\"\"> </p><p style=\"\">Other Correct Responses:</p><p style=\"\"> </p><ul style=\"padding-left:1.5000em; \"><li><p style=\"\">for the second equation, <img id=\"item_1889_Object6\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object6_png16malpha.png\" width=\"80\" height=\"13\" /></p><p style=\"\">for the fourth equation, <img id=\"item_1889_Object7\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object7_png16malpha.png\" width=\"64\" height=\"32\" /></p></li></ul><p style=\"\"> </p><p style=\"\">For this item, a full-credit response includes</p><p style=\"\"> </p><ul style=\"padding-left:1.5000em; \"><li><p style=\"\"><span style=\"background-color:transparent; \">two correct equations </span>(1 point)</p></li></ul><p style=\"\">        AND</p><ul style=\"padding-left:1.5000em; \"><li><p style=\"background-color:transparent; \">two more correct equations (1 point).</p></li></ul>]]></val> </rubric> <samplelist maxval=\"\" minval=\"\" /> </rubriclist> <attachmentlist> <attachment pass=\"true\" id=\"aslfile1\" type=\"ASL\" subtype=\"STEM\" file=\"item_1889_ASL_STEM.MP4\" /> </attachmentlist> <constraints /> <apipAccessibility> <accessibilityInfo> <accessElement identifier=\"ae2\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>A-times b equals c.</audioShortDesc> </readAloud> <brailleText> <brailleTextString>a times b is equal to c</brailleTextString> <brailleCode type=\"Nemeth\">a*b .k c</brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae3\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object1\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>A., times b, equals c.</audioShortDesc> <audioLongDesc></audioLongDesc> </readAloud> <brailleText> <brailleTextString></brailleTextString> <brailleCode type=\"Nemeth\"></brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae11\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_TAG_39_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>equations. This is an interactive image. The blue button above the image reeds, Delete. From top to bottom, the rectangle along the left side of the image reeds, A., B., C., Negative A., Negative B., Negative C.,. The main answer space reeds, Negative A., times box, equals. Box times Box equals negative c., box over negative b.,equals a.,; box over box equals negative a.,</textToSpeechPronunciation> <textToSpeechPronunciationAlternate></textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString></brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae12\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>minus a times minus b is equal to c</audioShortDesc> </readAloud> <brailleText> <brailleTextString>minus a times minus b is equal to c</brailleTextString> <brailleCode type=\"Nemeth\">-a*-b .k c </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae13\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object2\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>minus a times minus b is equal to c</audioShortDesc> </readAloud> <brailleText> <brailleTextString>minus a times minus b is equal to c</brailleTextString> <brailleCode type=\"Nemeth\">-a*-b .k c </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae14\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>a times minus b is equal to minus c</audioShortDesc> </readAloud> <brailleText> <brailleTextString>a times minus b is equal to minus c</brailleTextString> <brailleCode type=\"Nemeth\">a*-b .k -c </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae15\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object3\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>a times minus b is equal to minus c</audioShortDesc> </readAloud> <brailleText> <brailleTextString>a times minus b is equal to minus c</brailleTextString> <brailleCode type=\"Nemeth\">a*-b .k -c </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae16\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>the fraction minus c over minus b , is equal to minus a</audioShortDesc> </readAloud> <brailleText> <brailleTextString>the fraction minus c over minus b , is equal to minus a</brailleTextString> <brailleCode type=\"Nemeth\">?-c/-b# .k -a </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae17\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object4\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>the fraction minus c over minus b , is equal to minus a</audioShortDesc> </readAloud> <brailleText> <brailleTextString>the fraction minus c over minus b , is equal to minus a</brailleTextString> <brailleCode type=\"Nemeth\">?-c/-b# .k -a </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae18\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>the fraction minus c over b , is equal to minus a</audioShortDesc> </readAloud> <brailleText> <brailleTextString>the fraction minus c over b , is equal to minus a</brailleTextString> <brailleCode type=\"Nemeth\">?-c/b# .k -a </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae19\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object5\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>the fraction minus c over b , is equal to minus a</audioShortDesc> </readAloud> <brailleText> <brailleTextString>the fraction minus c over b , is equal to minus a</brailleTextString> <brailleCode type=\"Nemeth\">?-c/b# .k -a </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae20\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>minus a times b is equal to minus c</audioShortDesc> </readAloud> <brailleText> <brailleTextString>minus a times b is equal to minus c</brailleTextString> <brailleCode type=\"Nemeth\">-a*b .k -c </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae21\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object6\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>minus a times b is equal to minus c</audioShortDesc> </readAloud> <brailleText> <brailleTextString>minus a times b is equal to minus c</brailleTextString> <brailleCode type=\"Nemeth\">-a*b .k -c </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae22\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>the fraction c over minus b , is equal to minus a</audioShortDesc> </readAloud> <brailleText> <brailleTextString>the fraction c over minus b , is equal to minus a</brailleTextString> <brailleCode type=\"Nemeth\">?c/-b# .k -a </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae23\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object7\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>the fraction c over minus b , is equal to minus a</audioShortDesc> </readAloud> <brailleText> <brailleTextString>the fraction c over minus b , is equal to minus a</brailleTextString> <brailleCode type=\"Nemeth\">?c/-b# .k -a </brailleCode> </brailleText> </relatedElementInfo> </accessElement> </accessibilityInfo> </apipAccessibility> </content> <content language=\"ESN\" version=\"2.0\" approvedVersion=\"12\"> <stem><![CDATA[<p style=\"\"><span style=\"language:es; country:ES; \">En la ecuacin dada, </span><span style=\"language:es; country:ES; font-style:italic; \">a</span><span style=\"language:es; country:ES; \">, </span><span style=\"language:es; country:ES; font-style:italic; \">b</span><span style=\"language:es; country:ES; \"> y </span><span style=\"language:es; country:ES; font-style:italic; \">c</span><span style=\"language:es; country:ES; \"> son nmeros racionales distintos de cero</span>.</p><p style=\"\"> </p><p style=\"text-align:center; \"><img id=\"item_1889_Object8\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object8_png16malpha.png\" width=\"57\" height=\"13\" /></p><p style=\"text-align:left; \"> </p><p style=\"text-align:left; language:es; country:ES; \">Dada esta ecuacin, arrastra un nmero a cada casilla para completar cuatro ecuaciones verdaderas</p><p class=\"languagedivider\"> </p><p style=\"\">In the <span id=\"item_1889_TAG_40\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"1\"></span>given<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_40\" data-tag-boundary=\"end\"></span> equation, <span style=\"font-style:italic; \">a</span>, <span style=\"font-style:italic; \">b</span>, and <span style=\"font-style:italic; \">c</span> are nonzero rational numbers.</p><p style=\"\"> </p><p style=\"text-align:center; \"><img id=\"item_1889_Object1\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object1_png16malpha.png\" width=\"57\" height=\"13\" /></p><p style=\"text-align:left; \"> </p><p style=\"text-align:left; \"><span id=\"item_1889_TAG_47\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"2\"></span>Given<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_47\" data-tag-boundary=\"end\"></span> this equation, <span id=\"item_1889_TAG_42\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"3\"></span>drag<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_42\" data-tag-boundary=\"end\"></span> one <span id=\"item_1889_TAG_16\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"2\"></span>number<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_16\" data-tag-boundary=\"end\"></span> <span id=\"item_1889_TAG_43\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"4\"></span>into each<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_43\" data-tag-boundary=\"end\"></span> <span id=\"item_1889_TAG_44\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"5\"></span>box<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_44\" data-tag-boundary=\"end\"></span> to <span id=\"item_1889_TAG_48\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"6\"></span>complete<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_48\" data-tag-boundary=\"end\"></span> four <span id=\"item_1889_TAG_46\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"7\"></span>true<span class=\"its-tag\" data-tag-ref=\"item_1889_TAG_46\" data-tag-boundary=\"end\"></span> <span id=\"item_1889_TAG_39_BEGIN\">equations</span>. </p>]]></stem> <rubriclist> <rubric scorepoint=\"_Spanish\"> <name> Rubric_Spanish</name> <val><![CDATA[<p style=\"\">Exemplar:</p><p style=\"\"> </p><ul style=\"padding-left:1.5000em; \"><li><p style=\"\"><img id=\"item_1889_Object9\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object9_png16malpha.png\" width=\"80\" height=\"13\" /></p><p style=\"\"><img id=\"item_1889_Object10\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object10_png16malpha.png\" width=\"80\" height=\"13\" /></p><p style=\"\"><img id=\"item_1889_Object11\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object11_png16malpha.png\" width=\"64\" height=\"32\" /></p><p style=\"\"><img id=\"item_1889_Object12\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object12_png16malpha.png\" width=\"63\" height=\"32\" /></p></li></ul><p style=\"\"> </p><p style=\"\">Other Correct Responses:</p><p style=\"\"> </p><ul style=\"padding-left:1.5000em; \"><li><p style=\"\">for the second equation, <img id=\"item_1889_Object13\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object13_png16malpha.png\" width=\"80\" height=\"13\" /></p><p style=\"\">for the fourth equation, <img id=\"item_1889_Object14\" style=\"vertical-align:middle;\" src=\"item_1889_v12_Object14_png16malpha.png\" width=\"64\" height=\"32\" /></p></li></ul><p style=\"\"> </p><p style=\"\">For this item, a full-credit response includes</p><p style=\"\"> </p><ul style=\"padding-left:1.5000em; \"><li><p style=\"\"><span style=\"background-color:transparent; \">two correct equations </span>(1 point)</p></li></ul><p style=\"\">        AND</p><ul style=\"padding-left:1.5000em; \"><li><p style=\"language:es; country:ES; background-color:transparent; \">two more correct equations (1 point).</p></li></ul>]]></val> </rubric> <samplelist maxval=\"_Spanish\" minval=\"_Spanish\" /> </rubriclist> <attachmentlist /> <constraints /> <apipAccessibility> <accessibilityInfo> <accessElement identifier=\"ae2\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>A-times b equals c.</audioShortDesc> </readAloud> <brailleText> <brailleTextString>a times b is equal to c</brailleTextString> <brailleCode type=\"Nemeth\">a*b .k c</brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae3\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object1\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>A., times b, equals c.</audioShortDesc> <audioLongDesc /> </readAloud> <brailleText> <brailleTextString /> <brailleCode type=\"Nemeth\" /> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae11\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_TAG_39_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>equations. This is an interactive image. The blue button above the image reeds, Delete. From top to bottom, the rectangle along the left side of the image reeds, A., B., C., Negative A., Negative B., Negative C.,. The main answer space reeds, Negative A., times box, equals. Box times Box equals negative c., box over negative b.,equals a.,; box over box equals negative a.,</textToSpeechPronunciation> <textToSpeechPronunciationAlternate /> </readAloud> <brailleText> <brailleTextString /> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae12\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>minus a times minus b is equal to c</audioShortDesc> </readAloud> <brailleText> <brailleTextString>minus a times minus b is equal to c</brailleTextString> <brailleCode type=\"Nemeth\">-a*-b .k c </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae13\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object9\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>minus a times minus b is equal to c</audioShortDesc> </readAloud> <brailleText> <brailleTextString>minus a times minus b is equal to c</brailleTextString> <brailleCode type=\"Nemeth\">-a*-b .k c </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae14\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>a times minus b is equal to minus c</audioShortDesc> </readAloud> <brailleText> <brailleTextString>a times minus b is equal to minus c</brailleTextString> <brailleCode type=\"Nemeth\">a*-b .k -c </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae15\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object10\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>a times minus b is equal to minus c</audioShortDesc> </readAloud> <brailleText> <brailleTextString>a times minus b is equal to minus c</brailleTextString> <brailleCode type=\"Nemeth\">a*-b .k -c </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae16\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>the fraction minus c over minus b , is equal to minus a</audioShortDesc> </readAloud> <brailleText> <brailleTextString>the fraction minus c over minus b , is equal to minus a</brailleTextString> <brailleCode type=\"Nemeth\">?-c/-b# .k -a </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae17\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object11\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>the fraction minus c over minus b , is equal to minus a</audioShortDesc> </readAloud> <brailleText> <brailleTextString>the fraction minus c over minus b , is equal to minus a</brailleTextString> <brailleCode type=\"Nemeth\">?-c/-b# .k -a </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae18\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>the fraction minus c over b , is equal to minus a</audioShortDesc> </readAloud> <brailleText> <brailleTextString>the fraction minus c over b , is equal to minus a</brailleTextString> <brailleCode type=\"Nemeth\">?-c/b# .k -a </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae19\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object12\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>the fraction minus c over b , is equal to minus a</audioShortDesc> </readAloud> <brailleText> <brailleTextString>the fraction minus c over b , is equal to minus a</brailleTextString> <brailleCode type=\"Nemeth\">?-c/b# .k -a </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae20\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>minus a times b is equal to minus c</audioShortDesc> </readAloud> <brailleText> <brailleTextString>minus a times b is equal to minus c</brailleTextString> <brailleCode type=\"Nemeth\">-a*b .k -c </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae21\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object13\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>minus a times b is equal to minus c</audioShortDesc> </readAloud> <brailleText> <brailleTextString>minus a times b is equal to minus c</brailleTextString> <brailleCode type=\"Nemeth\">-a*b .k -c </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae22\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>the fraction c over minus b , is equal to minus a</audioShortDesc> </readAloud> <brailleText> <brailleTextString>the fraction c over minus b , is equal to minus a</brailleTextString> <brailleCode type=\"Nemeth\">?c/-b# .k -a </brailleCode> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae23\"> <contentLinkInfo itsLinkIdentifierRef=\"item_1889_Object14\" type=\"Equation\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <audioShortDesc>the fraction c over minus b , is equal to minus a</audioShortDesc> </readAloud> <brailleText> <brailleTextString>the fraction c over minus b , is equal to minus a</brailleTextString> <brailleCode type=\"Nemeth\">?c/-b# .k -a </brailleCode> </brailleText> </relatedElementInfo> </accessElement> </accessibilityInfo> </apipAccessibility> </content> </item> </itemrelease>");
    private TestItem multiItem = new TestItem("187-2638","<?xml version=\"1.0\" encoding=\"utf-8\"?> <itemrelease version=\"2.0\"> <item format=\"wer\" id=\"2638\" version=\"5\" bankkey=\"187\"> <associatedpassage>3750</associatedpassage> <attriblist> <attrib attid=\"itm_item_id\"> <name>Item: ITS ID</name> <val>2638</val> <desc></desc> </attrib> <attrib attid=\"itm_item_subject\"> <name>Item: Subject</name> <val>ELA</val> <desc></desc> </attrib> <attrib attid=\"itm_item_desc\"> <name>Item: Item Description</name> <val>Napping - SBAC_Field</val> <desc></desc> </attrib> <attrib attid=\"itm_FTUse\"> <name>Fieldtest Use</name> <val>PracTest::ELAG7::Perf::S2::SP14 (1); PracTest::ELAG7::Perf::S2::SP14::Braille (1);</val> <desc></desc> </attrib> <attrib attid=\"itm_OPUse\"> <name>Operational Use</name> <val></val> <desc></desc> </attrib> <attrib attid=\"itm_att_Answer Key\"> <name>Item: Answer Key</name> <val>WER</val> <desc>WER [16.1]</desc> </attrib> <attrib attid=\"itm_att_Grade\"> <name>Item: Grade</name> <val>7</val> <desc>7</desc> </attrib> <attrib attid=\"itm_att_Item Format\"> <name>Item: Item Format</name> <val>WER</val> <desc>Writing Extended Response</desc> </attrib> <attrib attid=\"itm_att_Page Layout\"> <name>Item: Page Layout</name> <val>21</val> <desc></desc> </attrib> <attrib attid=\"itm_att_Response Type\"> <name>Item: Response Type</name> <val>HTMLEditor</val> <desc></desc> </attrib> <attrib attid=\"itm_att_Item Point\"> <name>Item: Item Point</name> <val>10pts</val> <desc></desc> </attrib> <attrib attid=\"stm_pass_id\"> <name>Stim: ITS ID</name> <val>3750</val> <desc></desc> </attrib> <attrib attid=\"itm_att_Max Choices\"> <name>Item:Max Choices</name> <val>NA</val> <desc>NA</desc> </attrib> </attriblist> <tutorial id=\"1078\" bankkey=\"187\" /> <resourceslist /> <statistic /> <content language=\"ENU\" version=\"2.0\" approvedVersion=\"5\"> <rationaleoptlist /> <stem><![CDATA[<p style=\"\"><span style=\"font-weight:bold; \">Student </span><span id=\"item_2638_TAG_1_BEGIN\"><span style=\"font-weight:bold; \">Directions</span></span><br /><br /><span style=\"font-weight:bold; \">Napping Explanatory Performance </span><span id=\"item_2638_TAG_2_BEGIN\"><span style=\"font-weight:bold; \">Task</span></span><br /><br /><span style=\"font-weight:bold; \">Part </span><span id=\"item_2638_TAG_3_BEGIN\"><span style=\"font-weight:bold; \">2</span></span><br />You will now review your notes and sources, and plan, draft, revise, and edit your writing. You may use your notes and refer to the sources. Now read your assignment and the information about how your writing will be scored; then begin your work.</p><p style=\"\"><br /><span style=\"font-weight:bold; \">Your Assignment: </span><br />Now that you have completed research on the topic of sleep, the journalism club advisor has asked you to write an explanatory article about sleep and naps for the next issue of the school newspaper. The audience for your article will be other students, teachers, and parents.</p><p style=\"\"><br />Using more than one source, develop a thesis<span id=\"item_2638_TAG_4_BEGIN\">/</span>controlling idea to explain about sleep and naps. Once you have a thesis<span id=\"item_2638_TAG_5_BEGIN\">/</span>controlling idea, select the most relevant information from more than one source to support your thesis<span id=\"item_2638_TAG_6_BEGIN\">/</span>controlling idea. Then, write a multi-paragraph explanatory article explaining your thesis<span id=\"item_2638_TAG_7_BEGIN\">/</span>controlling idea. Clearly organize your article and elaborate your ideas. Unless quoting directly from the sources, use your own words. Be sure to reference the source title or number when quoting or paraphrasing details or facts from the sources.</p><p style=\"\"><br /><span style=\"font-weight:bold; \">Explanatory Article Scoring:</span><br />Your explanatory article will be scored using the following:</p><p style=\"\"><br /><span style=\"font-weight:bold; \">1. Organization</span><span id=\"item_2638_TAG_8_BEGIN\"><span style=\"font-weight:bold; \">/</span></span><span style=\"font-weight:bold; \">purpose: </span>How well did you state your thesis<span id=\"item_2638_TAG_9_BEGIN\">/</span>controlling idea, and maintain your thesis<span id=\"item_2638_TAG_10_BEGIN\">/</span>controlling idea with a logical progression of ideas from beginning to end? How well did you narrow your thesis<span id=\"item_2638_TAG_11_BEGIN\">/</span>controlling idea so you can develop and elaborate the conclusion? How well did you consistently use a variety of transitions? How effective was your introduction and your conclusion?<br /><span style=\"font-weight:bold; \">2. Evidence</span><span id=\"item_2638_TAG_12_BEGIN\"><span style=\"font-weight:bold; \">/</span></span><span style=\"font-weight:bold; \">elaboration: </span>How well did you integrate relevant and specific information from the sources? How well did you elaborate your ideas? How well did you clearly state ideas using precise language that is appropriate for your audience and purpose?<br /><span style=\"font-weight:bold; \">3. Conventions: </span>How well did you follow the rules of grammar usage, punctuation, capitalization and spelling?</p><p style=\"\"><br /><span style=\"font-weight:bold; \">Now begin work on your explanatory article. </span>Manage your time carefully so that you <span id=\"item_2638_TAG_13_BEGIN\">can</span></p><ul style=\"padding-left:1.5000em; \"><li><p style=\"\"><span id=\"item_2638_TAG_14_BEGIN\">plan</span> your multi-paragraph explanatory article.</p></li><li><p style=\"\"><span id=\"item_2638_TAG_15_BEGIN\">write</span> your multi-paragraph explanatory article.</p></li><li><p style=\"\"><span id=\"item_2638_TAG_16_BEGIN\">revise</span> and edit the final draft of your multi-paragraph explanatory article.</p></li></ul><p style=\"\"><br />Word-processing tools and spell check are available to you.</p><p style=\"\"><br />For Part 2, you are being asked to write a multi-paragraph explanatory article, so please be as thorough as possible. Type your response in the space provided. The box will expand as you type.</p><p style=\"\"><br />Remember to check your notes and your <span id=\"item_2638_TAG_17_BEGIN\">prewriting/planning</span> as you write and then revise and edit your explanatory article.</p>]]></stem> <rubriclist> <rubric scorepoint=\"4\"> <name> Rubric4</name> <val><![CDATA[<p style=\"\"> </p><p><dl><dt style=\"float: left; margin-top: 1px; margin-bottom: -1em;\">a)</dt><dd style=\"float: top;padding-left:1.5000em; padding-left:1.5000em; \"><p style=\"font-style:normal; font-weight:normal; \">Inference here.</p></dd><dt style=\"float: left; margin-top: 1px; margin-bottom: -1em;\">b)</dt><dd style=\"float: top;padding-left:1.5000em; padding-left:1.5000em; \"><p style=\"font-style:normal; font-weight:normal; \">Text-supported example: .... (paragraph reference)</p></dd><dt style=\"float: left; margin-top: 1px; margin-bottom: -1em;\">c)</dt><dd style=\"float: top;padding-left:1.5000em; padding-left:1.5000em; \"><p style=\"font-style:normal; font-weight:normal; \">Inference here.</p></dd><dt style=\"float: left; margin-top: 1px; margin-bottom: -1em;\">d)</dt><dd style=\"float: top;padding-left:1.5000em; padding-left:1.5000em; \"><p style=\"font-style:normal; font-weight:normal; \">Text-supported example: .... (paragraph reference)</p></dd></dl></p>]]></val> </rubric> <samplelist maxval=\"4\" minval=\"4\"> <sample purpose=\"OtherExemplar\" scorepoint=\"4\"> <name>4-Point Other Official Sample Answers </name> <annotation /> <samplecontent><![CDATA[<p style=\"\"> </p>]]></samplecontent> </sample> </samplelist> <rubric scorepoint=\"3\"> <name> Rubric3</name> <val><![CDATA[<p style=\"\"> </p>]]></val> </rubric> <samplelist maxval=\"3\" minval=\"3\"> <sample purpose=\"Exemplar\" scorepoint=\"3\"> <name>3-Point Official Sample Answer </name> <annotation /> <samplecontent><![CDATA[<p style=\"\"> </p>]]></samplecontent> </sample> </samplelist> <rubric scorepoint=\"2\"> <name> Rubric2</name> <val><![CDATA[<p style=\"\"> </p>]]></val> </rubric> <samplelist maxval=\"2\" minval=\"2\"> <sample purpose=\"Exemplar\" scorepoint=\"2\"> <name>2-Point Official Sample Answer </name> <annotation /> <samplecontent><![CDATA[<p style=\"\"> </p>]]></samplecontent> </sample> </samplelist> <rubric scorepoint=\"1\"> <name> Rubric1</name> <val><![CDATA[<p style=\"\"> </p>]]></val> </rubric> <samplelist maxval=\"1\" minval=\"1\"> <sample purpose=\"Exemplar\" scorepoint=\"1\"> <name>1-Point Official Sample Answer </name> <annotation /> <samplecontent><![CDATA[<p style=\"\"> </p>]]></samplecontent> </sample> </samplelist> <rubric scorepoint=\"0\"> <name> Rubric0</name> <val><![CDATA[<p style=\"\"> </p>]]></val> </rubric> <samplelist maxval=\"0\" minval=\"0\"> <sample purpose=\"Exemplar\" scorepoint=\"0\"> <name>0-Point Official Sample Answer </name> <annotation /> <samplecontent><![CDATA[<p style=\"\"> </p>]]></samplecontent> </sample> </samplelist> </rubriclist> <attachmentlist></attachmentlist> <apipAccessibility> <accessibilityInfo> <accessElement identifier=\"ae1\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_1_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>Directions.</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>Directions</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>Directions</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae2\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_2_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>Task.</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>Task</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>Task</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae3\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_3_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>2.</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>2</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>2</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae4\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_4_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>slash</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>/</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>/</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae5\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_5_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>slash</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>/</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>/</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae6\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_6_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>slash</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>/</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>/</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae7\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_7_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>slash</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>/</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>/</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae8\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_8_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>slash</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>/</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>/</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae9\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_9_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>slash</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>/</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>/</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae10\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_10_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>slash</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>/</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>/</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae11\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_11_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>slash</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>/</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>/</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae12\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_12_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>slash</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>/</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>/</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae13\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_13_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>can:</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>can</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>can</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae14\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_14_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>, plan</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>plan</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>plan</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae15\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_15_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>, write</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>write</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>write</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae16\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_16_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>, revise</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>revise</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>revise</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> <accessElement identifier=\"ae17\"> <contentLinkInfo itsLinkIdentifierRef=\"item_2638_TAG_17_BEGIN\" type=\"Text\"> <objectLink /> </contentLinkInfo> <relatedElementInfo> <readAloud> <textToSpeechPronunciation>pre-writing slash planning</textToSpeechPronunciation> <textToSpeechPronunciationAlternate>prewriting/planning</textToSpeechPronunciationAlternate> </readAloud> <brailleText> <brailleTextString>prewriting/planning</brailleTextString> </brailleText> </relatedElementInfo> </accessElement> </accessibilityInfo> </apipAccessibility> </content> </item> </itemrelease>");
    private TestItem noRubricItem = new TestItem("187-2661","<?xml version=\"1.0\" encoding=\"utf-8\"?><itemrelease version=\"2.0\">  <item format=\"ms\" id=\"2661\" version=\"3\" bankkey=\"187\">    <associatedpassage>3753</associatedpassage>    <attriblist>      <attrib attid=\"itm_item_id\">        <name>Item: ITS ID</name>        <val>2661</val>        <desc></desc>      </attrib>      <attrib attid=\"itm_item_subject\">        <name>Item: Subject</name>        <val>ELA</val>        <desc></desc>      </attrib>      <attrib attid=\"itm_item_desc\">        <name>Item: Item Description</name>        <val>What's That in Your Backpack?/9911 - SBAC_Field</val>        <desc></desc>      </attrib>      <attrib attid=\"itm_FTUse\">        <name>Fieldtest Use</name>        <val>PracTest::ELAG3::SP14 (8); PracTest::ELAG3::SP14::Braille (8);</val>        <desc></desc>      </attrib>      <attrib attid=\"itm_OPUse\">        <name>Operational Use</name>        <val></val>        <desc></desc>      </attrib>      <attrib attid=\"itm_att_Answer Key\">        <name>Item: Answer Key</name>        <val>A,E,F</val>        <desc>,,</desc>      </attrib>      <attrib attid=\"itm_att_Grade\">        <name>Item: Grade</name>        <val>3</val>        <desc>3</desc>      </attrib>      <attrib attid=\"itm_att_Item Format\">        <name>Item: Item Format</name>        <val>MS</val>        <desc></desc>      </attrib>      <attrib attid=\"itm_att_Page Layout\">        <name>Item: Page Layout</name>        <val>21</val>        <desc></desc>      </attrib>      <attrib attid=\"itm_att_Response Type\">        <name>Item: Response Type</name>        <val>Vertical MS</val>        <desc></desc>      </attrib>      <attrib attid=\"itm_att_Item Point\">        <name>Item: Item Point</name>        <val>1pt</val>        <desc></desc>      </attrib>      <attrib attid=\"stm_pass_id\">        <name>Stim: ITS ID</name>        <val>3753</val>        <desc></desc>      </attrib>    </attriblist>    <tutorial id=\"1073\" bankkey=\"187\" />    <resourceslist />    <statistic />    <content language=\"ENU\" version=\"2.0\" approvedVersion=\"3\">      <concept>        <name>What Knowledge Do Students Need to Understand This Concept?</name>        <val><![CDATA[<p style=\"\">&#xA0;</p>]]></val>      </concept>      <es>        <name>Explanation of Correct Answer</name>        <val><![CDATA[<p style=\"\">&#xA0;</p>]]></val>      </es>      <himi>        <name>Explanation of Correct Answer</name>        <val><![CDATA[<p style=\"\">&#xA0;</p>]]></val>      </himi>      <rationaleoptlist>        <rationale>          <name>Rationale for Option A</name>          <val><![CDATA[<p style=\"\">&#xA0;</p>]]></val>        </rationale>        <rationale>          <name>Rationale for Option B</name>          <val><![CDATA[<p style=\"\">&#xA0;</p>]]></val>        </rationale>        <rationale>          <name>Rationale for Option C</name>          <val><![CDATA[<p style=\"\">&#xA0;</p>]]></val>        </rationale>        <rationale>          <name>Rationale for Option D</name>          <val><![CDATA[<p style=\"\">&#xA0;</p>]]></val>        </rationale>        <rationale>          <name>Rationale for Option E</name>          <val><![CDATA[<p style=\"\">&#xA0;</p>]]></val>        </rationale>        <rationale>          <name>Rationale for Option F</name>          <val><![CDATA[<p style=\"\">&#xA0;</p>]]></val>        </rationale>      </rationaleoptlist>      <illustration><![CDATA[<p style=\"\">&#xA0;</p>]]></illustration>      <stem><![CDATA[<p style=\"\">Many items made from trees are used every day. Pick <span id=\"item_2661_TAG_1_BEGIN\"><span style=\"font-weight:bold; \">three</span></span> details from the passage that <span id=\"item_2661_TAG_3_BEGIN\"><span style=\"font-weight:bold; \">best</span></span> support this idea.</p>]]></stem>      <optionlist minChoices=\"1\" maxChoices=\"0\">        <option>          <name>Option A</name>          <val><![CDATA[<p style=\"\">Cedar trees are used to make pencils.</p>]]></val>          <feedback><![CDATA[<p style=\"\">CORRECT. This sentence names a product of trees.</p>]]></feedback>        </option>        <option>          <name>Option B</name>          <val><![CDATA[<p style=\"\">Slats from a cedar tree are glued together.</p>]]></val>          <feedback><![CDATA[<p style=\"\">The student may have selected this because it describes a part of the process of making pencils.</p>]]></feedback>        </option>        <option>          <name>Option C</name>          <val><![CDATA[<p style=\"\">Graphite, or <span id=\"item_2661_TAG_2_BEGIN\">lead</span>, is used to make marks on paper.</p>]]></val>          <feedback><![CDATA[<p style=\"\">This does not support the idea that many items come from trees.</p>]]></feedback>        </option>        <option>          <name>Option D</name>          <val><![CDATA[<p style=\"\">A paper mill is where pulp is made from chipped wood.</p>]]></val>          <feedback><![CDATA[<p style=\"\">The student may have selected this because it mentions a paper mill.</p>]]></feedback>        </option>        <option>          <name>Option E</name>          <val><![CDATA[<p style=\"\">Syrup from trees is used to make candy and other treats.</p>]]></val>          <feedback><![CDATA[<p style=\"\">CORRECT. This identifies a product made from trees.</p>]]></feedback>        </option>        <option>          <name>Option F</name>          <val><![CDATA[<p style=\"\">Trees that are cut down may be made into paper for books.</p>]]></val>          <feedback><![CDATA[<p style=\"\">CORRECT. This identifies a product made from trees.</p>]]></feedback>        </option>      </optionlist>      <attachmentlist></attachmentlist>      <apipAccessibility>        <accessibilityInfo>          <accessElement identifier=\"ae1\">            <contentLinkInfo itsLinkIdentifierRef=\"item_2661_TAG_1_BEGIN\" type=\"Text\">              <objectLink />            </contentLinkInfo>            <relatedElementInfo>              <readAloud>                <textToSpeechPronunciation>three,</textToSpeechPronunciation>                <textToSpeechPronunciationAlternate>three</textToSpeechPronunciationAlternate>              </readAloud>              <brailleText>                <brailleTextString>three</brailleTextString>              </brailleText>            </relatedElementInfo>          </accessElement>          <accessElement identifier=\"ae2\">            <contentLinkInfo itsLinkIdentifierRef=\"item_2661_TAG_3_BEGIN\" type=\"Text\">              <objectLink />            </contentLinkInfo>            <relatedElementInfo>              <readAloud>                <textToSpeechPronunciation>best,</textToSpeechPronunciation>                <textToSpeechPronunciationAlternate>best</textToSpeechPronunciationAlternate>              </readAloud>              <brailleText>                <brailleTextString>best</brailleTextString>              </brailleText>            </relatedElementInfo>          </accessElement>          <accessElement identifier=\"ae3\">            <contentLinkInfo itsLinkIdentifierRef=\"item_2661_TAG_2_BEGIN\" type=\"Text\">              <objectLink />            </contentLinkInfo>            <relatedElementInfo>              <readAloud>                <textToSpeechPronunciation>led</textToSpeechPronunciation>                <textToSpeechPronunciationAlternate>lead</textToSpeechPronunciationAlternate>              </readAloud>              <brailleText>                <brailleTextString>lead</brailleTextString>              </brailleText>            </relatedElementInfo>          </accessElement>        </accessibilityInfo>      </apipAccessibility>    </content>  </item></itemrelease>");
    //endregion

    @Before
    public void before() throws IOException {
        ArtifactRepository repository = mock(ArtifactRepository.class);

        when(repository.getItemXml(simpleItem.id)).thenReturn(simpleItem.toInputStream());
        when(repository.getItemXml(imageItem.id)).thenReturn(imageItem.toInputStream());
        when(repository.getItemXml(multiItem.id)).thenReturn(multiItem.toInputStream());
        when(repository.getItemXml(noRubricItem.id)).thenReturn(noRubricItem.toInputStream());

        when(repository.getItemXml(noRubricItem.id)).thenReturn(new ByteArrayInputStream(noRubricItem.xml.getBytes(StandardCharsets.UTF_8)));

        when(repository.getArtifactFromItemDirectory(any(String.class), any(String.class))).thenReturn(CreateMockImageInputStream());
        service = new ExamItemServiceImpl(repository);
    }

    @Test
    public void getByIdShouldReturnRubricLoadedFromStringConstant() {
        Rubric rubric = service.getByItemNumber(simpleItem.id).get(0);

        assertThat(rubric.getName(), equalTo("Rubric"));
        assertThat(rubric.getTemplate().length(), equalTo(1603));
    }

    @Test
    public void getByIdSShouldReturnsRubricWhenLoadedFromFileAndEncodeImages() {
        Rubric rubric = service.getByItemNumber("187-1889").get(0);

        assertThat(rubric.getName(), equalTo(" Rubric"));
        assertThat(rubric.getTemplate().contains("src=\"data:image/png;base64,"), equalTo(true));
    }

    @Test
    public void getByIdSWithMultiplesShouldReturnAll() {
        List<Rubric> rubrics = service.getByItemNumber("187-2638");
        assertThat(rubrics.size(), equalTo(5));

        assertThat(rubrics.get(0).getName(), equalTo(" Rubric4"));
        assertThat(rubrics.get(0).getScorepoint(), equalTo("4"));

        assertThat(rubrics.get(1).getName(), equalTo(" Rubric3"));
        assertThat(rubrics.get(1).getScorepoint(), equalTo("3"));

        assertThat(rubrics.get(2).getName(), equalTo(" Rubric2"));
        assertThat(rubrics.get(2).getScorepoint(), equalTo("2"));

        assertThat(rubrics.get(3).getName(), equalTo(" Rubric1"));
        assertThat(rubrics.get(3).getScorepoint(), equalTo("1"));

        assertThat(rubrics.get(4).getName(), equalTo(" Rubric0"));
        assertThat(rubrics.get(4).getScorepoint(), equalTo("0"));
    }

    @Test
    public void getByIdSWithNoRubricShouldReturnEmptyCollection() {
        List<Rubric> rubrics = service.getByItemNumber(noRubricItem.id);
        assertThat(rubrics.size(), equalTo(0));
    }

    @Test(expected=RuntimeException.class)
    public void getByIdUsingS3FileNotFoundShouldThrowException() {
        List<Rubric> rubrics = service.getByItemNumber("11815-1515005");
    }

    private InputStream CreateMockImageInputStream() throws IOException {
        BufferedImage image = new BufferedImage(100,100, BufferedImage.TYPE_INT_RGB);
        Graphics graphics = image.createGraphics();
        graphics.drawRect(2, 2, 50, 50);
        ByteArrayOutputStream os = new ByteArrayOutputStream();
        ImageIO.write(image, "png", os);

        return new ByteArrayInputStream(os.toByteArray());
    }

    private static class TestItem {
        public TestItem(String id, String xml){
            this.id = id;
            this.xml = xml;
        }

        public InputStream toInputStream() {
            return new ByteArrayInputStream(xml.getBytes(StandardCharsets.UTF_8));
        }

        public String id;
        public String xml;
    }
}
