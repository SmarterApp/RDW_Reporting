package org.opentestsystem.rdw.reporting.processor.requesthandler;

import org.opentestsystem.rdw.reporting.common.report.AbstractExamReportRequest;
import org.opentestsystem.rdw.reporting.common.report.GroupExamReportRequest;
import org.opentestsystem.rdw.reporting.processor.model.ExamQueryParams;
import org.springframework.stereotype.Component;

import static org.opentestsystem.rdw.reporting.processor.model.ExamQueryParams.PermissionType.Group;

/**
 * This implementation of an ExamQueryParamsParser is responsible for converting
 * a {@link GroupExamReportRequest} into an {@link ExamQueryParams} instance.
 */
@Component
public class GroupExamQueryParamsParser implements ExamQueryParamsParser {

    @Override
    public boolean accept(final AbstractExamReportRequest reportRequest) {
        return GroupExamReportRequest.class.isInstance(reportRequest);
    }

    @Override
    public ExamQueryParams parseQueryParams(final AbstractExamReportRequest reportRequest) {
        final GroupExamReportRequest request = (GroupExamReportRequest) reportRequest;
        return ExamQueryParams.builder()
                .schoolYear(request.getSchoolYear())
                .groupId(request.getGroupGrant().getId())
                .assessmentType(request.getAssessmentType() == null ? null : request.getAssessmentType().getAssessmentType())
                .subject(request.getSubject())
                .queryPermissionType(Group)
                .disableTransferAccess(reportRequest.isDisableTransferAccess())
                .build();
    }
}
