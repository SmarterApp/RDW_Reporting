package org.opentestsystem.rdw.reporting.processor.requesthandler;

import org.opentestsystem.rdw.reporting.common.model.ReportQuery;
import org.opentestsystem.rdw.reporting.common.model.ReportQueryType;
import org.opentestsystem.rdw.reporting.common.model.SchoolGradePrintableReportQuery;
import org.opentestsystem.rdw.reporting.processor.model.SchoolGradeExamReportRequest;
import org.opentestsystem.rdw.reporting.processor.model.ExamQueryParams;
import org.springframework.stereotype.Component;

import static org.opentestsystem.rdw.reporting.processor.model.ExamQueryParams.PermissionType.Individual;

/**
 * This implementation of an ExamQueryParamsParser is responsible for converting
 * a {@link SchoolGradeExamReportRequest} into an {@link ExamQueryParams} instance.
 */
@Component
public class SchoolGradeExamQueryParamsParser implements ExamQueryParamsParser<SchoolGradePrintableReportQuery> {

    @Override
    public boolean accept(final ReportQuery query) {
        return query.getType() == ReportQueryType.SchoolGrade;
    }

    @Override
    public ExamQueryParams parseQueryParams(final SchoolGradePrintableReportQuery query) {
        return ExamQueryParams.builder()
                .schoolYear(query.getSchoolYear())
                .schoolId(query.getSchoolId())
                .assessmentTypeCode(query.getAssessmentTypeCode())
                .gradeId(query.getGradeId())
                .subjectCode(query.getSubjectCode())
                .queryPermissionType(Individual)
                .disableTransferAccess(query.isDisableTransferAccess())
                .build();
    }
}
