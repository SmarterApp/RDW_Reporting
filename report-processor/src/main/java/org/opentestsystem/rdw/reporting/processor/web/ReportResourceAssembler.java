package org.opentestsystem.rdw.reporting.processor.web;

import org.opentestsystem.rdw.reporting.processor.model.UserReport;

import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;

/**
 * Assembler for converting {@link UserReport} instances to {@link ReportResource} instances.
 */
class ReportResourceAssembler {

    private final ReportResourceMapper defaultMapper;
    private final Set<ReportResourceMapper> mappers;

    public ReportResourceAssembler(final ReportResourceMapper defaultMapper,
                                   final Set<ReportResourceMapper> mappers) {
        this.defaultMapper = defaultMapper;
        this.mappers = mappers;
    }

    public ReportResource toResource(final UserReport report) {
        return findMapper(report).toResource(report);
    }

    public List<ReportResource> toResources(final List<UserReport> reports) {
        return reports.stream()
                .map(this::toResource)
                .collect(Collectors.toList());
    }

    private ReportResourceMapper findMapper(final UserReport report) {
        for (final ReportResourceMapper mapper : mappers) {
            if (mapper.handles(report)) {
                return mapper;
            }
        }
        return defaultMapper;
    }
}
