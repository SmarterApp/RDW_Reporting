package org.opentestsystem.rdw.reporting.processor.configuration;

import org.opentestsystem.rdw.archive.ArchivePropertiesResolver;
import org.opentestsystem.rdw.archive.ArchivePropertiesRoot;
import org.opentestsystem.rdw.archive.ArchiveServiceTenantDynamicRouter;
import org.opentestsystem.rdw.multitenant.TenantKeyResolver;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class ArchiveServiceConfiguration {

    @ConfigurationProperties("archive")
    @Bean
    ArchivePropertiesRoot archivePropertiesRoot() {
        return new ArchivePropertiesRoot();
    }

    @Bean
    ArchivePropertiesResolver archivePropertiesResolver(TenantKeyResolver tenantKeyResolver,
                                                        ArchivePropertiesRoot archivePropertiesRoot) {
        return new ArchivePropertiesResolver(tenantKeyResolver, archivePropertiesRoot);
    }

    @Bean
    ArchiveServiceTenantDynamicRouter archiveService(ArchivePropertiesResolver archivePropertiesResolver,
                                                    TenantKeyResolver tenantKeyResolver) {
        return new ArchiveServiceTenantDynamicRouter(archivePropertiesResolver, tenantKeyResolver);
    }
}
