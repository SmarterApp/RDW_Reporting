package org.opentestsystem.rdw.reporting.processor.util;

import org.springframework.http.MediaType;

import javax.validation.constraints.NotNull;

import static org.opentestsystem.rdw.reporting.common.util.MediaTypes.getExtension;

/**
 * File name support utility
 */
public final class FileNames {

    private FileNames() {}

    /**
     * Sanitizes the given file name for download and use on a file system
     * This method is based on the information here https://en.wikipedia.org/wiki/Filename
     *
     * @param text The text to sanitize
     */
    private static String sanitize(@NotNull final String text) {
        return text.replaceAll("[<>:;,%?*|\"]", "");
    }

    /**
     * Formats the given text and media type into a file name.
     * This method removes all invalid file system name characters and replaces spaces with underscores
     *
     * @param text The text to format
     * @param mediaType The file's media type
     * @return A file system acceptable file name
     */
    public static String format(@NotNull final String text, final MediaType mediaType) {
        return sanitize(text.trim())
                .replaceAll("\\s+", "_")
                + "."
                + getExtension(mediaType);
    }
}
