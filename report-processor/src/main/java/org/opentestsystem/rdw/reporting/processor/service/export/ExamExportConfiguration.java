package org.opentestsystem.rdw.reporting.processor.service.export;

import org.opentestsystem.rdw.reporting.processor.repository.ExamRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class ExamExportConfiguration {

    @Bean
    public ExamExportService examExportServiceFactory(@Value("${app.archive.root}") final String archiveRoot,
                                                      @Value("${app.export.destination}") final String exportDestination,
                                                      @Autowired final ExamRepository repository) {
        if (LocalExamExportService.validRoot(archiveRoot)) {
            if (!exportDestination.equals(""))
                throw new IllegalArgumentException("Export destination must be '' to export to " + archiveRoot);

            return new LocalExamExportService(repository);
        }

        if (S3ExamExportService.validRoot(archiveRoot)) {
            if(!exportDestination.equals("S3"))
                throw new IllegalArgumentException("Export destination must be S3 to export to " + archiveRoot);

            return new S3ExamExportService(repository);
        }


        throw new IllegalArgumentException("Invalid archive root " + archiveRoot);
    }
}
