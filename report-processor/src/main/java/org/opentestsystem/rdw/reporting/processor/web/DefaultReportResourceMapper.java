package org.opentestsystem.rdw.reporting.processor.web;

import com.google.common.collect.ImmutableList;
import org.opentestsystem.rdw.reporting.processor.model.AbstractExamReportRequest;
import org.opentestsystem.rdw.reporting.processor.model.Report;

/**
 * Default implementation of a report resource mapper.
 */
class DefaultReportResourceMapper implements ReportResourceMapper {

    @Override
    public boolean handles(final Report request) {
        return true;
    }

    @Override
    public ReportResource toResource(final Report report) {
        final ReportResource resource = new ReportResource();
        resource.setId(report.getId());
        resource.setStatus(report.getStatus());
        resource.setLabel(report.getLabel());
        resource.setCreated(report.getCreated());
        resource.setMetadata(report.getMetadata());

        final AbstractExamReportRequest<?> request = report.getReportRequest();
        if (request == null) {
            return resource;
        }

        resource.setRequest(request);
        resource.setReportType(request.getReportType());
        resource.setAssessmentTypeCode(request.getAssessmentTypeCode());
        resource.setSubjectCodes(request.getSubjectCode() == null ? ImmutableList.of() : ImmutableList.of(request.getSubjectCode()));
        resource.setSchoolYears(request.getSchoolYear() == 0 ? ImmutableList.of() : ImmutableList.of(request.getSchoolYear()));
        return resource;
    }
}
