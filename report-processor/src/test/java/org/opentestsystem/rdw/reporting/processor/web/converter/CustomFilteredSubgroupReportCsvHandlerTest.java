package org.opentestsystem.rdw.reporting.processor.web.converter;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.runner.RunWith;
import org.mockito.junit.MockitoJUnitRunner;
import org.opentestsystem.rdw.reporting.common.model.AggregateRow;
import org.opentestsystem.rdw.reporting.common.model.Dimension;
import org.opentestsystem.rdw.reporting.common.model.DimensionType;
import org.opentestsystem.rdw.reporting.common.model.FilteredSubgroupAggregateReportQuery.Builder;
import org.opentestsystem.rdw.reporting.common.model.Organization;
import org.opentestsystem.rdw.reporting.common.test.support.ReportQueries;
import org.springframework.context.MessageSource;

@RunWith(MockitoJUnitRunner.class)
public class CustomFilteredSubgroupReportCsvHandlerTest extends FilteredSubgroupReportCsvHandlerTest<AggregateRow> {

    @Override
    protected AggregateRow reportRow(final String subgroupKey, final Organization organization) {
        return super.reportRowBuilder(AggregateRow.builder(), organization)
                .dimension(Dimension.builder().type(DimensionType.Custom).code(subgroupKey).build())
                .build();
    }

    @Override
    protected FilteredSubgroupReportCsvHandler createHandlerUnderTest(final MessageSource messageSource, final ObjectMapper objectMapper) {
        return new CustomFilteredSubgroupReportCsvHandler(messageSource, objectMapper);
    }

    @Override
    protected Builder getQueryBuilder() {
        return ReportQueries.filteredSubgroupQuery();
    }

    @Override
    protected int getHeadersCount() {
        return 17;
    }
}