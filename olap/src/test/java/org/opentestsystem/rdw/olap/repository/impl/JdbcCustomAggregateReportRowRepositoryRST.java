package org.opentestsystem.rdw.olap.repository.impl;

import com.google.common.collect.ImmutableList;
import org.junit.Test;
import org.opentestsystem.rdw.olap.model.Dimension;
import org.opentestsystem.rdw.olap.model.ReportQuery;
import org.opentestsystem.rdw.olap.model.ReportRow;
import org.opentestsystem.rdw.olap.repository.CustomAggregateReportRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Import;

import static org.assertj.core.api.Assertions.assertThat;

@Import(JdbcCustomAggregateReportRowRepository.class)
public class JdbcCustomAggregateReportRowRepositoryRST extends RepositoryBackedIT {

    @Autowired
    private CustomAggregateReportRepository reportRepository;

    @Test
    public void itShouldFindByQuery() {
        final Iterable<ReportRow> reportRows = reportRepository.findByQuery(ReportQuery.builder()
                .asmtGrades(ImmutableList.of(4))
                .includeState(true)
                .schoolYears(ImmutableList.of(2017))
                .subjectIds(ImmutableList.of(1))
                .dimension(Dimension.Overall)
                .build());
        assertThat(reportRows).isNotEmpty();
    }
}