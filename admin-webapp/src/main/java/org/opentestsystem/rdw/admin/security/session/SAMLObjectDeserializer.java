package org.opentestsystem.rdw.admin.security.session;

import com.fasterxml.jackson.core.JsonParser;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.DeserializationContext;
import com.fasterxml.jackson.databind.deser.std.StdScalarDeserializer;
import org.springframework.security.saml.parser.SAMLObject;

import java.io.IOException;
import java.io.ObjectInputStream;

/**
 * This class is responsible for deserializing SAMLObject instances using
 * the built-in spring-saml deserialization method.
 *
 * @see SAMLObject#readObject(ObjectInputStream)
 */
class SAMLObjectDeserializer extends StdScalarDeserializer<SAMLObject> {

    private final SAMLXmlDeserializer deserializer;

    public SAMLObjectDeserializer() {
        super(SAMLObject.class);
        this.deserializer = new SAMLXmlDeserializer();
    }

    @Override
    public SAMLObject deserialize(final JsonParser p, final DeserializationContext ctxt) throws IOException, JsonProcessingException {
        return new SAMLObject(deserializer.deserialize(p.getText()));
    }
}