package org.opentestsystem.rdw.admin.security.session;

import com.fasterxml.jackson.annotation.JsonAutoDetect;
import com.fasterxml.jackson.annotation.JsonTypeInfo;
import com.fasterxml.jackson.databind.annotation.JsonDeserialize;
import org.opensaml.saml2.core.Assertion;
import org.opensaml.saml2.core.Attribute;
import org.opensaml.saml2.core.NameID;
import org.springframework.security.saml.SAMLCredential;
import org.springframework.security.saml.parser.SAMLCollection;
import org.springframework.security.saml.parser.SAMLObject;

import java.io.Serializable;

/**
 * This mixin controls SAMLCredential de/serialization.
 */
@JsonTypeInfo(use = JsonTypeInfo.Id.CLASS, include = JsonTypeInfo.As.PROPERTY)
@JsonDeserialize(builder = SAMLCredentialMixin.Builder.class)
@JsonAutoDetect(fieldVisibility = JsonAutoDetect.Visibility.ANY, getterVisibility = JsonAutoDetect.Visibility.NONE)
abstract class SAMLCredentialMixin {

    public static class Builder {
        private SAMLObject<NameID> nameID;
        private SAMLObject<Assertion> authenticationAssertion;
        private String localEntityID;
        private String remoteEntityID;
        private String relayState;
        private Serializable additionalData;
        private SAMLCollection<Attribute> attributes;

        public SAMLCredential build() {
            return new SAMLCredential(nameID.getObject(), authenticationAssertion.getObject(), remoteEntityID, relayState, attributes.getObject(), localEntityID, additionalData);
        }

        public Builder withNameID(final SAMLObject<NameID> nameID) {
            this.nameID = nameID;
            return this;
        }

        public Builder withAuthenticationAssertion(final SAMLObject<Assertion> authenticationAssertion) {
            this.authenticationAssertion = authenticationAssertion;
            return this;
        }

        public Builder withLocalEntityID(final String localEntityID) {
            this.localEntityID = localEntityID;
            return this;
        }

        public Builder withRemoteEntityID(final String remoteEntityID) {
            this.remoteEntityID = remoteEntityID;
            return this;
        }

        public Builder withRelayState(final String relayState) {
            this.relayState = relayState;
            return this;
        }

        public Builder withAdditionalData(final Serializable additionalData) {
            this.additionalData = additionalData;
            return this;
        }

        public Builder withAttributes(final SAMLCollection<Attribute> attributes) {
            this.attributes = attributes;
            return this;
        }
    }
}
