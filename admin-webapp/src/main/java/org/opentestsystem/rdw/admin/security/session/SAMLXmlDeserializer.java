package org.opentestsystem.rdw.admin.security.session;

import org.opensaml.saml2.core.impl.AttributeBuilder;
import org.opensaml.ws.message.decoder.MessageDecodingException;
import org.opensaml.xml.XMLObject;
import org.springframework.security.saml.parser.SAMLBase;

import java.io.IOException;
import java.io.Reader;
import java.io.StringReader;

/**
 * This helper utility class provides access to the protected
 * {@link SAMLBase#unmarshallMessage(Reader)} method.
 */
class SAMLXmlDeserializer extends SAMLBase<XMLObject, XMLObject> {

    /**
     * Default constructor.
     */
    public SAMLXmlDeserializer() {
        super(new AttributeBuilder().buildObject());
    }

    public XMLObject deserialize(final String serializedValue) throws IOException {
        try (final StringReader reader = new StringReader(serializedValue)) {
            return unmarshallMessage(reader);
        } catch (final MessageDecodingException e) {
            throw new IOException("Unable to read serialized SAML XMLObject", e);
        }
    }
}
