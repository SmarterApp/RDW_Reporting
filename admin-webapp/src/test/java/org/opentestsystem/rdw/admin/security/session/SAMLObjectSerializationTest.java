package org.opentestsystem.rdw.admin.security.session;

import org.junit.Before;
import org.junit.Test;
import org.opensaml.saml2.core.Response;
import org.springframework.security.saml.parser.SAMLObject;

import static org.assertj.core.api.Assertions.assertThat;

public class SAMLObjectSerializationTest extends SessionObjectMapperBase {

    private SAMLObject<Response> samlObject;

    @Before
    public void setup() throws Exception {
        final Response response = readResponseFromResource("/samlResponse.large.xml");
        samlObject = new SAMLObject<>(response);
    }

    @Test
    public void itShouldRoundTripASAMLCollection() throws Exception {
        final String serializedObject = getObjectMapper().writeValueAsString(samlObject);
        final SAMLObject<Response> deserializedObject = getObjectMapper().readValue(serializedObject, SAMLObject.class);

        assertThat(deserializedObject.getObject().getIDIndex().getIDs())
                .isNotEmpty()
                .hasSameElementsAs(samlObject.getObject().getIDIndex().getIDs());
    }
}