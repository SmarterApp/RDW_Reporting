package org.opentestsystem.rdw.reporting.group;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.jdbc.core.namedparam.MapSqlParameterSource;
import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;
import org.springframework.stereotype.Repository;

import java.util.List;


@Repository
class JdbcTeacherGroupMembershipRepository implements TeacherGroupMembershipRepository {

    private final NamedParameterJdbcTemplate template;

    @Value("${sql.teacherGroupMembership.findAllStudentIdsByGroupId}")
    private String findAllStudentIdsByGroupIdQuery;

    @Value("${sql.teacherGroupMembership.create}")
    private String createQuery;

    @Value("${sql.teacherGroupMembership.delete}")
    private String deleteQuery;

    @Value("${sql.teacherGroupMembership.deleteAllByGroupId}")
    private String deleteAllByGroupIdQuery;


    JdbcTeacherGroupMembershipRepository(final NamedParameterJdbcTemplate template) {
        this.template = template;
    }

    @Override
    public List<Long> findAllStudentIdsByGroupId(final long groupId) {
        return template.queryForList(
                findAllStudentIdsByGroupIdQuery,
                new MapSqlParameterSource("group_id", groupId),
                Long.class
        );
    }

    @Override
    public void create(final long groupId, final long studentId) {
        template.update(
                createQuery,
                new MapSqlParameterSource()
                        .addValue("group_id", groupId)
                        .addValue("student_id", studentId)
        );
    }

    @Override
    public void delete(final long groupId, final long studentId) {
        template.update(
                deleteQuery,
                new MapSqlParameterSource()
                        .addValue("group_id", groupId)
                        .addValue("student_id", studentId)
        );
    }

    @Override
    public void deleteAllByGroupId(final long groupId) {
        template.update(
                deleteAllByGroupIdQuery,
                new MapSqlParameterSource()
                        .addValue("group_id", groupId)
        );
    }

}
