package org.opentestsystem.rdw.reporting.school;

import org.opentestsystem.rdw.reporting.common.model.OrganizationType;
import org.opentestsystem.rdw.reporting.common.model.School;
import org.opentestsystem.rdw.reporting.common.repository.OrganizationRepository;
import org.opentestsystem.rdw.reporting.common.security.User;
import org.opentestsystem.rdw.security.Permission;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RestController;

import javax.validation.constraints.NotNull;

import static org.opentestsystem.rdw.reporting.common.security.ReportingPermission.IndividualPiiRead;

@RestController
public class DefaultSchoolService implements SchoolService {

    private final OrganizationRepository repository;

    @Autowired()
    public DefaultSchoolService(@NotNull final OrganizationRepository repository) {
        this.repository = repository;
    }

    @Override
    public School getSchool(@NotNull final User user, final int schoolId) {
        final Permission permission = user.getPermissionsById().get(IndividualPiiRead);
        return (School) repository.findOneByTypeAndId(permission.getScope(), OrganizationType.School, schoolId);
    }
}
