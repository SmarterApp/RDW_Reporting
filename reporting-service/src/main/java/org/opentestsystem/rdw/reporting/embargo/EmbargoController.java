package org.opentestsystem.rdw.reporting.embargo;

import org.opentestsystem.rdw.reporting.common.security.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;

/**
 * This controller is responsible for providing embargo API endpoints.
 */
@RestController
public class EmbargoController {

    private final EmbargoService service;

    @Autowired
    public EmbargoController(final EmbargoService service) {
        this.service = service;
    }

    @GetMapping("/organizations/{schoolYear}/{districtId}/embargoed")
    public boolean hasEmbargoedOrganizationsNew(
        @PathVariable final Integer schoolYear,
        @PathVariable final Long districtId,
        @AuthenticationPrincipal final User user) {
        EmbargoIndividualSearch search = EmbargoIndividualSearch.builder()
                                            .schoolYear(schoolYear)
                                            .districtId(districtId)
                                            .build();

        return service.hasEmbargoAccess(user, search);
    }

    @GetMapping("/organizations/embargoed")
    public boolean hasEmbargoedOrganizations(@AuthenticationPrincipal final User user) {
        return service.hasEmbargoedOrganizations(user);
    }
}
