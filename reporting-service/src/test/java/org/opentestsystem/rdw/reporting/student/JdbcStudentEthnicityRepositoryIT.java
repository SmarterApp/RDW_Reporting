package org.opentestsystem.rdw.reporting.student;

import com.google.common.collect.ImmutableList;
import com.google.common.collect.ImmutableSet;
import org.junit.Test;
import org.opentestsystem.rdw.reporting.JdbcRepositoryWithPermissionIT;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Import;
import org.springframework.test.context.jdbc.Sql;

import static org.assertj.core.api.Assertions.assertThat;
import static org.assertj.core.data.MapEntry.entry;

@Import({JdbcStudentEthnicityRepository.class})
@Sql(scripts = {"classpath:integration-test-data.sql"})
public class JdbcStudentEthnicityRepositoryIT extends JdbcRepositoryWithPermissionIT {

    @Autowired
    private StudentEthnicityRepository repository;

    @Test
    public void itShouldFind() {
        assertThat(repository.findEthnicityCodesByStudentIds(ImmutableList.of(-1L, -2L, -3L)))
                .containsOnly(
                        entry(-1L, ImmutableSet.of("ethnicity-29", "ethnicity-28")),
                        entry(-2L, ImmutableSet.of("ethnicity-27"))
                );
    }

    @Test
    public void itShouldHandleEmptyInput() {
        assertThat(repository.findEthnicityCodesByStudentIds(ImmutableList.of())).isEmpty();
    }
}