package org.opentestsystem.rdw.reporting;

import com.google.common.collect.ImmutableList;
import com.google.common.collect.ImmutableMap;
import com.google.common.collect.ImmutableSet;
import com.google.common.collect.Maps;
import org.opentestsystem.rdw.common.model.AssessmentType;
import org.opentestsystem.rdw.reporting.common.model.Assessment;
import org.opentestsystem.rdw.reporting.common.model.Exam;
import org.opentestsystem.rdw.reporting.common.model.MeasuredAssessment;
import org.opentestsystem.rdw.reporting.common.model.Measures;
import org.opentestsystem.rdw.reporting.common.model.ScaleScore;
import org.opentestsystem.rdw.reporting.common.model.School;
import org.opentestsystem.rdw.reporting.common.model.Student;
import org.opentestsystem.rdw.reporting.common.model.StudentContext;
import org.opentestsystem.rdw.reporting.common.test.support.Instants;

import java.util.List;

import static com.google.common.collect.Lists.newArrayList;

public final class TestData {
    public static final String MATH = "Math";
    public static final String ELA = "ELA";

    public static final List<School> SCHOOLS = ImmutableList.of(
            School.builder().id(-10L).districtId(-10).name("school1").build(),
            School.builder().id(-20L).districtId(-10).name("school2").schoolGroupId(-10L).build(),
            School.builder().id(-30L).districtId(-20).name("school3").districtGroupId(-10L).build(),
            School.builder().id(-40L).districtId(-30).name("school4").districtGroupId(-10L).build()
    );

    public static final List<Assessment> STUDENT10_ASSESSMENTS = ImmutableList.of(
            assessmentBuilder1().build(),
            assessmentBuilder2().build(),
            assessmentBuilder3().build(),
            assessmentBuilder4().build(),
            assessmentBuilderMinus10().build()
    );

    public static final List<MeasuredAssessment> STUDENT10_MEASURED_ASSESSMENTS = ImmutableList.of(
            measuredAssessmentBuilder1().build()
    );

    public static final List<MeasuredAssessment> STUDENT4_MEASURED_ASSESSMENTS = ImmutableList.of(
            measuredAssessmentBuilder1().build()
    );

    public static final List<MeasuredAssessment> STUDENT5_MEASURED_ASSESSMENTS = ImmutableList.of(
            measuredAssessmentBuilder5().build(),
            measuredAssessmentBuilder7().studentsTested(1)
                    .measures(Measures.builder()
                            .level1Count(0)
                            .level2Count(1)
                            .level3Count(0)
                            .level4Count(null)
                            .avgScaleScore(2150)
                            .avgStdErr(0).build()).build()
    );

    public static final List<MeasuredAssessment> STUDENT6_MEASURED_ASSESSMENTS = ImmutableList.of(
            measuredAssessmentBuilder6().build()
    );

    public static final List<MeasuredAssessment> STUDENTS_MEASURED_ASSESSMENTS = ImmutableList.of(
            measuredAssessmentBuilder5().build(),
            measuredAssessmentBuilder7().build()
    );

    public static final List<Assessment> STUDENT10_GROUP10_ASSESSMENTS = ImmutableList.of(
            assessmentBuilder1().build(),
            assessmentBuilder2().build(),
            assessmentBuilder3().build(),
            assessmentBuilderMinus10().build()
    );

    public static final List<Assessment> STUDENT10_GROUP10_ASSESSMENTS_WITH_CUT_POINTS = ImmutableList.of(
            assessmentBuilder1().werItem(true).cutPoints(newArrayList(100, 200, 300, 400, null, null, 500)).build(),
            assessmentBuilder2().werItem(false).cutPoints(newArrayList(1, null, 2, null, null, null, 3)).build(),
            assessmentBuilder3().werItem(false).cutPoints(newArrayList(1000, 2000, 3000, 4000, null, null, 5000)).targetReportEnabled(true).build(),
            assessmentBuilderMinus10().werItem(false).cutPoints(newArrayList(100, 200, 300, 400, 500, 600, 700)).build()
    );

    public static final List<Assessment> ALL_ASSESSMENTS_WITH_CUT_POINTS = ImmutableList.of(
            assessmentBuilder1().werItem(true).cutPoints(newArrayList(100, 200, 300, 400, null, null, 500)).build(),
            assessmentBuilder2().werItem(false).cutPoints(newArrayList(1, null, 2, null, null, null, 3)).build(),
            assessmentBuilder3().werItem(false).cutPoints(newArrayList(1000, 2000, 3000, 4000, null, null, 5000)).targetReportEnabled(true).build(),
            assessmentBuilder4().werItem(true).cutPoints(newArrayList(1000, 2000, 3000, 4000, null, null, 5000)).build()
    );
    public static final List<Exam> STUDENT10_EXAMS = ImmutableList.of(
            exam1().schoolYear(1997).build(),
            exam2().schoolYear(1997).build(),
            exam3().schoolYear(1997).build(),
            exam4().schoolYear(1997).build(),
            exam5().schoolYear(1997).build(),
            exam6().schoolYear(1997).build(),
            exam8().schoolYear(1997).build(),
            exam9().schoolYear(1997).build()
    );

    public static final List<Exam> STUDENT10_GROUP10_EXAMS = ImmutableList.of(
            exam1().schoolYear(1997).build(),
            exam2().schoolYear(1997).build(),
            exam3().schoolYear(1997).build(),
            exam4().schoolYear(1997).build(),
            exam5().schoolYear(1997).build(),
            exam6().schoolYear(1997).build(),
            exam9().schoolYear(1997).build()
    );

    public static final List<Exam> EXAMS = ImmutableList.of(
            exam1()
                    .student(student().build())
                    .studentContext(studentContext().build())
                    .build(),
            exam2()
                    .student(student().build())
                    .studentContext(studentContext().build())
                    .build(),
            exam3()
                    .student(student().build())
                    .studentContext(studentContext().build())
                    .build(),
            exam4()
                    .student(student().build())
                    .studentContext(studentContext().build())
                    .build(),
            exam5()
                    .student(student().build())
                    .studentContext(studentContext().build())
                    .build(),
            exam6()
                    .student(student().build())
                    .studentContext(studentContext()
                            .iep(true)
                            .lep(true)
                            .section504(true)
                            .build()

                    )
                    .build(),
            exam8()
                    .student(student().build())
                    .studentContext(studentContext()
                            .iep(true)
                            .lep(true)
                            .section504(true)
                            .build()
                    )
                    .build()
    );
    public static final ImmutableMap<Integer, Assessment> ALL_ASSESSMENTS_BY_ID = Maps.uniqueIndex(ALL_ASSESSMENTS_WITH_CUT_POINTS, Assessment::getId);
    public static final ImmutableMap<Long, Exam> EXAMS_BY_ID = Maps.uniqueIndex(EXAMS, Exam::getId);

    public static Student.Builder student() {
        return Student.builder()
                .id(-1)
                .ssid("student1_ssid")
                .firstName("student1_firstName")
                .lastName("student1_lastName")
                .genderCode("g1")
                .ethnicityCodes(ImmutableSet.of("ethnicity-29", "ethnicity-28"));
    }

    public static StudentContext.Builder studentContext() {
        return StudentContext.builder()
                .iep(false)
                .lep(false)
                .section504(false)
                .migrantStatus(null);
    }

    public static Assessment.Builder assessmentBuilder1() {
        return Assessment.builder()
                .id(-1)
                .type(AssessmentType.ICA)
                .name("ica1")
                .label("ica1")
                .gradeCode("g1")
                .schoolYear(1997)
                .subjectCode(MATH)
                .printedReportEnabled(true)
                .claimCodes(newArrayList("ica_claim1", "ica_claim2", "ica_claim3", "ica_claim4"));
    }

    public static Assessment.Builder assessmentBuilder2() {
        return Assessment.builder()
                .id(-2)
                .type(AssessmentType.IAB)
                .name("iab1")
                .label("iab1")
                .gradeCode("g1")
                .schoolYear(1997)
                .subjectCode(MATH)
                .printedReportEnabled(true)
                .claimCodes(null);
    }

    public static Assessment.Builder assessmentBuilder3() {
        return Assessment.builder()
                .id(-3)
                .type(AssessmentType.SUMMATIVE)
                .name("sum1")
                .label("sum1")
                .gradeCode("g1")
                .schoolYear(1997)
                .subjectCode(MATH)
                .targetReportEnabled(true)
                .claimCodes(newArrayList("sum_claim1", "sum_claim2", "sum_claim3"))
                .altScoreCodes(newArrayList("sum_alt1"));
    }

    public static Assessment.Builder assessmentBuilder4() {
        return Assessment.builder()
                .id(-4)
                .type(AssessmentType.SUMMATIVE)
                .name("sum2")
                .label("sum2")
                .gradeCode("g1")
                .schoolYear(1997)
                .subjectCode(ELA)
                .targetReportEnabled(true)
                .claimCodes(newArrayList("sum_claim1", "sum_claim2", "sum_claim3"))
                .altScoreCodes(newArrayList("sum_alt1"));
    }

    public static Assessment.Builder assessmentBuilderMinus10() {
        return Assessment.builder()
                .id(-10)
                .type(AssessmentType.ICA)
                .name("newica1")
                .label("newica1")
                .gradeCode("g1")
                .schoolYear(1997)
                .subjectCode(MATH)
                .printedReportEnabled(true)
                .claimCodes(newArrayList("claim1", "claim2", "claim3", "claim4", "claim5", "claim6"));
    }

    public static MeasuredAssessment.Builder measuredAssessmentBuilder1() {
        return MeasuredAssessment.builder().assessment(Assessment.builder()
                .id(-2)
                .type(AssessmentType.IAB)
                .name("iab1")
                .label("iab1")
                .gradeCode("g1")
                .schoolYear(1997)
                .subjectCode(MATH)
                .claimCodes(null).build())
                .completedAt(Instants.from("1997-01-01"))
                .studentsTested(1)
                .measures(Measures.builder()
                        .level1Count(0)
                        .level2Count(1)
                        .level3Count(0)
                        .level4Count(null)
                        .avgScaleScore(2100)
                        .avgStdErr(0).build());
    }

    public static MeasuredAssessment.Builder measuredAssessmentBuilder5() {
        return MeasuredAssessment.builder().assessment(Assessment.builder()
                .id(-8)
                .type(AssessmentType.IAB)
                .name("iab8")
                .label("iab8")
                .gradeCode("g1")
                .schoolYear(1997)
                .subjectCode(MATH)
                .claimCodes(null).build())
                .completedAt(Instants.from("1997-01-01"))
                .studentsTested(1)
                .measures(Measures.builder()
                        .level1Count(0)
                        .level2Count(1)
                        .level3Count(0)
                        .level4Count(null)
                        .avgScaleScore(2555)
                        .avgStdErr(0).build());
    }

    public static MeasuredAssessment.Builder measuredAssessmentBuilder6() {
        return MeasuredAssessment.builder().assessment(Assessment.builder()
                .id(-9)
                .type(AssessmentType.IAB)
                .name("iab9")
                .label("iab9")
                .gradeCode("g1")
                .schoolYear(1997)
                .subjectCode(MATH)
                .claimCodes(null).build())
                .completedAt(Instants.from("1997-01-01"))
                .studentsTested(1)
                .measures(Measures.builder()
                        .level1Count(0)
                        .level2Count(1)
                        .level3Count(0)
                        .level4Count(null)
                        .avgScaleScore(2050)
                        .avgStdErr(0).build());
    }

    public static MeasuredAssessment.Builder measuredAssessmentBuilder7() {
        return MeasuredAssessment.builder().assessment(Assessment.builder()
                .id(-9)
                .type(AssessmentType.IAB)
                .name("iab9")
                .label("iab9")
                .gradeCode("g1")
                .schoolYear(1997)
                .subjectCode(MATH)
                .claimCodes(null).build())
                .completedAt(Instants.from("1997-01-01"))
                .studentsTested(2)
                .measures(Measures.builder()
                        .level1Count(0)
                        .level2Count(2)
                        .level3Count(0)
                        .level4Count(null)
                        .avgScaleScore(2100)
                        .avgStdErr(50).build());
    }

    public static MeasuredAssessment.Builder measuredAssessmentBuilder4() {
        return MeasuredAssessment.builder().assessment(Assessment.builder()
                .id(-20)
                .type(AssessmentType.IAB)
                .name("iab1")
                .label("iab1")
                .gradeCode("g2")
                .schoolYear(1997)
                .subjectCode(MATH)
                .claimCodes(null).build())
                .completedAt(Instants.from("1996-12-31"))
                .studentsTested(1)
                .measures(Measures.builder()
                        .level1Count(0)
                        .level2Count(1)
                        .level3Count(0)
                        .level4Count(null)
                        .avgScaleScore(2100)
                        .avgStdErr(0).build());
    }

    public static Exam.Builder exam() {
        return Exam.builder()
                .gradeCode("g1")
                .administrativeConditionCode("Valid")
                .completenessCode("Complete");
    }

    public static Exam.Builder exam1() {
        return exam()
                .id(-1)
                .schoolYear(1997)
                .sessionId("session1")
                .dateTime(Instants.from("1997-01-01"))
                .scaleScore(
                        ScaleScore.builder().level(1).value(2000).standardError(20).build()
                )
                .claimScaleScores(newArrayList(
                        ScaleScore.builder().level(1).value(100).standardError(10).build(),
                        ScaleScore.builder().level(2).value(200).standardError(20).build(),
                        ScaleScore.builder().level(3).value(300).standardError(30).build(),
                        ScaleScore.builder().level(4).value(400).standardError(40).build()
                ))
                .school(SCHOOLS.get(0));
    }

    public static Exam.Builder exam2() {
        return exam()
                .id(-2)
                .schoolYear(1997)
                .sessionId("session2")
                .dateTime(Instants.from("1997-01-01"))
                .gradeCode("g2")
                .scaleScore(
                        ScaleScore.builder().level(2).value(2100).standardError(21).build()
                )
                .claimScaleScores(null)
                .school(SCHOOLS.get(0));
    }

    public static Exam.Builder exam3() {
        return exam()
                .id(-3)
                .schoolYear(1997)
                .sessionId("session3")
                .dateTime(Instants.from("1997-01-01"))
                .gradeCode("g3")
                .scaleScore(
                        ScaleScore.builder().level(3).value(2200).standardError(22).build()
                )
                .claimScaleScores(newArrayList(
                        ScaleScore.builder().level(1).value(1000).standardError(100).build(),
                        ScaleScore.builder().level(2).value(2000).standardError(200).build(),
                        ScaleScore.builder().level(3).value(3000).standardError(300).build()
                ))
                .school(SCHOOLS.get(1));
    }

    public static Exam.Builder exam4() {
        return exam()
                .id(-4)
                .schoolYear(1997)
                .sessionId("session4")
                .dateTime(Instants.from("1997-01-02"))
                .scaleScore(
                        ScaleScore.builder().level(1).value(2300).standardError(23).build()
                )
                .claimScaleScores(newArrayList(
                        ScaleScore.builder().level(1).value(1100).standardError(110).build(),
                        ScaleScore.builder().level(2).value(2100).standardError(210).build(),
                        ScaleScore.builder().level(3).value(3100).standardError(310).build()
                ))
                .school(SCHOOLS.get(2));
    }

    public static Exam.Builder exam5() {
        return exam()
                .id(-5)
                .schoolYear(1997)
                .sessionId("session5")
                .dateTime(Instants.from("1997-01-05"))
                .scaleScore(
                        ScaleScore.builder().level(2).value(2400).standardError(24).build()
                )
                .claimScaleScores(newArrayList(
                        ScaleScore.builder().level(1).value(1200).standardError(120).build(),
                        ScaleScore.builder().level(2).value(2200).standardError(220).build(),
                        ScaleScore.builder().level(3).value(3200).standardError(320).build()
                ))
                .school(SCHOOLS.get(2));
    }

    public static Exam.Builder exam6() {
        return exam()
                .id(-6)
                .schoolYear(1997)
                .sessionId("session6")
                .dateTime(Instants.from("1997-01-03"))
                .administrativeConditionCode("Standardized")
                .completenessCode("Partial")
                .scaleScore(null)
                .claimScaleScores(newArrayList(null, null, null))
                .school(SCHOOLS.get(2));
    }

    public static Exam.Builder exam8() {
        return exam()
                .id(-8)
                .schoolYear(1997)
                .sessionId("session6")
                .dateTime(Instants.from("1997-01-03"))
                .administrativeConditionCode("Standardized")
                .completenessCode("Partial")
                .scaleScore(null)
                .claimScaleScores(newArrayList(null, null, null))
                .school(SCHOOLS.get(2));
    }

    public static Exam.Builder exam9() {
        return exam()
                .id(-9)
                .schoolYear(1997)
                .sessionId("session1")
                .dateTime(Instants.from("1997-01-01"))
                .scaleScore(
                        ScaleScore.builder().level(1).value(2000).standardError(20).build()
                )
                .claimScaleScores(newArrayList(
                        ScaleScore.builder().level(1).value(100).standardError(10).build(),
                        ScaleScore.builder().level(2).value(200).standardError(20).build(),
                        ScaleScore.builder().level(3).value(300).standardError(30).build(),
                        ScaleScore.builder().level(4).value(400).standardError(40).build(),
                        ScaleScore.builder().level(5).value(500).standardError(50).build(),
                        ScaleScore.builder().level(6).value(600).standardError(60).build()
                ))
                .school(SCHOOLS.get(0));
    }
}
